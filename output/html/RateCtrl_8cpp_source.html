<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>VVenC Ibrahim: /home/itaabane/Bureau/vvencp/vvenc-master/source/Lib/EncoderLib/RateCtrl.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">VVenC Ibrahim
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('RateCtrl_8cpp_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">RateCtrl.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="RateCtrl_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/* -----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">The copyright in this software is being made available under the BSD</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">License, included below. No patent rights, trademark rights and/or </span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">other Intellectual Property Rights other than the copyrights concerning </span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">the Software are granted under this license.</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">For any license concerning other Intellectual Property rights than the software,</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">especially patent licenses, a separate Agreement needs to be closed. </span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">For more information please contact:</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">Fraunhofer Heinrich Hertz Institute</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">Einsteinufer 37</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">10587 Berlin, Germany</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">www.hhi.fraunhofer.de/vvc</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">vvc@hhi.fraunhofer.de</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">Copyright (c) 2019-2021, Fraunhofer-Gesellschaft zur FÃ¶rderung der angewandten Forschung e.V.</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">All rights reserved.</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">Redistribution and use in source and binary forms, with or without</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">modification, are permitted provided that the following conditions are met:</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> * Redistributions of source code must retain the above copyright notice,</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">   this list of conditions and the following disclaimer.</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> * Redistributions in binary form must reproduce the above copyright notice,</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">   this list of conditions and the following disclaimer in the documentation</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">   and/or other materials provided with the distribution.</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> * Neither the name of Fraunhofer nor the names of its contributors may</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">   be used to endorse or promote products derived from this software without</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">   specific prior written permission.</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">THE POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">------------------------------------------------------------------------------------------- */</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160; </div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160; </div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="RateCtrl_8h.html">RateCtrl.h</a>&quot;</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Picture_8h.html">CommonLib/Picture.h</a>&quot;</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160; </div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160; </div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacevvenc.html">vvenc</a> {</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; </div>
<div class="line"><a name="l00058"></a><span class="lineno"><a class="line" href="namespacevvenc.html#abab5f5527b53cf619014a22589afe4ce">   58</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span>    <a class="code" href="namespacevvenc.html#abab5f5527b53cf619014a22589afe4ce">RC_SMOOTH_WINDOW_SIZE</a> =                           40;</div>
<div class="line"><a name="l00059"></a><span class="lineno"><a class="line" href="namespacevvenc.html#a6afe46d36eebf50617b754793260c5f3">   59</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span>    <a class="code" href="namespacevvenc.html#a6afe46d36eebf50617b754793260c5f3">RC_MAX_PIC_LIST_SIZE</a> =                            64;</div>
<div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="namespacevvenc.html#ad8687adca4e586b6da300600d9fb022b">   60</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span>    <a class="code" href="namespacevvenc.html#ad8687adca4e586b6da300600d9fb022b">RC_ITERATION_NUM</a> =                                20;</div>
<div class="line"><a name="l00061"></a><span class="lineno"><a class="line" href="namespacevvenc.html#a241f2aa439bf4d008b4ab0113048c00f">   61</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span>    <a class="code" href="namespacevvenc.html#a241f2aa439bf4d008b4ab0113048c00f">RC_LAMBDA_PREC</a> =                             1000000;</div>
<div class="line"><a name="l00062"></a><span class="lineno"><a class="line" href="namespacevvenc.html#a1aab7e3788f646db5393de39ebaa0e8d">   62</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span>    <a class="code" href="namespacevvenc.html#a1aab7e3788f646db5393de39ebaa0e8d">RC_GOP_ID_QP_OFFSET</a>[ 6 ] =      { 0, 0, 0, 3, 1, 1 };</div>
<div class="line"><a name="l00063"></a><span class="lineno"><a class="line" href="namespacevvenc.html#a59c60ed5c173ea5b12a62f25655236a1">   63</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span>    <a class="code" href="namespacevvenc.html#a59c60ed5c173ea5b12a62f25655236a1">RC_GOP_ID_QP_OFFSET_GOP32</a>[ 7 ] = { 0, 0, 0, 0, 3, 1, 1 };</div>
<div class="line"><a name="l00064"></a><span class="lineno"><a class="line" href="namespacevvenc.html#a44f3c28eeb9a80d6ee44649e201a17fe">   64</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacevvenc.html#a44f3c28eeb9a80d6ee44649e201a17fe">RC_WEIGHT_PIC_TARGET_BIT_IN_GOP</a> =                0.9;</div>
<div class="line"><a name="l00065"></a><span class="lineno"><a class="line" href="namespacevvenc.html#ae9917093a0722aff03da51244f550870">   65</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacevvenc.html#ae9917093a0722aff03da51244f550870">RC_WEIGHT_PIC_TARGET_BIT_IN_BUFFER</a> =             1.0 - <a class="code" href="namespacevvenc.html#a44f3c28eeb9a80d6ee44649e201a17fe">RC_WEIGHT_PIC_TARGET_BIT_IN_GOP</a>;</div>
<div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="namespacevvenc.html#a744241f8e002c7492b74159ce1caf63d">   66</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacevvenc.html#a744241f8e002c7492b74159ce1caf63d">RC_WEIGHT_HISTORY_LAMBDA</a> =                       0.5;</div>
<div class="line"><a name="l00067"></a><span class="lineno"><a class="line" href="namespacevvenc.html#af1539ed57ae90e2f71fdc8a91dc600ed">   67</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacevvenc.html#af1539ed57ae90e2f71fdc8a91dc600ed">RC_ALPHA_MIN_VALUE</a> =                            0.05;</div>
<div class="line"><a name="l00068"></a><span class="lineno"><a class="line" href="namespacevvenc.html#abf46a202fa78f91c371c52bc8d242cd8">   68</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacevvenc.html#abf46a202fa78f91c371c52bc8d242cd8">RC_ALPHA_MAX_VALUE</a> =                           500.0;</div>
<div class="line"><a name="l00069"></a><span class="lineno"><a class="line" href="namespacevvenc.html#a4f573f5f27f5af8ecb4786131b1f3b8f">   69</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacevvenc.html#a4f573f5f27f5af8ecb4786131b1f3b8f">RC_BETA_MIN_VALUE</a> =                             -3.0;</div>
<div class="line"><a name="l00070"></a><span class="lineno"><a class="line" href="namespacevvenc.html#a95d815af88e0ec2f5f2edad706d9b978">   70</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacevvenc.html#a95d815af88e0ec2f5f2edad706d9b978">RC_BETA_MAX_VALUE</a> =                             -0.1;</div>
<div class="line"><a name="l00071"></a><span class="lineno"><a class="line" href="namespacevvenc.html#a157d2d9b6e8ac0be6e10917e10ec39fe">   71</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacevvenc.html#a157d2d9b6e8ac0be6e10917e10ec39fe">RC_ALPHA</a> =                                    6.7542;</div>
<div class="line"><a name="l00072"></a><span class="lineno"><a class="line" href="namespacevvenc.html#a18c769e91b6d473f74679144f9ff4fb5">   72</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacevvenc.html#a18c769e91b6d473f74679144f9ff4fb5">RC_BETA1</a> =                                    1.2517;</div>
<div class="line"><a name="l00073"></a><span class="lineno"><a class="line" href="namespacevvenc.html#a7f107d79cd9070e86fdcd4865b8eb965">   73</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacevvenc.html#a7f107d79cd9070e86fdcd4865b8eb965">RC_BETA2</a> =                                    1.7860;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160; </div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">//sequence level</span></div>
<div class="line"><a name="l00076"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCSeq.html#a3efb04a13787237fcaf583e8cd31e42e">   76</a></span>&#160;<a class="code" href="classvvenc_1_1EncRCSeq.html#a3efb04a13787237fcaf583e8cd31e42e">EncRCSeq::EncRCSeq</a>()</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;{</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a306c1d7f4f6833176d12c84d77b9b412">twoPass</a>             = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a177fb8c710ad770bd0faad793da46ab9">fppParFrames</a>        = 0;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a0186bee82f4d469206cfcb18da843a46">totalFrames</a>         = 0;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a4fd2f41f944b9e6ffa3df9815904bed8">targetRate</a>          = 0;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#aebcd9a87b695d3618612fcba5248dbf8">frameRate</a>           = 0;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#ae086e1bbe8b434f83a875d578aa23f4c">targetBits</a>          = 0;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#ad0db87e2ca0c90c9609a9a82f52174a5">gopSize</a>             = 0;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#ab13b9106f285947f00b2801086096701">picWidth</a>            = 0;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#abc77673ab15d1f85309626e27061db57">picHeight</a>           = 0;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#ab3bd8609092be43aa7654c97fb5aa668">lcuWidth</a>            = 0;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a4e3179468eeee6f92e2a0641290fe74c">lcuHeight</a>           = 0;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a1fe0fb155bd34080852231563d329a54">numberOfLevel</a>       = 0;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a75852d45ae317ffce5daf5eb321b167a">intraPeriod</a>         = 0;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a516a779a4b162eddb49c63d03b75c2a9">numberOfLCU</a>         = 0;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a258d3cda3d572c3f9f8d074846658a78">averageBits</a>         = 0;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a8fef0bac5e1611ffdb8b0b437ea98d8b">bitsRatio</a>           = <a class="code" href="CommonDef_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a73b2bf1e6352c4dd8c524005a8b14081">gopID2Level</a>         = <a class="code" href="CommonDef_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">picParam</a>            = <a class="code" href="CommonDef_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#aae0bdbf90049bf94c419c0918b5e1d3d">numberOfPixel</a>       = 0;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#aa03c2b87d895da2089dcc9e5448b7cd2">framesCoded</a>         = 0;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a593aab4c0ea65f4f654fa7f6031fb0b7">bitsUsed</a>            = 0;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a3c7e7f3985dc338448fcb2c5b5ad43c5">framesLeft</a>          = 0;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a180bfc8253ef87d73463f4cdd26143cf">bitsLeft</a>            = 0;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a250403b84afe6f3ee74581c633dd5132">estimatedBitUsage</a>   = 0;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#ab0af52bb2fd3511beea867ee60f1895c">adaptiveBits</a>        = 0;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#aa921605b08e04dcf79d24564b00dcc84">lastLambda</a>          = 0.0;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  std::memset (<a class="code" href="classvvenc_1_1EncRCSeq.html#ad4b745de663253d20459b3744de3ecd1">qpCorrection</a>, 0, <span class="keyword">sizeof</span> (<a class="code" href="classvvenc_1_1EncRCSeq.html#ad4b745de663253d20459b3744de3ecd1">qpCorrection</a>));</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  std::memset (<a class="code" href="classvvenc_1_1EncRCSeq.html#a65f367eacfb22811464a0a5379ffc72e">actualBitCnt</a>, 0, <span class="keyword">sizeof</span> (<a class="code" href="classvvenc_1_1EncRCSeq.html#a65f367eacfb22811464a0a5379ffc72e">actualBitCnt</a>));</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  std::memset (<a class="code" href="classvvenc_1_1EncRCSeq.html#a0537991a88d47e85ab1a38c1a8c828f9">targetBitCnt</a>, 0, <span class="keyword">sizeof</span> (<a class="code" href="classvvenc_1_1EncRCSeq.html#a0537991a88d47e85ab1a38c1a8c828f9">targetBitCnt</a>));</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a50bbd78bc67e4ea27b0e424823b93e84">lastIntraLambda</a>     = 0.0;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#aad35fc85fff0a753627ea3ff5192834c">lastIntraQP</a>         = 0;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#ac77b590e38a8e565a52609ab911451d1">bitDepth</a>            = 0;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;}</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160; </div>
<div class="line"><a name="l00112"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCSeq.html#a60612dfbccf81f1d0286a6e08b44edf4">  112</a></span>&#160;<a class="code" href="classvvenc_1_1EncRCSeq.html#a60612dfbccf81f1d0286a6e08b44edf4">EncRCSeq::~EncRCSeq</a>()</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;{</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a3a80b6032f86a56bec74609034b3246f">destroy</a>();</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;}</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160; </div>
<div class="line"><a name="l00117"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCSeq.html#a0c6695ec3f5a446595ddcffa3a806638">  117</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvvenc_1_1EncRCSeq.html#a0c6695ec3f5a446595ddcffa3a806638">EncRCSeq::create</a>( <span class="keywordtype">bool</span> twoPassRC, <span class="keywordtype">int</span> totFrames, <span class="keywordtype">int</span> targetBitrate, <span class="keywordtype">int</span> frRate, <span class="keywordtype">int</span> intraPer, <span class="keywordtype">int</span> GOPSize, <span class="keywordtype">int</span> pictureWidth, <span class="keywordtype">int</span> pictureHeight, <span class="keywordtype">int</span> LCUWidth, <span class="keywordtype">int</span> LCUHeight, <span class="keywordtype">int</span> numOfLevel, <span class="keywordtype">int</span> adaptiveBit, std::list&lt;TRCPassStats&gt; &amp;firstPassStats )</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;{</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a3a80b6032f86a56bec74609034b3246f">destroy</a>();</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a306c1d7f4f6833176d12c84d77b9b412">twoPass</a>             = twoPassRC;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a0186bee82f4d469206cfcb18da843a46">totalFrames</a>         = totFrames;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a4fd2f41f944b9e6ffa3df9815904bed8">targetRate</a>          = targetBitrate;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#aebcd9a87b695d3618612fcba5248dbf8">frameRate</a>           = frRate;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a75852d45ae317ffce5daf5eb321b167a">intraPeriod</a>         = intraPer;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#ad0db87e2ca0c90c9609a9a82f52174a5">gopSize</a>             = GOPSize;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#ab13b9106f285947f00b2801086096701">picWidth</a>            = pictureWidth;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#abc77673ab15d1f85309626e27061db57">picHeight</a>           = pictureHeight;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#ab3bd8609092be43aa7654c97fb5aa668">lcuWidth</a>            = LCUWidth;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a4e3179468eeee6f92e2a0641290fe74c">lcuHeight</a>           = LCUHeight;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a1fe0fb155bd34080852231563d329a54">numberOfLevel</a>       = numOfLevel;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#aebf7716c3a56bb979162b37c9134214c">firstPassData</a>       = firstPassStats;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160; </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#aae0bdbf90049bf94c419c0918b5e1d3d">numberOfPixel</a> = <a class="code" href="classvvenc_1_1EncRCSeq.html#ab13b9106f285947f00b2801086096701">picWidth</a> * <a class="code" href="classvvenc_1_1EncRCSeq.html#abc77673ab15d1f85309626e27061db57">picHeight</a>;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#ae086e1bbe8b434f83a875d578aa23f4c">targetBits</a> = (int64_t)<a class="code" href="classvvenc_1_1EncRCSeq.html#a0186bee82f4d469206cfcb18da843a46">totalFrames</a> * (int64_t)<a class="code" href="classvvenc_1_1EncRCSeq.html#a4fd2f41f944b9e6ffa3df9815904bed8">targetRate</a> / (int64_t)<a class="code" href="classvvenc_1_1EncRCSeq.html#aebcd9a87b695d3618612fcba5248dbf8">frameRate</a>;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160; </div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a258d3cda3d572c3f9f8d074846658a78">averageBits</a>     = (int)( <a class="code" href="classvvenc_1_1EncRCSeq.html#a4fd2f41f944b9e6ffa3df9815904bed8">targetRate</a> / <a class="code" href="classvvenc_1_1EncRCSeq.html#aebcd9a87b695d3618612fcba5248dbf8">frameRate</a> );</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="keywordtype">int</span> picWidthInBU  = ( <a class="code" href="classvvenc_1_1EncRCSeq.html#ab13b9106f285947f00b2801086096701">picWidth</a>  % <a class="code" href="classvvenc_1_1EncRCSeq.html#ab3bd8609092be43aa7654c97fb5aa668">lcuWidth</a>  ) == 0 ? <a class="code" href="classvvenc_1_1EncRCSeq.html#ab13b9106f285947f00b2801086096701">picWidth</a>  / <a class="code" href="classvvenc_1_1EncRCSeq.html#ab3bd8609092be43aa7654c97fb5aa668">lcuWidth</a>  : <a class="code" href="classvvenc_1_1EncRCSeq.html#ab13b9106f285947f00b2801086096701">picWidth</a>  / <a class="code" href="classvvenc_1_1EncRCSeq.html#ab3bd8609092be43aa7654c97fb5aa668">lcuWidth</a>  + 1;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <span class="keywordtype">int</span> picHeightInBU = ( <a class="code" href="classvvenc_1_1EncRCSeq.html#abc77673ab15d1f85309626e27061db57">picHeight</a> % <a class="code" href="classvvenc_1_1EncRCSeq.html#a4e3179468eeee6f92e2a0641290fe74c">lcuHeight</a> ) == 0 ? <a class="code" href="classvvenc_1_1EncRCSeq.html#abc77673ab15d1f85309626e27061db57">picHeight</a> / <a class="code" href="classvvenc_1_1EncRCSeq.html#a4e3179468eeee6f92e2a0641290fe74c">lcuHeight</a> : <a class="code" href="classvvenc_1_1EncRCSeq.html#abc77673ab15d1f85309626e27061db57">picHeight</a> / <a class="code" href="classvvenc_1_1EncRCSeq.html#a4e3179468eeee6f92e2a0641290fe74c">lcuHeight</a> + 1;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a516a779a4b162eddb49c63d03b75c2a9">numberOfLCU</a>     = picWidthInBU * picHeightInBU;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160; </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a8fef0bac5e1611ffdb8b0b437ea98d8b">bitsRatio</a> = <span class="keyword">new</span> <span class="keywordtype">int</span>[ <a class="code" href="classvvenc_1_1EncRCSeq.html#ad0db87e2ca0c90c9609a9a82f52174a5">gopSize</a> ];</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a73b2bf1e6352c4dd8c524005a8b14081">gopID2Level</a> = <span class="keyword">new</span> <span class="keywordtype">int</span>[ <a class="code" href="classvvenc_1_1EncRCSeq.html#ad0db87e2ca0c90c9609a9a82f52174a5">gopSize</a> ];</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classvvenc_1_1EncRCSeq.html#ad0db87e2ca0c90c9609a9a82f52174a5">gopSize</a>; i++ )</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  {</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <a class="code" href="classvvenc_1_1EncRCSeq.html#a8fef0bac5e1611ffdb8b0b437ea98d8b">bitsRatio</a>[ i ] = 1;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <a class="code" href="classvvenc_1_1EncRCSeq.html#a73b2bf1e6352c4dd8c524005a8b14081">gopID2Level</a>[ i ] = 1;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  }</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160; </div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">picParam</a> = <span class="keyword">new</span> <a class="code" href="structvvenc_1_1TRCParameter.html">TRCParameter</a>[ <a class="code" href="classvvenc_1_1EncRCSeq.html#a1fe0fb155bd34080852231563d329a54">numberOfLevel</a> ];</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classvvenc_1_1EncRCSeq.html#a1fe0fb155bd34080852231563d329a54">numberOfLevel</a>; i++ )</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  {</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <a class="code" href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">picParam</a>[ i ].<a class="code" href="structvvenc_1_1TRCParameter.html#a20f4c4490bc8ecbdd1ffcb79acce6035">alpha</a> = 0.0;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <a class="code" href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">picParam</a>[ i ].<a class="code" href="structvvenc_1_1TRCParameter.html#a9424343761f8c4f4c1afe8f5b6bf471b">beta</a> = 0.0;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <a class="code" href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">picParam</a>[ i ].<a class="code" href="structvvenc_1_1TRCParameter.html#a0c2c12d17099a37f01345fcab95a7ebf">validPix</a> = -1;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <a class="code" href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">picParam</a>[ i ].<a class="code" href="structvvenc_1_1TRCParameter.html#a37e8135dece9bf76f60832f12fc51cf8">skipRatio</a> = 0.0;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  }</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160; </div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#aa03c2b87d895da2089dcc9e5448b7cd2">framesCoded</a> = 0;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a593aab4c0ea65f4f654fa7f6031fb0b7">bitsUsed</a> = 0;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a3c7e7f3985dc338448fcb2c5b5ad43c5">framesLeft</a> = <a class="code" href="classvvenc_1_1EncRCSeq.html#a0186bee82f4d469206cfcb18da843a46">totalFrames</a>;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a180bfc8253ef87d73463f4cdd26143cf">bitsLeft</a>   = <a class="code" href="classvvenc_1_1EncRCSeq.html#ae086e1bbe8b434f83a875d578aa23f4c">targetBits</a>;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a250403b84afe6f3ee74581c633dd5132">estimatedBitUsage</a> = 0;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#aa921605b08e04dcf79d24564b00dcc84">lastLambda</a> = 0.0;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  std::memset (<a class="code" href="classvvenc_1_1EncRCSeq.html#ad4b745de663253d20459b3744de3ecd1">qpCorrection</a>, 0, <span class="keyword">sizeof</span> (<a class="code" href="classvvenc_1_1EncRCSeq.html#ad4b745de663253d20459b3744de3ecd1">qpCorrection</a>));</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  std::memset (<a class="code" href="classvvenc_1_1EncRCSeq.html#a65f367eacfb22811464a0a5379ffc72e">actualBitCnt</a>, 0, <span class="keyword">sizeof</span> (<a class="code" href="classvvenc_1_1EncRCSeq.html#a65f367eacfb22811464a0a5379ffc72e">actualBitCnt</a>));</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  std::memset (<a class="code" href="classvvenc_1_1EncRCSeq.html#a0537991a88d47e85ab1a38c1a8c828f9">targetBitCnt</a>, 0, <span class="keyword">sizeof</span> (<a class="code" href="classvvenc_1_1EncRCSeq.html#a0537991a88d47e85ab1a38c1a8c828f9">targetBitCnt</a>));</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#ab0af52bb2fd3511beea867ee60f1895c">adaptiveBits</a> = (<a class="code" href="classvvenc_1_1EncRCSeq.html#a306c1d7f4f6833176d12c84d77b9b412">twoPass</a> ? 0 : adaptiveBit);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;}</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160; </div>
<div class="line"><a name="l00170"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCSeq.html#a3a80b6032f86a56bec74609034b3246f">  170</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvvenc_1_1EncRCSeq.html#a3a80b6032f86a56bec74609034b3246f">EncRCSeq::destroy</a>()</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;{</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classvvenc_1_1EncRCSeq.html#a8fef0bac5e1611ffdb8b0b437ea98d8b">bitsRatio</a> != <a class="code" href="CommonDef_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  {</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="keyword">delete</span>[] <a class="code" href="classvvenc_1_1EncRCSeq.html#a8fef0bac5e1611ffdb8b0b437ea98d8b">bitsRatio</a>;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <a class="code" href="classvvenc_1_1EncRCSeq.html#a8fef0bac5e1611ffdb8b0b437ea98d8b">bitsRatio</a> = <a class="code" href="CommonDef_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  }</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <span class="keywordflow">if</span> ( <a class="code" href="classvvenc_1_1EncRCSeq.html#a73b2bf1e6352c4dd8c524005a8b14081">gopID2Level</a> != <a class="code" href="CommonDef_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> )</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  {</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keyword">delete</span>[] <a class="code" href="classvvenc_1_1EncRCSeq.html#a73b2bf1e6352c4dd8c524005a8b14081">gopID2Level</a>;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <a class="code" href="classvvenc_1_1EncRCSeq.html#a73b2bf1e6352c4dd8c524005a8b14081">gopID2Level</a> = <a class="code" href="CommonDef_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  }</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160; </div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <span class="keywordflow">if</span> ( <a class="code" href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">picParam</a> != <a class="code" href="CommonDef_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> )</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  {</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keyword">delete</span>[] <a class="code" href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">picParam</a>;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <a class="code" href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">picParam</a> = <a class="code" href="CommonDef_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  }</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160; </div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;}</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160; </div>
<div class="line"><a name="l00191"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCSeq.html#a75ac805c2469793c17ab6b63d2e6ba62">  191</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvvenc_1_1EncRCSeq.html#a75ac805c2469793c17ab6b63d2e6ba62">EncRCSeq::initBitsRatio</a>( <span class="keywordtype">int</span> bRatio[] )</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;{</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classvvenc_1_1EncRCSeq.html#ad0db87e2ca0c90c9609a9a82f52174a5">gopSize</a>; i++ )</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  {</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <a class="code" href="classvvenc_1_1EncRCSeq.html#a8fef0bac5e1611ffdb8b0b437ea98d8b">bitsRatio</a>[ i ] = bRatio[ i ];</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  }</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;}</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160; </div>
<div class="line"><a name="l00199"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCSeq.html#abd81d866fc4161422a991e1a9d18a590">  199</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvvenc_1_1EncRCSeq.html#abd81d866fc4161422a991e1a9d18a590">EncRCSeq::initGOPID2Level</a>( <span class="keywordtype">int</span> GOPID2Level[] )</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;{</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classvvenc_1_1EncRCSeq.html#ad0db87e2ca0c90c9609a9a82f52174a5">gopSize</a>; i++ )</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  {</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <a class="code" href="classvvenc_1_1EncRCSeq.html#a73b2bf1e6352c4dd8c524005a8b14081">gopID2Level</a>[ i ] = GOPID2Level[ i ];</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  }</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;}</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160; </div>
<div class="line"><a name="l00207"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCSeq.html#ae858753d5596f9b39e1a73afe294dd0a">  207</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvvenc_1_1EncRCSeq.html#ae858753d5596f9b39e1a73afe294dd0a">EncRCSeq::initPicPara</a>( <a class="code" href="structvvenc_1_1TRCParameter.html">TRCParameter</a>* picPara )</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;{</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <a class="code" href="StatCounter_8h.html#a87a0b8601d301b04efad305d35b8ba20">CHECK</a>( <a class="code" href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">picParam</a> == <a class="code" href="CommonDef_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="stringliteral">&quot;Object does not exist&quot;</span> );</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160; </div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  <span class="keywordflow">if</span> ( picPara == <a class="code" href="CommonDef_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> )</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  {</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classvvenc_1_1EncRCSeq.html#a1fe0fb155bd34080852231563d329a54">numberOfLevel</a>; i++ )</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    {</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      <span class="keywordtype">int</span> bitdepthLumaScale = 2 * ( <a class="code" href="classvvenc_1_1EncRCSeq.html#ac77b590e38a8e565a52609ab911451d1">bitDepth</a> - 8 - <a class="code" href="TypeDef_8h.html#a29d5c9e713ec90b037a5aaa3865ccfa9">DISTORTION_PRECISION_ADJUSTMENT</a>( <a class="code" href="classvvenc_1_1EncRCSeq.html#ac77b590e38a8e565a52609ab911451d1">bitDepth</a> ) );</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      <span class="keywordflow">if</span> ( i &gt; 0 )</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      {</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        <a class="code" href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">picParam</a>[ i ].<a class="code" href="structvvenc_1_1TRCParameter.html#a20f4c4490bc8ecbdd1ffcb79acce6035">alpha</a> = 3.2003 * pow( 2.0, bitdepthLumaScale );</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        <a class="code" href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">picParam</a>[ i ].<a class="code" href="structvvenc_1_1TRCParameter.html#a9424343761f8c4f4c1afe8f5b6bf471b">beta</a> = -1.367;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      }</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      {</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <a class="code" href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">picParam</a>[ i ].<a class="code" href="structvvenc_1_1TRCParameter.html#a20f4c4490bc8ecbdd1ffcb79acce6035">alpha</a> = pow( 2.0, bitdepthLumaScale ) * <a class="code" href="namespacevvenc.html#a157d2d9b6e8ac0be6e10917e10ec39fe">RC_ALPHA</a>;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        <a class="code" href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">picParam</a>[ i ].<a class="code" href="structvvenc_1_1TRCParameter.html#a9424343761f8c4f4c1afe8f5b6bf471b">beta</a> = <a class="code" href="namespacevvenc.html#a7f107d79cd9070e86fdcd4865b8eb965">RC_BETA2</a>;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      }</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    }</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  }</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  {</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classvvenc_1_1EncRCSeq.html#a1fe0fb155bd34080852231563d329a54">numberOfLevel</a>; i++ )</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    {</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      <a class="code" href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">picParam</a>[ i ] = picPara[ i ];</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    }</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  }</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;}</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160; </div>
<div class="line"><a name="l00237"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCSeq.html#a8574b3b8a8bb59ad2ef9ebad57e47add">  237</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvvenc_1_1EncRCSeq.html#a8574b3b8a8bb59ad2ef9ebad57e47add">EncRCSeq::updateAfterPic</a> ( <span class="keywordtype">int</span> bits, <span class="keywordtype">int</span> tgtBits )</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;{</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a250403b84afe6f3ee74581c633dd5132">estimatedBitUsage</a> += tgtBits;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a593aab4c0ea65f4f654fa7f6031fb0b7">bitsUsed</a> += bits;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#aa03c2b87d895da2089dcc9e5448b7cd2">framesCoded</a>++;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a180bfc8253ef87d73463f4cdd26143cf">bitsLeft</a> -= bits;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a3c7e7f3985dc338448fcb2c5b5ad43c5">framesLeft</a>--;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;}</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160; </div>
<div class="line"><a name="l00246"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCSeq.html#a7c166c40a06c904af730175d13d28cd9">  246</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvvenc_1_1EncRCSeq.html#a7c166c40a06c904af730175d13d28cd9">EncRCSeq::getTargetBitsFromFirstPass</a> (<span class="keyword">const</span> <span class="keywordtype">int</span> poc, <span class="keywordtype">int</span> &amp;targetBits, <span class="keywordtype">double</span> &amp;frameVsGopRatio, <span class="keywordtype">bool</span> &amp;isNewScene, <span class="keywordtype">bool</span> &amp;refreshParameters)</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;{</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  std::list&lt;TRCPassStats&gt;::iterator it;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <span class="keywordflow">for</span> ( it = <a class="code" href="classvvenc_1_1EncRCSeq.html#aebf7716c3a56bb979162b37c9134214c">firstPassData</a>.begin(); it != <a class="code" href="classvvenc_1_1EncRCSeq.html#aebf7716c3a56bb979162b37c9134214c">firstPassData</a>.end(); it++ )</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  {</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="keywordflow">if</span> ( poc == it-&gt;poc )</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    {</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      <a class="code" href="classvvenc_1_1EncRCSeq.html#ae086e1bbe8b434f83a875d578aa23f4c">targetBits</a> = it-&gt;targetBits;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      frameVsGopRatio = it-&gt;frameInGopRatio;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      isNewScene = it-&gt;isNewScene;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      refreshParameters = it-&gt;refreshParameters;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    }</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  }</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;}</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160; </div>
<div class="line"><a name="l00262"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCSeq.html#a541a5402f3f9aa808585ae50807253e4">  262</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvvenc_1_1EncRCSeq.html#a541a5402f3f9aa808585ae50807253e4">EncRCSeq::setAllBitRatio</a>( <span class="keywordtype">double</span> basicLambda, <span class="keywordtype">double</span>* equaCoeffA, <span class="keywordtype">double</span>* equaCoeffB )</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;{</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <span class="keywordtype">int</span>* <a class="code" href="classvvenc_1_1EncRCSeq.html#a8fef0bac5e1611ffdb8b0b437ea98d8b">bitsRatio</a> = <span class="keyword">new</span> <span class="keywordtype">int</span>[ <a class="code" href="classvvenc_1_1EncRCSeq.html#ad0db87e2ca0c90c9609a9a82f52174a5">gopSize</a> ];</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classvvenc_1_1EncRCSeq.html#ad0db87e2ca0c90c9609a9a82f52174a5">gopSize</a>; i++ )</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  {</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <a class="code" href="classvvenc_1_1EncRCSeq.html#a8fef0bac5e1611ffdb8b0b437ea98d8b">bitsRatio</a>[ i ] = (int)( equaCoeffA[ i ] * pow( basicLambda, equaCoeffB[ i ] ) * (double)<a class="code" href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">picParam</a>[ <a class="code" href="classvvenc_1_1EncRCSeq.html#a73b2bf1e6352c4dd8c524005a8b14081">gopID2Level</a>[ i ] ].validPix );</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  }</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <a class="code" href="classvvenc_1_1EncRCSeq.html#a75ac805c2469793c17ab6b63d2e6ba62">initBitsRatio</a>( <a class="code" href="classvvenc_1_1EncRCSeq.html#a8fef0bac5e1611ffdb8b0b437ea98d8b">bitsRatio</a> );</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <span class="keyword">delete</span>[] <a class="code" href="classvvenc_1_1EncRCSeq.html#a8fef0bac5e1611ffdb8b0b437ea98d8b">bitsRatio</a>;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;}</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160; </div>
<div class="line"><a name="l00273"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCSeq.html#a02fd3c2635e6886180079e82fd389744">  273</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvvenc_1_1EncRCSeq.html#a02fd3c2635e6886180079e82fd389744">EncRCSeq::clipRcAlpha</a>( <span class="keywordtype">double</span>&amp; alpha )</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;{</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> bitdepthLumaScale = 2 * ( <a class="code" href="classvvenc_1_1EncRCSeq.html#ac77b590e38a8e565a52609ab911451d1">bitDepth</a> - 8 - <a class="code" href="TypeDef_8h.html#a29d5c9e713ec90b037a5aaa3865ccfa9">DISTORTION_PRECISION_ADJUSTMENT</a>( <a class="code" href="classvvenc_1_1EncRCSeq.html#ac77b590e38a8e565a52609ab911451d1">bitDepth</a> ) );</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  alpha = Clip3( <a class="code" href="namespacevvenc.html#af1539ed57ae90e2f71fdc8a91dc600ed">RC_ALPHA_MIN_VALUE</a>, <a class="code" href="namespacevvenc.html#abf46a202fa78f91c371c52bc8d242cd8">RC_ALPHA_MAX_VALUE</a> * pow( 2.0, bitdepthLumaScale ), alpha );</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;}</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160; </div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment">//GOP level</span></div>
<div class="line"><a name="l00280"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCGOP.html#a06ab26652030f26f2a8e26a911b67b0b">  280</a></span>&#160;<a class="code" href="classvvenc_1_1EncRCGOP.html#a06ab26652030f26f2a8e26a911b67b0b">EncRCGOP::EncRCGOP</a>()</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;{</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <a class="code" href="classvvenc_1_1EncRCGOP.html#a011b1e71a29b3f4cf510174141783c64">encRcSeq</a>           = <a class="code" href="CommonDef_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <a class="code" href="classvvenc_1_1EncRCGOP.html#a605565fdf0a219dff93994674ba113e9">picTargetBitInGOP</a>  = <a class="code" href="CommonDef_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <a class="code" href="classvvenc_1_1EncRCGOP.html#aaaa6ab10c878338e74a04f5ca10b0fbb">numPics</a>            = 0;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <a class="code" href="classvvenc_1_1EncRCGOP.html#a4973b73ee65d239c9bec2f8bf78846a3">targetBits</a>         = 0;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <a class="code" href="classvvenc_1_1EncRCGOP.html#a4c47890a64ad759a83b19844a364d7d5">picsLeft</a>           = 0;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <a class="code" href="classvvenc_1_1EncRCGOP.html#a7192b8cd46d8604a40846c7a736b84fe">bitsLeft</a>           = 0;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <a class="code" href="classvvenc_1_1EncRCGOP.html#a9fc04d1dbe9e90211adae22edf1aa4ea">minEstLambda</a>       = 0.0;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <a class="code" href="classvvenc_1_1EncRCGOP.html#a3a2e8b59f1816785bf9179457a42032a">maxEstLambda</a>       = 0.0;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;}</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160; </div>
<div class="line"><a name="l00292"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCGOP.html#a2e06e436d43f9a78d380ad6239d1499f">  292</a></span>&#160;<a class="code" href="classvvenc_1_1EncRCGOP.html#a2e06e436d43f9a78d380ad6239d1499f">EncRCGOP::~EncRCGOP</a>()</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;{</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <a class="code" href="classvvenc_1_1EncRCGOP.html#a3a80b6032f86a56bec74609034b3246f">destroy</a>();</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;}</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160; </div>
<div class="line"><a name="l00297"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCGOP.html#a39d3ea6b32b0fb45ae6b9f56609b19b9">  297</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvvenc_1_1EncRCGOP.html#a39d3ea6b32b0fb45ae6b9f56609b19b9">EncRCGOP::create</a>( <a class="code" href="classvvenc_1_1EncRCSeq.html">EncRCSeq</a>* encRCSeq, <span class="keywordtype">int</span> numPic )</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;{</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  <a class="code" href="classvvenc_1_1EncRCGOP.html#a3a80b6032f86a56bec74609034b3246f">destroy</a>();</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <span class="keywordtype">int</span> tgtBits = <a class="code" href="classvvenc_1_1EncRCGOP.html#a38746d97776368ee9ef0edfe8462fee9">xEstGOPTargetBits</a>( encRCSeq, numPic );</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  <span class="keywordtype">int</span> bitdepthLumaScale = 2 * ( encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ac77b590e38a8e565a52609ab911451d1">bitDepth</a> - 8 - <a class="code" href="TypeDef_8h.html#a29d5c9e713ec90b037a5aaa3865ccfa9">DISTORTION_PRECISION_ADJUSTMENT</a>( encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ac77b590e38a8e565a52609ab911451d1">bitDepth</a> ) );</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <a class="code" href="classvvenc_1_1EncRCGOP.html#a9fc04d1dbe9e90211adae22edf1aa4ea">minEstLambda</a> = 0.1;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  <a class="code" href="classvvenc_1_1EncRCGOP.html#a3a2e8b59f1816785bf9179457a42032a">maxEstLambda</a> = 10000.0 * pow( 2.0, bitdepthLumaScale );</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160; </div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  <span class="keywordflow">if</span> ( encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ab0af52bb2fd3511beea867ee60f1895c">adaptiveBits</a> &gt; 0 &amp;&amp; encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#aa921605b08e04dcf79d24564b00dcc84">lastLambda</a> &gt; 0.1 )</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  {</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keywordtype">double</span> targetBpp = (double)tgtBits / encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#aae0bdbf90049bf94c419c0918b5e1d3d">numberOfPixel</a>;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="keywordtype">double</span> basicLambda = 0.0;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="keywordtype">double</span>* lambdaRatio = <span class="keyword">new</span> <span class="keywordtype">double</span>[ encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ad0db87e2ca0c90c9609a9a82f52174a5">gopSize</a> ];</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keywordtype">double</span>* equaCoeffA = <span class="keyword">new</span> <span class="keywordtype">double</span>[ encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ad0db87e2ca0c90c9609a9a82f52174a5">gopSize</a> ];</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="keywordtype">double</span>* equaCoeffB = <span class="keyword">new</span> <span class="keywordtype">double</span>[ encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ad0db87e2ca0c90c9609a9a82f52174a5">gopSize</a> ];</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160; </div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    if ( encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ab0af52bb2fd3511beea867ee60f1895c">adaptiveBits</a> == 1 &amp;&amp; encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ad0db87e2ca0c90c9609a9a82f52174a5">gopSize</a> == 4 )   <span class="comment">// for GOP size = 4, low delay case</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    {</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;      <span class="keywordflow">if</span> ( encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#aa921605b08e04dcf79d24564b00dcc84">lastLambda</a> &lt; 120.0 )</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      {</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        lambdaRatio[ 1 ] = 0.725 * log( encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#aa921605b08e04dcf79d24564b00dcc84">lastLambda</a> ) + 0.5793;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        lambdaRatio[ 0 ] = 1.3 * lambdaRatio[ 1 ];</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        lambdaRatio[ 2 ] = 1.3 * lambdaRatio[ 1 ];</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        lambdaRatio[ 3 ] = 1.0;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;      }</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      {</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        lambdaRatio[ 0 ] = 5.0;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        lambdaRatio[ 1 ] = 4.0;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        lambdaRatio[ 2 ] = 5.0;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        lambdaRatio[ 3 ] = 1.0;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;      }</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    }</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ab0af52bb2fd3511beea867ee60f1895c">adaptiveBits</a> == 2 &amp;&amp; encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ad0db87e2ca0c90c9609a9a82f52174a5">gopSize</a> == 8 )  <span class="comment">// for GOP size = 8, random access case</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    {</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      <span class="keywordflow">if</span> ( encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#aa921605b08e04dcf79d24564b00dcc84">lastLambda</a> &lt; 90.0 )</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      {</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        lambdaRatio[ 0 ] = 1.0;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        lambdaRatio[ 1 ] = 0.725 * log( encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#aa921605b08e04dcf79d24564b00dcc84">lastLambda</a> ) + 0.7963;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        lambdaRatio[ 2 ] = 1.3 * lambdaRatio[ 1 ];</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        lambdaRatio[ 3 ] = 3.25 * lambdaRatio[ 1 ];</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        lambdaRatio[ 4 ] = 3.25 * lambdaRatio[ 1 ];</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        lambdaRatio[ 5 ] = 1.3  * lambdaRatio[ 1 ];</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        lambdaRatio[ 6 ] = 3.25 * lambdaRatio[ 1 ];</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        lambdaRatio[ 7 ] = 3.25 * lambdaRatio[ 1 ];</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      }</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      {</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        lambdaRatio[ 0 ] = 1.0;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        lambdaRatio[ 1 ] = 4.0;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        lambdaRatio[ 2 ] = 5.0;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        lambdaRatio[ 3 ] = 12.3;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        lambdaRatio[ 4 ] = 12.3;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        lambdaRatio[ 5 ] = 5.0;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        lambdaRatio[ 6 ] = 12.3;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        lambdaRatio[ 7 ] = 12.3;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;      }</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    }</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ab0af52bb2fd3511beea867ee60f1895c">adaptiveBits</a> == 2 &amp;&amp; encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ad0db87e2ca0c90c9609a9a82f52174a5">gopSize</a> == 16 )  <span class="comment">// for GOP size = 16, random access case</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    {</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> qdfParaLev2A = 0.5847;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> qdfParaLev2B = -0.0782;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> qdfParaLev3A = 0.5468;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> qdfParaLev3B = -0.1364;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> qdfParaLev4A = 0.6539;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> qdfParaLev4B = -0.203;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> qdfParaLev5A = 0.8623;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> qdfParaLev5B = -0.4676;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      <span class="keywordtype">double</span> qdfLev1Lev2 = Clip3( 0.12, 0.9, qdfParaLev2A * encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">picParam</a>[ 2 ].<a class="code" href="structvvenc_1_1TRCParameter.html#a37e8135dece9bf76f60832f12fc51cf8">skipRatio</a> + qdfParaLev2B );</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;      <span class="keywordtype">double</span> qdfLev1Lev3 = Clip3( 0.13, 0.9, qdfParaLev3A * encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">picParam</a>[ 3 ].<a class="code" href="structvvenc_1_1TRCParameter.html#a37e8135dece9bf76f60832f12fc51cf8">skipRatio</a> + qdfParaLev3B );</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      <span class="keywordtype">double</span> qdfLev1Lev4 = Clip3( 0.15, 0.9, qdfParaLev4A * encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">picParam</a>[ 4 ].<a class="code" href="structvvenc_1_1TRCParameter.html#a37e8135dece9bf76f60832f12fc51cf8">skipRatio</a> + qdfParaLev4B );</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      <span class="keywordtype">double</span> qdfLev1Lev5 = Clip3( 0.20, 0.9, qdfParaLev5A * encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">picParam</a>[ 5 ].<a class="code" href="structvvenc_1_1TRCParameter.html#a37e8135dece9bf76f60832f12fc51cf8">skipRatio</a> + qdfParaLev5B );</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      <span class="keywordtype">double</span> qdfLev2Lev3 = Clip3( 0.09, 0.9, qdfLev1Lev3 * ( 1 - qdfLev1Lev2 ) );</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      <span class="keywordtype">double</span> qdfLev2Lev4 = Clip3( 0.12, 0.9, qdfLev1Lev4 * ( 1 - qdfLev1Lev2 ) );</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      <span class="keywordtype">double</span> qdfLev2Lev5 = Clip3( 0.14, 0.9, qdfLev1Lev5 * ( 1 - qdfLev1Lev2 ) );</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;      <span class="keywordtype">double</span> qdfLev3Lev4 = Clip3( 0.06, 0.9, qdfLev1Lev4 * ( 1 - qdfLev1Lev3 ) );</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;      <span class="keywordtype">double</span> qdfLev3Lev5 = Clip3( 0.09, 0.9, qdfLev1Lev5 * ( 1 - qdfLev1Lev3 ) );</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      <span class="keywordtype">double</span> qdfLev4Lev5 = Clip3( 0.10, 0.9, qdfLev1Lev5 * ( 1 - qdfLev1Lev4 ) );</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160; </div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      <span class="keywordtype">double</span> lambdaLev1 = 1 / ( 1 + 2 * ( qdfLev1Lev2 + 2 * qdfLev1Lev3 + 4 * qdfLev1Lev4 + 8 * qdfLev1Lev5 ) );</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;      <span class="keywordtype">double</span> lambdaLev2 = 1 / ( 1 + ( 3 * qdfLev2Lev3 + 5 * qdfLev2Lev4 + 8 * qdfLev2Lev5 ) );</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      <span class="keywordtype">double</span> lambdaLev3 = 1 / ( 1 + 2 * qdfLev3Lev4 + 4 * qdfLev3Lev5 );</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      <span class="keywordtype">double</span> lambdaLev4 = 1 / ( 1 + 2 * qdfLev4Lev5 );</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;      <span class="keywordtype">double</span> lambdaLev5 = 1 / ( 1.0 );</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160; </div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;      lambdaRatio[ 0 ] = 1.0;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;      lambdaRatio[ 1 ] = lambdaLev2 / lambdaLev1;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;      lambdaRatio[ 2 ] = lambdaLev3 / lambdaLev1;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      lambdaRatio[ 3 ] = lambdaLev4 / lambdaLev1;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      lambdaRatio[ 4 ] = lambdaLev5 / lambdaLev1;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      lambdaRatio[ 5 ] = lambdaLev5 / lambdaLev1;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;      lambdaRatio[ 6 ] = lambdaLev4 / lambdaLev1;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      lambdaRatio[ 7 ] = lambdaLev5 / lambdaLev1;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;      lambdaRatio[ 8 ] = lambdaLev5 / lambdaLev1;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;      lambdaRatio[ 9 ] = lambdaLev3 / lambdaLev1;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;      lambdaRatio[ 10 ] = lambdaLev4 / lambdaLev1;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;      lambdaRatio[ 11 ] = lambdaLev5 / lambdaLev1;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      lambdaRatio[ 12 ] = lambdaLev5 / lambdaLev1;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      lambdaRatio[ 13 ] = lambdaLev4 / lambdaLev1;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;      lambdaRatio[ 14 ] = lambdaLev5 / lambdaLev1;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      lambdaRatio[ 15 ] = lambdaLev5 / lambdaLev1;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    }</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ab0af52bb2fd3511beea867ee60f1895c">adaptiveBits</a> == 2 &amp;&amp; encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ad0db87e2ca0c90c9609a9a82f52174a5">gopSize</a> == 32 ) <span class="comment">// for GOP size = 32, random access case</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    {</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> qdfParaLev2A = 0.7534;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> qdfParaLev2B = -0.0303;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> qdfParaLev3A = 0.7044;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> qdfParaLev3B = -0.0445;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> qdfParaLev4A = 0.7084;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> qdfParaLev4B = -0.1401;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> qdfParaLev5A = 0.8844;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> qdfParaLev5B = -0.3676;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> qdfParaLev6A = 1.2336;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> qdfParaLev6B = -0.7511;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160; </div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;      <span class="keywordtype">double</span> qdfLev1Lev2 = Clip3( 0.12, 0.9, qdfParaLev2A * encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">picParam</a>[ 2 ].<a class="code" href="structvvenc_1_1TRCParameter.html#a37e8135dece9bf76f60832f12fc51cf8">skipRatio</a> + qdfParaLev2B );</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;      <span class="keywordtype">double</span> qdfLev1Lev3 = Clip3( 0.13, 0.9, qdfParaLev3A * encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">picParam</a>[ 3 ].<a class="code" href="structvvenc_1_1TRCParameter.html#a37e8135dece9bf76f60832f12fc51cf8">skipRatio</a> + qdfParaLev3B );</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;      <span class="keywordtype">double</span> qdfLev1Lev4 = Clip3( 0.15, 0.9, qdfParaLev4A * encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">picParam</a>[ 4 ].<a class="code" href="structvvenc_1_1TRCParameter.html#a37e8135dece9bf76f60832f12fc51cf8">skipRatio</a> + qdfParaLev4B );</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;      <span class="keywordtype">double</span> qdfLev1Lev5 = Clip3( 0.20, 0.9, qdfParaLev5A * encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">picParam</a>[ 5 ].<a class="code" href="structvvenc_1_1TRCParameter.html#a37e8135dece9bf76f60832f12fc51cf8">skipRatio</a> + qdfParaLev5B );</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;      <span class="keywordtype">double</span> qdfLev1Lev6 = Clip3( 0.25, 0.9, qdfParaLev6A * encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">picParam</a>[ 6 ].<a class="code" href="structvvenc_1_1TRCParameter.html#a37e8135dece9bf76f60832f12fc51cf8">skipRatio</a> + qdfParaLev6B );</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160; </div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;      <span class="keywordtype">double</span> qdfLev2Lev3 = Clip3( 0.09, 0.9, qdfLev1Lev3 * ( 1 - qdfLev1Lev2 ) );</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;      <span class="keywordtype">double</span> qdfLev2Lev4 = Clip3( 0.12, 0.9, qdfLev1Lev4 * ( 1 - qdfLev1Lev2 ) );</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;      <span class="keywordtype">double</span> qdfLev2Lev5 = Clip3( 0.14, 0.9, qdfLev1Lev5 * ( 1 - qdfLev1Lev2 ) );</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;      <span class="keywordtype">double</span> qdfLev2Lev6 = Clip3( 0.16, 0.9, qdfLev1Lev6 * ( 1 - qdfLev1Lev2 ) );</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;      <span class="keywordtype">double</span> qdfLev3Lev4 = Clip3( 0.06, 0.9, qdfLev1Lev4 * ( 1 - qdfLev1Lev3 ) );</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;      <span class="keywordtype">double</span> qdfLev3Lev5 = Clip3( 0.09, 0.9, qdfLev1Lev5 * ( 1 - qdfLev1Lev3 ) );</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;      <span class="keywordtype">double</span> qdfLev3Lev6 = Clip3( 0.10, 0.9, qdfLev1Lev6 * ( 1 - qdfLev1Lev3 ) );</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;      <span class="keywordtype">double</span> qdfLev4Lev5 = Clip3( 0.10, 0.9, qdfLev1Lev5 * ( 1 - qdfLev1Lev4 ) );</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;      <span class="keywordtype">double</span> qdfLev4Lev6 = Clip3( 0.10, 0.9, qdfLev1Lev6 * ( 1 - qdfLev1Lev4 ) );</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;      <span class="keywordtype">double</span> qdfLev5Lev6 = Clip3( 0.12, 0.9, qdfLev1Lev6 * ( 1 - qdfLev1Lev5 ) );</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160; </div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      <span class="keywordtype">double</span> lambdaLev1 = 1 / ( 1 + 2 * qdfLev1Lev2 + 4 * qdfLev1Lev3 + 6 * qdfLev1Lev4 + 8 * qdfLev1Lev5 + 10 * qdfLev1Lev6 );</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      <span class="keywordtype">double</span> lambdaLev2 = 1 / ( 1 + 3 * qdfLev2Lev3 + 5 * qdfLev2Lev4 + 8 * qdfLev2Lev5 + 9 * qdfLev2Lev6 );</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      <span class="keywordtype">double</span> lambdaLev3 = 1 / ( 1 + 2 * qdfLev3Lev4 + 4 * qdfLev3Lev5 + 6 * qdfLev3Lev6 );</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;      <span class="keywordtype">double</span> lambdaLev4 = 1 / ( 1 + 2 * qdfLev4Lev5 + 4 * qdfLev4Lev6 );</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;      <span class="keywordtype">double</span> lambdaLev5 = 1 / ( 1 + 2 * qdfLev5Lev6 );</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;      <span class="keywordtype">double</span> lambdaLev6 = 1 / ( 1.0 );</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160; </div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      lambdaRatio[ 0 ] = 1.0;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      lambdaRatio[ 1 ] = lambdaLev2 / lambdaLev1;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;      lambdaRatio[ 2 ] = lambdaLev3 / lambdaLev1;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;      lambdaRatio[ 3 ] = lambdaLev4 / lambdaLev1;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      lambdaRatio[ 4 ] = lambdaLev5 / lambdaLev1;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;      lambdaRatio[ 5 ] = lambdaLev6 / lambdaLev1;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;      lambdaRatio[ 6 ] = lambdaLev6 / lambdaLev1;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;      lambdaRatio[ 7 ] = lambdaLev5 / lambdaLev1;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;      lambdaRatio[ 8 ] = lambdaLev6 / lambdaLev1;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;      lambdaRatio[ 9 ] = lambdaLev6 / lambdaLev1;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;      lambdaRatio[ 10 ] = lambdaLev4 / lambdaLev1;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;      lambdaRatio[ 11 ] = lambdaLev5 / lambdaLev1;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;      lambdaRatio[ 12 ] = lambdaLev6 / lambdaLev1;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;      lambdaRatio[ 13 ] = lambdaLev6 / lambdaLev1;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;      lambdaRatio[ 14 ] = lambdaLev5 / lambdaLev1;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;      lambdaRatio[ 15 ] = lambdaLev6 / lambdaLev1;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;      lambdaRatio[ 16 ] = lambdaLev6 / lambdaLev1;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;      lambdaRatio[ 17 ] = lambdaLev3 / lambdaLev1;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      lambdaRatio[ 18 ] = lambdaLev4 / lambdaLev1;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;      lambdaRatio[ 19 ] = lambdaLev5 / lambdaLev1;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;      lambdaRatio[ 20 ] = lambdaLev6 / lambdaLev1;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;      lambdaRatio[ 21 ] = lambdaLev6 / lambdaLev1;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      lambdaRatio[ 22 ] = lambdaLev5 / lambdaLev1;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      lambdaRatio[ 23 ] = lambdaLev6 / lambdaLev1;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;      lambdaRatio[ 24 ] = lambdaLev6 / lambdaLev1;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;      lambdaRatio[ 25 ] = lambdaLev4 / lambdaLev1;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;      lambdaRatio[ 26 ] = lambdaLev5 / lambdaLev1;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;      lambdaRatio[ 27 ] = lambdaLev6 / lambdaLev1;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      lambdaRatio[ 28 ] = lambdaLev6 / lambdaLev1;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;      lambdaRatio[ 29 ] = lambdaLev5 / lambdaLev1;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;      lambdaRatio[ 30 ] = lambdaLev6 / lambdaLev1;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;      lambdaRatio[ 31 ] = lambdaLev6 / lambdaLev1;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    }</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160; </div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <a class="code" href="classvvenc_1_1EncRCGOP.html#a28145de951dbb6373090a892b7869eff">xCalEquaCoeff</a>( encRCSeq, lambdaRatio, equaCoeffA, equaCoeffB, encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ad0db87e2ca0c90c9609a9a82f52174a5">gopSize</a> );</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    basicLambda = <a class="code" href="classvvenc_1_1EncRCGOP.html#a5616af21697c6fbd66212a2ef31035fc">xSolveEqua</a>( encRCSeq, targetBpp, equaCoeffA, equaCoeffB, encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ad0db87e2ca0c90c9609a9a82f52174a5">gopSize</a> );</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a541a5402f3f9aa808585ae50807253e4">setAllBitRatio</a>( basicLambda, equaCoeffA, equaCoeffB );</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160; </div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="keyword">delete</span>[]lambdaRatio;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="keyword">delete</span>[]equaCoeffA;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="keyword">delete</span>[]equaCoeffB;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  }</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160; </div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  <a class="code" href="classvvenc_1_1EncRCGOP.html#a605565fdf0a219dff93994674ba113e9">picTargetBitInGOP</a> = <span class="keyword">new</span> <span class="keywordtype">int</span>[ numPic ];</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  <span class="keywordtype">int</span> totalPicRatio = 0;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  <span class="keywordtype">int</span> currPicRatio = 0;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  <span class="keywordflow">for</span> ( i = 0; i &lt; numPic; i++ )</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  {</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    totalPicRatio += encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a8fef0bac5e1611ffdb8b0b437ea98d8b">bitsRatio</a>[ i ];</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  }</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  <span class="keywordflow">for</span> ( i = 0; i &lt; numPic; i++ )</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  {</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    currPicRatio = encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a8fef0bac5e1611ffdb8b0b437ea98d8b">bitsRatio</a>[ i ];</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <a class="code" href="classvvenc_1_1EncRCGOP.html#a605565fdf0a219dff93994674ba113e9">picTargetBitInGOP</a>[ i ] = (int)( ( (<span class="keywordtype">double</span>)tgtBits ) * currPicRatio / totalPicRatio );</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  }</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160; </div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  <a class="code" href="classvvenc_1_1EncRCGOP.html#a011b1e71a29b3f4cf510174141783c64">encRcSeq</a>     = encRCSeq;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  <a class="code" href="classvvenc_1_1EncRCGOP.html#aaaa6ab10c878338e74a04f5ca10b0fbb">numPics</a>      = numPic;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  <a class="code" href="classvvenc_1_1EncRCGOP.html#a4973b73ee65d239c9bec2f8bf78846a3">targetBits</a>   = tgtBits;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  <a class="code" href="classvvenc_1_1EncRCGOP.html#a4c47890a64ad759a83b19844a364d7d5">picsLeft</a>     = <a class="code" href="classvvenc_1_1EncRCGOP.html#aaaa6ab10c878338e74a04f5ca10b0fbb">numPics</a>;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  <a class="code" href="classvvenc_1_1EncRCGOP.html#a7192b8cd46d8604a40846c7a736b84fe">bitsLeft</a>     = <a class="code" href="classvvenc_1_1EncRCGOP.html#a4973b73ee65d239c9bec2f8bf78846a3">targetBits</a>;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;}</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160; </div>
<div class="line"><a name="l00500"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCGOP.html#a3a80b6032f86a56bec74609034b3246f">  500</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvvenc_1_1EncRCGOP.html#a3a80b6032f86a56bec74609034b3246f">EncRCGOP::destroy</a>()</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;{</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  <a class="code" href="classvvenc_1_1EncRCGOP.html#a011b1e71a29b3f4cf510174141783c64">encRcSeq</a> = <a class="code" href="CommonDef_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  <span class="keywordflow">if</span> ( <a class="code" href="classvvenc_1_1EncRCGOP.html#a605565fdf0a219dff93994674ba113e9">picTargetBitInGOP</a> != <a class="code" href="CommonDef_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> )</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  {</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="keyword">delete</span>[] <a class="code" href="classvvenc_1_1EncRCGOP.html#a605565fdf0a219dff93994674ba113e9">picTargetBitInGOP</a>;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <a class="code" href="classvvenc_1_1EncRCGOP.html#a605565fdf0a219dff93994674ba113e9">picTargetBitInGOP</a> = <a class="code" href="CommonDef_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  }</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;}</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160; </div>
<div class="line"><a name="l00510"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCGOP.html#a28145de951dbb6373090a892b7869eff">  510</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvvenc_1_1EncRCGOP.html#a28145de951dbb6373090a892b7869eff">EncRCGOP::xCalEquaCoeff</a>( <a class="code" href="classvvenc_1_1EncRCSeq.html">EncRCSeq</a>* encRCSeq, <span class="keywordtype">double</span>* lambdaRatio, <span class="keywordtype">double</span>* equaCoeffA, <span class="keywordtype">double</span>* equaCoeffB, <span class="keywordtype">int</span> GOPSize )</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;{</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i&lt;GOPSize; i++ )</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  {</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <span class="keywordtype">int</span> frameLevel = encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a73b2bf1e6352c4dd8c524005a8b14081">gopID2Level</a>[ i ];</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="keywordtype">double</span> alpha = encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">picParam</a>[ frameLevel ].<a class="code" href="structvvenc_1_1TRCParameter.html#a20f4c4490bc8ecbdd1ffcb79acce6035">alpha</a>;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="keywordtype">double</span> beta = encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">picParam</a>[ frameLevel ].<a class="code" href="structvvenc_1_1TRCParameter.html#a9424343761f8c4f4c1afe8f5b6bf471b">beta</a>;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    equaCoeffA[ i ] = pow( 1.0 / alpha, 1.0 / beta ) * pow( lambdaRatio[ i ], 1.0 / beta );</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    equaCoeffB[ i ] = 1.0 / beta;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  }</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;}</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160; </div>
<div class="line"><a name="l00522"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCGOP.html#a5616af21697c6fbd66212a2ef31035fc">  522</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="classvvenc_1_1EncRCGOP.html#a5616af21697c6fbd66212a2ef31035fc">EncRCGOP::xSolveEqua</a>( <a class="code" href="classvvenc_1_1EncRCSeq.html">EncRCSeq</a>* encRCSeq, <span class="keywordtype">double</span> targetBpp, <span class="keywordtype">double</span>* equaCoeffA, <span class="keywordtype">double</span>* equaCoeffB, <span class="keywordtype">int</span> GOPSize )</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;{</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  <span class="keywordtype">double</span> solution = 100.0;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  <span class="keywordtype">double</span> minNumber = <a class="code" href="classvvenc_1_1EncRCGOP.html#a9fc04d1dbe9e90211adae22edf1aa4ea">minEstLambda</a>;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  <span class="keywordtype">double</span> maxNumber = <a class="code" href="classvvenc_1_1EncRCGOP.html#a3a2e8b59f1816785bf9179457a42032a">maxEstLambda</a>;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="namespacevvenc.html#ad8687adca4e586b6da300600d9fb022b">RC_ITERATION_NUM</a>; i++ )</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  {</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <span class="keywordtype">double</span> fx = 0.0;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> j = 0; j &lt; GOPSize; j++ )</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    {</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      <span class="keywordtype">double</span> tmpBpp = equaCoeffA[ j ] * pow( solution, equaCoeffB[ j ] );</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;      <span class="keywordtype">double</span> actualBpp = tmpBpp * (double)encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">picParam</a>[ encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a73b2bf1e6352c4dd8c524005a8b14081">gopID2Level</a>[ j ] ].<a class="code" href="structvvenc_1_1TRCParameter.html#a0c2c12d17099a37f01345fcab95a7ebf">validPix</a> / (<span class="keywordtype">double</span>)encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#aae0bdbf90049bf94c419c0918b5e1d3d">numberOfPixel</a>;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;      fx += actualBpp;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    }</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160; </div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <span class="keywordflow">if</span> ( fabs( fx - targetBpp ) &lt; 0.000001 )</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    {</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    }</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160; </div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="keywordflow">if</span> ( fx &gt; targetBpp )</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    {</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;      minNumber = solution;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      solution = ( solution + maxNumber ) / 2.0;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    }</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    {</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;      maxNumber = solution;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;      solution = ( solution + minNumber ) / 2.0;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    }</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  }</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160; </div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  solution = Clip3( <a class="code" href="classvvenc_1_1EncRCGOP.html#a9fc04d1dbe9e90211adae22edf1aa4ea">minEstLambda</a>, <a class="code" href="classvvenc_1_1EncRCGOP.html#a3a2e8b59f1816785bf9179457a42032a">maxEstLambda</a>, solution );</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  <span class="keywordflow">return</span> solution;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;}</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160; </div>
<div class="line"><a name="l00558"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCGOP.html#a1c0b9204320936cee8de0940ee484836">  558</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvvenc_1_1EncRCGOP.html#a1c0b9204320936cee8de0940ee484836">EncRCGOP::updateAfterPicture</a>( <span class="keywordtype">int</span> bitsCost )</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;{</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  <a class="code" href="classvvenc_1_1EncRCGOP.html#a7192b8cd46d8604a40846c7a736b84fe">bitsLeft</a> -= bitsCost;</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  <a class="code" href="classvvenc_1_1EncRCGOP.html#a4c47890a64ad759a83b19844a364d7d5">picsLeft</a>--;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;}</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160; </div>
<div class="line"><a name="l00564"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCGOP.html#a38746d97776368ee9ef0edfe8462fee9">  564</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classvvenc_1_1EncRCGOP.html#a38746d97776368ee9ef0edfe8462fee9">EncRCGOP::xEstGOPTargetBits</a>( <a class="code" href="classvvenc_1_1EncRCSeq.html">EncRCSeq</a>* encRCSeq, <span class="keywordtype">int</span> GOPSize )</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;{</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  <span class="keywordtype">int</span> realInfluencePicture = encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a0186bee82f4d469206cfcb18da843a46">totalFrames</a> &gt; 0 ? std::min( 8 &lt; encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a75852d45ae317ffce5daf5eb321b167a">intraPeriod</a> ? encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a75852d45ae317ffce5daf5eb321b167a">intraPeriod</a> + encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ad0db87e2ca0c90c9609a9a82f52174a5">gopSize</a> : <a class="code" href="namespacevvenc.html#abab5f5527b53cf619014a22589afe4ce">RC_SMOOTH_WINDOW_SIZE</a>, encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a3c7e7f3985dc338448fcb2c5b5ad43c5">framesLeft</a> ) :</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                                                             ( 8 &lt; encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a75852d45ae317ffce5daf5eb321b167a">intraPeriod</a> ? encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a75852d45ae317ffce5daf5eb321b167a">intraPeriod</a> + encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ad0db87e2ca0c90c9609a9a82f52174a5">gopSize</a> : <a class="code" href="namespacevvenc.html#abab5f5527b53cf619014a22589afe4ce">RC_SMOOTH_WINDOW_SIZE</a> );</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  <span class="keywordtype">double</span> averageTargetBitsPerPic = ( (double)( encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a4fd2f41f944b9e6ffa3df9815904bed8">targetRate</a> ) / encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#aebcd9a87b695d3618612fcba5248dbf8">frameRate</a> );</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  <span class="keywordtype">int</span> currentTargetBitsPerPic = (int)( ( averageTargetBitsPerPic * ( encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#aa03c2b87d895da2089dcc9e5448b7cd2">framesCoded</a> + realInfluencePicture ) - encRCSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a593aab4c0ea65f4f654fa7f6031fb0b7">bitsUsed</a> ) / realInfluencePicture );</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="classvvenc_1_1EncRCGOP.html#a4973b73ee65d239c9bec2f8bf78846a3">targetBits</a> = currentTargetBitsPerPic * GOPSize;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160; </div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;  <span class="keywordflow">if</span> ( <a class="code" href="classvvenc_1_1EncRCGOP.html#a4973b73ee65d239c9bec2f8bf78846a3">targetBits</a> &lt; 200 )</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;  {</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <a class="code" href="classvvenc_1_1EncRCGOP.html#a4973b73ee65d239c9bec2f8bf78846a3">targetBits</a> = 200;   <span class="comment">// at least allocate 200 bits for one GOP</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  }</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160; </div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classvvenc_1_1EncRCGOP.html#a4973b73ee65d239c9bec2f8bf78846a3">targetBits</a>;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;}</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160; </div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="comment">//picture level</span></div>
<div class="line"><a name="l00581"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCPic.html#ab860e42c655773f0dd240021634c82fd">  581</a></span>&#160;<a class="code" href="classvvenc_1_1EncRCPic.html#ab860e42c655773f0dd240021634c82fd">EncRCPic::EncRCPic</a>()</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;{</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>            = <a class="code" href="CommonDef_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#a2b5fcef61b77355d86a065adc308528e">encRCGOP</a>            = <a class="code" href="CommonDef_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160; </div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a>          = 0;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#aae0bdbf90049bf94c419c0918b5e1d3d">numberOfPixel</a>       = 0;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#a516a779a4b162eddb49c63d03b75c2a9">numberOfLCU</a>         = 0;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#a4973b73ee65d239c9bec2f8bf78846a3">targetBits</a>          = 0;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#ac606af1acdd996fe1ca1412f488ce4c6">tmpTargetBits</a>       = 0;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#a86196082d72456b391de178e660a33d9">estHeaderBits</a>       = 0;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#a448f06230945693b43ea3f8783d20368">picQPOffsetQPA</a>      = 0;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#ad12b85ecb08a85ac22bfdc05046798fd">picLambdaOffsetQPA</a>  = 0.0;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#a7192b8cd46d8604a40846c7a736b84fe">bitsLeft</a>            = 0;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#a3be042b10e524d82819aeb3276035847">lcu</a>                 = <a class="code" href="CommonDef_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#aa88894359f052c7c1759e3cb7e0ad34b">picActualHeaderBits</a> = 0;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#af07f2ed00b0ed8af5fc86acaf0e2f503">picActualBits</a>       = 0;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#a439f1eea14cde0384fd9a48d8fcda8f8">picQP</a>               = 0;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#ae9bfbf4ef5133ec729ce28146b0ff549">picLambda</a>           = 0.0;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#a26b5d3262aa716d856c03490baad4093">picMSE</a>              = 0.0;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#a99e631187ad969a67befaf60f7f441f3">totalCostIntra</a>      = 0.0;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#aa63b95dd79aafa6698666c048ac5434d">validPixelsInPic</a>    = 0;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#a8ee188ba629e2bc115c79d56277fe406">isNewScene</a>          = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#a27f637ec99a55ae334338affeca0e1d7">refreshParams</a>       = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#aac8f73a2e299ae450db271221a4ea0d8">finalLambda</a>         = 0.0;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#abea87655520aaef3b850c3d61a1f4a31">estimatedBits</a>       = 0;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;}</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160; </div>
<div class="line"><a name="l00609"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCPic.html#a837317a783801d79f6d65bedc161996c">  609</a></span>&#160;<a class="code" href="classvvenc_1_1EncRCPic.html#a837317a783801d79f6d65bedc161996c">EncRCPic::~EncRCPic</a>()</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;{</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#a3a80b6032f86a56bec74609034b3246f">destroy</a>();</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;}</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160; </div>
<div class="line"><a name="l00614"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCPic.html#a5b8331b9cbb85b083e680987df4bb539">  614</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classvvenc_1_1EncRCPic.html#a5b8331b9cbb85b083e680987df4bb539">EncRCPic::xEstPicTargetBits</a>( <a class="code" href="classvvenc_1_1EncRCSeq.html">EncRCSeq</a>* encRcSeq, <a class="code" href="classvvenc_1_1EncRCGOP.html">EncRCGOP</a>* encRcGOP, <span class="keywordtype">int</span> frameLevel )</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;{</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="classvvenc_1_1EncRCPic.html#a4973b73ee65d239c9bec2f8bf78846a3">targetBits</a>    = 0;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160; </div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  <span class="comment">// bit allocation for 1-pass RC</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;  <span class="keywordflow">if</span> (!encRcSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a306c1d7f4f6833176d12c84d77b9b412">twoPass</a>)</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;  {</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <span class="keywordtype">int</span> GOPbitsLeft   = encRcGOP-&gt;<a class="code" href="classvvenc_1_1EncRCGOP.html#a7192b8cd46d8604a40846c7a736b84fe">bitsLeft</a>;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="keywordtype">int</span> currPicRatio  = encRcSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a8fef0bac5e1611ffdb8b0b437ea98d8b">bitsRatio</a>[ <a class="code" href="classvvenc_1_1EncRCPic.html#a166b361eddf214b13bba8bb03218a165">rcIdxInGop</a> ];</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="keywordtype">int</span> totalPicRatio = 0;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160; </div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = <a class="code" href="classvvenc_1_1EncRCPic.html#a166b361eddf214b13bba8bb03218a165">rcIdxInGop</a>; i &lt; encRcGOP-&gt;<a class="code" href="classvvenc_1_1EncRCGOP.html#aaaa6ab10c878338e74a04f5ca10b0fbb">numPics</a>; i++ )</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    {</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;      totalPicRatio += encRcSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a8fef0bac5e1611ffdb8b0b437ea98d8b">bitsRatio</a>[ i ];</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    }</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160; </div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <a class="code" href="classvvenc_1_1EncRCPic.html#a4973b73ee65d239c9bec2f8bf78846a3">targetBits</a>  = int( ((<span class="keywordtype">double</span>)GOPbitsLeft) * currPicRatio / totalPicRatio );</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160; </div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="classvvenc_1_1EncRCPic.html#a4973b73ee65d239c9bec2f8bf78846a3">targetBits</a> &lt; 100 )</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    {</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;      <a class="code" href="classvvenc_1_1EncRCPic.html#a4973b73ee65d239c9bec2f8bf78846a3">targetBits</a> = 100;   <span class="comment">// at least allocate 100 bits for one picture</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    }</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160; </div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <span class="keywordflow">if</span> ( encRcSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a3c7e7f3985dc338448fcb2c5b5ad43c5">framesLeft</a> &gt; encRcSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ad0db87e2ca0c90c9609a9a82f52174a5">gopSize</a> || encRcSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a0186bee82f4d469206cfcb18da843a46">totalFrames</a> &lt; 1 )</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    {</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;      <a class="code" href="classvvenc_1_1EncRCPic.html#a4973b73ee65d239c9bec2f8bf78846a3">targetBits</a> = int( <a class="code" href="namespacevvenc.html#ae9917093a0722aff03da51244f550870">RC_WEIGHT_PIC_TARGET_BIT_IN_BUFFER</a> * <a class="code" href="classvvenc_1_1EncRCPic.html#a4973b73ee65d239c9bec2f8bf78846a3">targetBits</a> + <a class="code" href="namespacevvenc.html#a44f3c28eeb9a80d6ee44649e201a17fe">RC_WEIGHT_PIC_TARGET_BIT_IN_GOP</a> * <a class="code" href="classvvenc_1_1EncRCPic.html#a2b5fcef61b77355d86a065adc308528e">encRCGOP</a>-&gt;<a class="code" href="classvvenc_1_1EncRCGOP.html#a605565fdf0a219dff93994674ba113e9">picTargetBitInGOP</a>[ <a class="code" href="classvvenc_1_1EncRCPic.html#a166b361eddf214b13bba8bb03218a165">rcIdxInGop</a> ] );</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    }</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;  } <span class="comment">// !twoPass</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160; </div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;  <span class="comment">// bit allocation for 2-pass RC</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;  <span class="keywordflow">if</span> (encRcSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a306c1d7f4f6833176d12c84d77b9b412">twoPass</a>)</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;  {</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <span class="keywordtype">double</span> frameVsGopRatio = 1.0;</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160; </div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    encRcSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a7c166c40a06c904af730175d13d28cd9">getTargetBitsFromFirstPass</a> (<a class="code" href="classvvenc_1_1EncRCPic.html#af1fa96a850f404aded578d3e29dedbcb">poc</a>, <a class="code" href="classvvenc_1_1EncRCPic.html#ac606af1acdd996fe1ca1412f488ce4c6">tmpTargetBits</a>, frameVsGopRatio, <a class="code" href="classvvenc_1_1EncRCPic.html#a8ee188ba629e2bc115c79d56277fe406">isNewScene</a>, <a class="code" href="classvvenc_1_1EncRCPic.html#a27f637ec99a55ae334338affeca0e1d7">refreshParams</a>);</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160; </div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <span class="comment">// calculate the difference of under/overspent bits and adjust the current target bits based on the GOP and frame ratio for every frame</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <a class="code" href="classvvenc_1_1EncRCPic.html#a4973b73ee65d239c9bec2f8bf78846a3">targetBits</a> = int (0.5 + <a class="code" href="classvvenc_1_1EncRCPic.html#ac606af1acdd996fe1ca1412f488ce4c6">tmpTargetBits</a> + (encRcSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a250403b84afe6f3ee74581c633dd5132">estimatedBitUsage</a> - encRcSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a593aab4c0ea65f4f654fa7f6031fb0b7">bitsUsed</a>) * 0.5 * frameVsGopRatio);</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;  }</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160; </div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classvvenc_1_1EncRCPic.html#a4973b73ee65d239c9bec2f8bf78846a3">targetBits</a>;</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;}</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160; </div>
<div class="line"><a name="l00657"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCPic.html#aa470ccbdde4a57b091141064d29317a2">  657</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classvvenc_1_1EncRCPic.html#aa470ccbdde4a57b091141064d29317a2">EncRCPic::xEstPicHeaderBits</a>( std::list&lt;EncRCPic*&gt;&amp; listPreviousPictures, <span class="keywordtype">int</span> frameLevel )</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;{</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;  <span class="keywordtype">int</span> numPreviousPics   = 0;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  <span class="keywordtype">int</span> totalPreviousBits = 0;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160; </div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  std::list&lt;EncRCPic*&gt;::iterator it;</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  <span class="keywordflow">for</span> ( it = listPreviousPictures.begin(); it != listPreviousPictures.end(); it++ )</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;  {</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    <span class="keywordflow">if</span> ( (*it)-&gt;frameLevel == <a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a> )</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    {</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;      totalPreviousBits += (*it)-&gt;picActualHeaderBits;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      numPreviousPics++;</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    }</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;  }</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160; </div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;  <span class="keywordtype">int</span> estHeadBits = 0;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  <span class="keywordflow">if</span> ( numPreviousPics &gt; 0 )</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  {</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    estHeadBits = totalPreviousBits / numPreviousPics;</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;  }</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160; </div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;  <span class="keywordflow">return</span> estHeadBits;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;}</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160; </div>
<div class="line"><a name="l00681"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCPic.html#a087473d0c392a106ef9922f5b866428e">  681</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvvenc_1_1EncRCPic.html#a087473d0c392a106ef9922f5b866428e">EncRCPic::addToPictureList</a>( std::list&lt;EncRCPic*&gt;&amp; listPreviousPictures )</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;{</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;  <span class="keywordflow">if</span> ( listPreviousPictures.size() &gt; <a class="code" href="namespacevvenc.html#a6afe46d36eebf50617b754793260c5f3">RC_MAX_PIC_LIST_SIZE</a> )</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  {</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <a class="code" href="classvvenc_1_1EncRCPic.html">EncRCPic</a>* p = listPreviousPictures.front();</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    listPreviousPictures.pop_front();</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    p-&gt;<a class="code" href="classvvenc_1_1EncRCPic.html#a3a80b6032f86a56bec74609034b3246f">destroy</a>();</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <span class="keyword">delete</span> p;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  }</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160; </div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;  listPreviousPictures.push_back( <span class="keyword">this</span> );</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;}</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160; </div>
<div class="line"><a name="l00694"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCPic.html#a9cb092466959de4b4a18609dc1499e45">  694</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvvenc_1_1EncRCPic.html#a9cb092466959de4b4a18609dc1499e45">EncRCPic::create</a>( <a class="code" href="classvvenc_1_1EncRCSeq.html">EncRCSeq</a>* encRcSeq, <a class="code" href="classvvenc_1_1EncRCGOP.html">EncRCGOP</a>* encRcGOP, <span class="keywordtype">int</span> frameLvl, <span class="keywordtype">int</span> framePoc, <span class="keywordtype">int</span> frameRcIdxInGop, std::list&lt;EncRCPic*&gt;&amp; listPreviousPictures )</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;{</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#a3a80b6032f86a56bec74609034b3246f">destroy</a>();</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>   = encRcSeq;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#a2b5fcef61b77355d86a065adc308528e">encRCGOP</a>   = encRcGOP;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#af1fa96a850f404aded578d3e29dedbcb">poc</a>        = framePoc;</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#a166b361eddf214b13bba8bb03218a165">rcIdxInGop</a> = frameRcIdxInGop;</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160; </div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;  <span class="keywordtype">int</span> tgtBits    = <a class="code" href="classvvenc_1_1EncRCPic.html#a5b8331b9cbb85b083e680987df4bb539">xEstPicTargetBits</a>( encRcSeq, encRcGOP, frameLvl );</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;  <span class="keywordtype">int</span> estHeadBits = <a class="code" href="classvvenc_1_1EncRCPic.html#aa470ccbdde4a57b091141064d29317a2">xEstPicHeaderBits</a>( listPreviousPictures, frameLvl );</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160; </div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;  <span class="keywordflow">if</span> (encRcSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a306c1d7f4f6833176d12c84d77b9b412">twoPass</a>)</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;  {</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    tgtBits = std::max (1, tgtBits);</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;  }</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( tgtBits &lt; estHeadBits + 100 )</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;  {</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    tgtBits = estHeadBits + 100;   <span class="comment">// at least allocate 100 bits for picture data</span></div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;  }</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160; </div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a>       = frameLvl;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#aae0bdbf90049bf94c419c0918b5e1d3d">numberOfPixel</a>    = encRcSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#aae0bdbf90049bf94c419c0918b5e1d3d">numberOfPixel</a>;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#a516a779a4b162eddb49c63d03b75c2a9">numberOfLCU</a>      = encRcSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a516a779a4b162eddb49c63d03b75c2a9">numberOfLCU</a>;</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#a4973b73ee65d239c9bec2f8bf78846a3">targetBits</a>       = tgtBits;</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#a86196082d72456b391de178e660a33d9">estHeaderBits</a>    = estHeadBits;</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#a7192b8cd46d8604a40846c7a736b84fe">bitsLeft</a>         = <a class="code" href="classvvenc_1_1EncRCPic.html#a4973b73ee65d239c9bec2f8bf78846a3">targetBits</a>;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#abea87655520aaef3b850c3d61a1f4a31">estimatedBits</a>    = <a class="code" href="classvvenc_1_1EncRCPic.html#a4973b73ee65d239c9bec2f8bf78846a3">targetBits</a>;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;  <span class="keywordtype">int</span> picWidth       = encRcSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ab13b9106f285947f00b2801086096701">picWidth</a>;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;  <span class="keywordtype">int</span> picHeight      = encRcSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#abc77673ab15d1f85309626e27061db57">picHeight</a>;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;  <span class="keywordtype">int</span> LCUWidth       = encRcSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ab3bd8609092be43aa7654c97fb5aa668">lcuWidth</a>;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;  <span class="keywordtype">int</span> LCUHeight      = encRcSeq-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a4e3179468eeee6f92e2a0641290fe74c">lcuHeight</a>;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;  <span class="keywordtype">int</span> picWidthInLCU  = ( picWidth  % LCUWidth  ) == 0 ? picWidth  / LCUWidth  : picWidth  / LCUWidth  + 1;</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;  <span class="keywordtype">int</span> picHeightInLCU = ( picHeight % LCUHeight ) == 0 ? picHeight / LCUHeight : picHeight / LCUHeight + 1;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160; </div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#a7192b8cd46d8604a40846c7a736b84fe">bitsLeft</a>       -= <a class="code" href="classvvenc_1_1EncRCPic.html#a86196082d72456b391de178e660a33d9">estHeaderBits</a>;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160; </div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#a3be042b10e524d82819aeb3276035847">lcu</a> = <span class="keyword">new</span> <a class="code" href="structvvenc_1_1TRCLCU.html">TRCLCU</a>[ <a class="code" href="classvvenc_1_1EncRCPic.html#a516a779a4b162eddb49c63d03b75c2a9">numberOfLCU</a> ];</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;  <span class="keywordtype">int</span> LCUIdx;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;  <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; picWidthInLCU; i++ )</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;  {</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> j = 0; j &lt; picHeightInLCU; j++ )</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    {</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;      LCUIdx = j * picWidthInLCU + i;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;      <a class="code" href="classvvenc_1_1EncRCPic.html#a3be042b10e524d82819aeb3276035847">lcu</a>[ LCUIdx ].<a class="code" href="structvvenc_1_1TRCLCU.html#ad6f0bebdd354df4050cdb476d94f9db1">actualSSE</a> = 0.0;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      <a class="code" href="classvvenc_1_1EncRCPic.html#a3be042b10e524d82819aeb3276035847">lcu</a>[ LCUIdx ].<a class="code" href="structvvenc_1_1TRCLCU.html#a7ae450af8cebf1f528a9a738c2cd6531">actualMSE</a> = 0.0;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;      <a class="code" href="classvvenc_1_1EncRCPic.html#a3be042b10e524d82819aeb3276035847">lcu</a>[ LCUIdx ].<a class="code" href="structvvenc_1_1TRCLCU.html#a3db359547eed8cfd48ca821d95f577af">lambda</a> = 0.0;</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;      <span class="keywordtype">int</span> currWidth = ( ( i == picWidthInLCU - 1 ) ? picWidth - LCUWidth * ( picWidthInLCU - 1 ) : LCUWidth );</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;      <span class="keywordtype">int</span> currHeight = ( ( j == picHeightInLCU - 1 ) ? picHeight - LCUHeight * ( picHeightInLCU - 1 ) : LCUHeight );</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;      <a class="code" href="classvvenc_1_1EncRCPic.html#a3be042b10e524d82819aeb3276035847">lcu</a>[ LCUIdx ].<a class="code" href="structvvenc_1_1TRCLCU.html#aae0bdbf90049bf94c419c0918b5e1d3d">numberOfPixel</a> = currWidth * currHeight;</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    }</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;  }</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#aa88894359f052c7c1759e3cb7e0ad34b">picActualHeaderBits</a> = 0;</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#af07f2ed00b0ed8af5fc86acaf0e2f503">picActualBits</a>       = 0;</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#a439f1eea14cde0384fd9a48d8fcda8f8">picQP</a>               = 0;</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#a448f06230945693b43ea3f8783d20368">picQPOffsetQPA</a>      = 0;</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#aa63b95dd79aafa6698666c048ac5434d">validPixelsInPic</a>    = 0;</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#a99e631187ad969a67befaf60f7f441f3">totalCostIntra</a>      = 0.0;</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#ae9bfbf4ef5133ec729ce28146b0ff549">picLambda</a>           = 0.0;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#ad12b85ecb08a85ac22bfdc05046798fd">picLambdaOffsetQPA</a>  = 0.0;</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#a26b5d3262aa716d856c03490baad4093">picMSE</a>              = 0.0;</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;}</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160; </div>
<div class="line"><a name="l00756"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCPic.html#a3a80b6032f86a56bec74609034b3246f">  756</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvvenc_1_1EncRCPic.html#a3a80b6032f86a56bec74609034b3246f">EncRCPic::destroy</a>()</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;{</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;  <span class="keywordflow">if</span>( <a class="code" href="classvvenc_1_1EncRCPic.html#a3be042b10e524d82819aeb3276035847">lcu</a> != <a class="code" href="CommonDef_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> )</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;  {</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    <span class="keyword">delete</span>[] <a class="code" href="classvvenc_1_1EncRCPic.html#a3be042b10e524d82819aeb3276035847">lcu</a>;</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <a class="code" href="classvvenc_1_1EncRCPic.html#a3be042b10e524d82819aeb3276035847">lcu</a> = <a class="code" href="CommonDef_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;  }</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a> = <a class="code" href="CommonDef_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#a2b5fcef61b77355d86a065adc308528e">encRCGOP</a> = <a class="code" href="CommonDef_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;}</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160; </div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160; </div>
<div class="line"><a name="l00768"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCPic.html#a00a61f37d924393793f0336daf330dfd">  768</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="classvvenc_1_1EncRCPic.html#a00a61f37d924393793f0336daf330dfd">EncRCPic::estimatePicLambda</a>( std::list&lt;EncRCPic*&gt;&amp; listPreviousPictures, <span class="keywordtype">bool</span> isIRAP )</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;{</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;  <span class="keywordtype">double</span> alpha = <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">picParam</a>[ <a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a> ].<a class="code" href="structvvenc_1_1TRCParameter.html#a20f4c4490bc8ecbdd1ffcb79acce6035">alpha</a>;</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;  <span class="keywordtype">double</span> beta = <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">picParam</a>[ <a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a> ].<a class="code" href="structvvenc_1_1TRCParameter.html#a9424343761f8c4f4c1afe8f5b6bf471b">beta</a>;</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;  <span class="keywordtype">double</span> bpp = (double)<a class="code" href="classvvenc_1_1EncRCPic.html#a4973b73ee65d239c9bec2f8bf78846a3">targetBits</a> / (<span class="keywordtype">double</span>)<a class="code" href="classvvenc_1_1EncRCPic.html#aae0bdbf90049bf94c419c0918b5e1d3d">numberOfPixel</a>;</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160; </div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;  <span class="keywordtype">int</span> bitdepthLumaScale = 2 * ( <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ac77b590e38a8e565a52609ab911451d1">bitDepth</a> - 8 - <a class="code" href="TypeDef_8h.html#a29d5c9e713ec90b037a5aaa3865ccfa9">DISTORTION_PRECISION_ADJUSTMENT</a>( <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ac77b590e38a8e565a52609ab911451d1">bitDepth</a> ) );</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160; </div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;  <span class="keywordtype">int</span> lastPicValPix = 0;</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  <span class="keywordflow">if</span> ( listPreviousPictures.size() &gt; 0 )</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  {</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    lastPicValPix = <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">picParam</a>[ <a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a> ].<a class="code" href="structvvenc_1_1TRCParameter.html#a0c2c12d17099a37f01345fcab95a7ebf">validPix</a>;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;  }</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;  <span class="keywordflow">if</span> ( lastPicValPix &gt; 0 )</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;  {</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    bpp = (double)<a class="code" href="classvvenc_1_1EncRCPic.html#a4973b73ee65d239c9bec2f8bf78846a3">targetBits</a> / (<span class="keywordtype">double</span>)lastPicValPix;</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;  }</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160; </div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;  <span class="keywordtype">double</span> estLambda;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  <span class="keywordflow">if</span> ( isIRAP )</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;  {</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    estLambda = <a class="code" href="classvvenc_1_1EncRCPic.html#a05656446c705e5c9331f8181ca223466">calculateLambdaIntra</a>( alpha, beta, pow( <a class="code" href="classvvenc_1_1EncRCPic.html#a99e631187ad969a67befaf60f7f441f3">totalCostIntra</a> / (<span class="keywordtype">double</span>)<a class="code" href="classvvenc_1_1EncRCPic.html#aae0bdbf90049bf94c419c0918b5e1d3d">numberOfPixel</a>, <a class="code" href="namespacevvenc.html#a18c769e91b6d473f74679144f9ff4fb5">RC_BETA1</a> ), bpp );</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;  }</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;  {</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    estLambda = alpha * pow( bpp, beta );</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;  }</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160; </div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  <a class="code" href="StatCounter_8h.html#a87a0b8601d301b04efad305d35b8ba20">CHECK</a> (<a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a306c1d7f4f6833176d12c84d77b9b412">twoPass</a>, <span class="stringliteral">&quot;rate control configuration error&quot;</span>);</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#abe4dc3eaf6f08d3447089bb434203555">clipLambdaFrameRc</a>( listPreviousPictures, estLambda, bitdepthLumaScale );</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160; </div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;  <span class="comment">//Avoid different results in different platforms. The problem is caused by the different results of pow() in different platforms.</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  estLambda = double( int64_t( estLambda * (<span class="keywordtype">double</span>)<a class="code" href="namespacevvenc.html#a241f2aa439bf4d008b4ab0113048c00f">RC_LAMBDA_PREC</a> + 0.5 ) ) / (double)<a class="code" href="namespacevvenc.html#a241f2aa439bf4d008b4ab0113048c00f">RC_LAMBDA_PREC</a>;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160; </div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;  <span class="keywordflow">return</span> estLambda;</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;}</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160; </div>
<div class="line"><a name="l00805"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCPic.html#abe4dc3eaf6f08d3447089bb434203555">  805</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvvenc_1_1EncRCPic.html#abe4dc3eaf6f08d3447089bb434203555">EncRCPic::clipLambdaFrameRc</a>( std::list&lt;EncRCPic*&gt;&amp; listPreviousPictures, <span class="keywordtype">double</span> &amp;lambda, <span class="keywordtype">int</span> bitdepthLumaScale )</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;{</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;  <span class="keywordtype">bool</span> setLastLevelLambda = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;  <span class="keywordtype">double</span> lastPrevTLLambda = -1.0;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;  <span class="keywordtype">double</span> lastLevelLambda = -1.0;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;  <span class="keywordtype">double</span> lastPicLambda = -1.0;</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;  <span class="keywordtype">double</span> lastValidLambda = -1.0;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;  std::list&lt;EncRCPic*&gt;::iterator it;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;  <span class="keywordflow">for</span> ( it = listPreviousPictures.begin(); it != listPreviousPictures.end(); it++ )</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  {</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    <span class="keywordflow">if</span> ( ( *it )-&gt;frameLevel == <a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a> - 1 &amp;&amp; ( *it )-&gt;picLambda &gt; 0.0 )</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    {</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;      lastPrevTLLambda = ( *it )-&gt;picLambda;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    }</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    <span class="keywordflow">if</span> ( ( *it )-&gt;frameLevel == <a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a> &amp;&amp; ( *it )-&gt;picLambda &gt; 0.0 )</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    {</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;      lastLevelLambda = ( *it )-&gt;picLambda;</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      setLastLevelLambda = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    }</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#aa03c2b87d895da2089dcc9e5448b7cd2">framesCoded</a> &lt; <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ad0db87e2ca0c90c9609a9a82f52174a5">gopSize</a> &amp;&amp; ( *it )-&gt;frameLevel &lt; <a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a> &amp;&amp; ( *it )-&gt;picLambda &gt; 0.0 &amp;&amp; !setLastLevelLambda )</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    {</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;      lastLevelLambda = ( *it )-&gt;picLambda;</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    }</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    lastPicLambda = ( *it )-&gt;picLambda;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160; </div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    <span class="keywordflow">if</span> ( lastPicLambda &gt; 0.0 )</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    {</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;      lastValidLambda = lastPicLambda;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    }</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;  }</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160; </div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;  <span class="keywordflow">if</span> ( lastLevelLambda &gt; 0.0 )</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;  {</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    lastLevelLambda = Clip3( <a class="code" href="classvvenc_1_1EncRCPic.html#a2b5fcef61b77355d86a065adc308528e">encRCGOP</a>-&gt;<a class="code" href="classvvenc_1_1EncRCGOP.html#a9fc04d1dbe9e90211adae22edf1aa4ea">minEstLambda</a>, <a class="code" href="classvvenc_1_1EncRCPic.html#a2b5fcef61b77355d86a065adc308528e">encRCGOP</a>-&gt;<a class="code" href="classvvenc_1_1EncRCGOP.html#a3a2e8b59f1816785bf9179457a42032a">maxEstLambda</a>, lastLevelLambda );</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    lambda = Clip3( lastLevelLambda * pow( 2.0, -( 5.0 + <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a177fb8c710ad770bd0faad793da46ab9">fppParFrames</a> ) / 3.0 ), lastLevelLambda * pow( 2.0, ( 5.0 + <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a177fb8c710ad770bd0faad793da46ab9">fppParFrames</a> ) / 3.0 ), lambda );</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;  }</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160; </div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;  <span class="keywordflow">if</span> ( <a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a> &gt; 2 )</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;  {</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    <span class="keywordtype">int</span> tlQpOffset = <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ad0db87e2ca0c90c9609a9a82f52174a5">gopSize</a> == 32 ? <a class="code" href="namespacevvenc.html#a59c60ed5c173ea5b12a62f25655236a1">RC_GOP_ID_QP_OFFSET_GOP32</a>[ <a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a> ] : <a class="code" href="namespacevvenc.html#a1aab7e3788f646db5393de39ebaa0e8d">RC_GOP_ID_QP_OFFSET</a>[ <a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a> ];</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    lambda = Clip3( lastPrevTLLambda * pow( 2.0, (<span class="keywordtype">double</span>)( tlQpOffset ) / 3.0 ), <a class="code" href="classvvenc_1_1EncRCPic.html#a2b5fcef61b77355d86a065adc308528e">encRCGOP</a>-&gt;<a class="code" href="classvvenc_1_1EncRCGOP.html#a3a2e8b59f1816785bf9179457a42032a">maxEstLambda</a>, lambda );</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;  }</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160; </div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;  <span class="keywordflow">if</span> ( lastPicLambda &gt; 0.0 )</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;  {</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    lastPicLambda = Clip3( <a class="code" href="classvvenc_1_1EncRCPic.html#a2b5fcef61b77355d86a065adc308528e">encRCGOP</a>-&gt;<a class="code" href="classvvenc_1_1EncRCGOP.html#a9fc04d1dbe9e90211adae22edf1aa4ea">minEstLambda</a>, 2000.0 * pow( 2.0, bitdepthLumaScale ), lastPicLambda );</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    <span class="keywordtype">double</span> clipRange = <a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a> &gt; 1 ? 10.0 : 12.0;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    lambda = Clip3( lastPicLambda * pow( 2.0, -clipRange / 3.0 ), lastPicLambda * pow( 2.0, clipRange / 3.0 ), lambda );</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;  }</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( lastValidLambda &gt; 0.0 )</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;  {</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    lastValidLambda = Clip3( <a class="code" href="classvvenc_1_1EncRCPic.html#a2b5fcef61b77355d86a065adc308528e">encRCGOP</a>-&gt;<a class="code" href="classvvenc_1_1EncRCGOP.html#a9fc04d1dbe9e90211adae22edf1aa4ea">minEstLambda</a>, 2000.0 * pow( 2.0, bitdepthLumaScale ), lastValidLambda );</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    <span class="keywordtype">double</span> clipRange = <a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a> &gt; 1 ? 10.0 : 12.0;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    lambda = Clip3( lastValidLambda * pow( 2.0, -clipRange / 3.0 ), lastValidLambda * pow( 2.0, clipRange / 3.0 ), lambda );</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  }</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;  {</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    lambda = Clip3( <a class="code" href="classvvenc_1_1EncRCPic.html#a2b5fcef61b77355d86a065adc308528e">encRCGOP</a>-&gt;<a class="code" href="classvvenc_1_1EncRCGOP.html#a9fc04d1dbe9e90211adae22edf1aa4ea">minEstLambda</a>, <a class="code" href="classvvenc_1_1EncRCPic.html#a2b5fcef61b77355d86a065adc308528e">encRCGOP</a>-&gt;<a class="code" href="classvvenc_1_1EncRCGOP.html#a3a2e8b59f1816785bf9179457a42032a">maxEstLambda</a>, lambda );</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;  }</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160; </div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;  <span class="keywordflow">if</span> ( lambda &lt; encRCGOP-&gt;minEstLambda )</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;  {</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    lambda = <a class="code" href="classvvenc_1_1EncRCPic.html#a2b5fcef61b77355d86a065adc308528e">encRCGOP</a>-&gt;<a class="code" href="classvvenc_1_1EncRCGOP.html#a9fc04d1dbe9e90211adae22edf1aa4ea">minEstLambda</a>;</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;  }</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;}</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160; </div>
<div class="line"><a name="l00871"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCPic.html#ad6f561fb8a4aed1c50d7b7c03e716078">  871</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classvvenc_1_1EncRCPic.html#ad6f561fb8a4aed1c50d7b7c03e716078">EncRCPic::estimatePicQP</a>( <span class="keywordtype">double</span> lambda, std::list&lt;EncRCPic*&gt;&amp; listPreviousPictures )</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;{</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;  <span class="keywordtype">int</span> bitdepthLumaScale = 2 * ( <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ac77b590e38a8e565a52609ab911451d1">bitDepth</a> - 8 - <a class="code" href="TypeDef_8h.html#a29d5c9e713ec90b037a5aaa3865ccfa9">DISTORTION_PRECISION_ADJUSTMENT</a>( <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ac77b590e38a8e565a52609ab911451d1">bitDepth</a> ) );</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160; </div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;  <span class="keywordtype">int</span> QP = int( 4.2005 * log( lambda / pow( 2.0, bitdepthLumaScale ) ) + 13.7122 + 0.5 );</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160; </div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;  <a class="code" href="StatCounter_8h.html#a87a0b8601d301b04efad305d35b8ba20">CHECK</a> (<a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a306c1d7f4f6833176d12c84d77b9b412">twoPass</a>, <span class="stringliteral">&quot;rate control configuration error&quot;</span>);</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#aa8c918708805c64a7d573936acf8e19d">clipQpFrameRc</a>( listPreviousPictures, QP );</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160; </div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;  <span class="keywordflow">return</span> QP;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;}</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160; </div>
<div class="line"><a name="l00883"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCPic.html#aa8c918708805c64a7d573936acf8e19d">  883</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvvenc_1_1EncRCPic.html#aa8c918708805c64a7d573936acf8e19d">EncRCPic::clipQpFrameRc</a>( std::list&lt;EncRCPic*&gt;&amp; listPreviousPictures, <span class="keywordtype">int</span> &amp;QP )</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;{</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  <span class="keywordtype">bool</span> setLastLevelQP = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  <span class="keywordtype">int</span> lastPrevTLQP = <a class="code" href="namespacevvenc.html#ac7434cfc270369ca2c897d06347885db">RC_INVALID_QP_VALUE</a>;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;  <span class="keywordtype">int</span> lastLevelQP = <a class="code" href="namespacevvenc.html#ac7434cfc270369ca2c897d06347885db">RC_INVALID_QP_VALUE</a>;</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;  <span class="keywordtype">int</span> lastPicQP = <a class="code" href="namespacevvenc.html#ac7434cfc270369ca2c897d06347885db">RC_INVALID_QP_VALUE</a>;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;  <span class="keywordtype">int</span> lastValidQP = <a class="code" href="namespacevvenc.html#ac7434cfc270369ca2c897d06347885db">RC_INVALID_QP_VALUE</a>;</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;  std::list&lt;EncRCPic*&gt;::iterator it;</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;  <span class="keywordflow">for</span> ( it = listPreviousPictures.begin(); it != listPreviousPictures.end(); it++ )</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;  {</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    <span class="keywordflow">if</span> ( ( *it )-&gt;frameLevel == <a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a> - 1 &amp;&amp; ( *it )-&gt;picQP &gt; <a class="code" href="namespacevvenc.html#ac7434cfc270369ca2c897d06347885db">RC_INVALID_QP_VALUE</a> )</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    {</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;      lastPrevTLQP = ( *it )-&gt;picQP;</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    }</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    <span class="keywordflow">if</span> ( ( *it )-&gt;frameLevel == <a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a> &amp;&amp; ( *it )-&gt;picQP &gt; <a class="code" href="namespacevvenc.html#ac7434cfc270369ca2c897d06347885db">RC_INVALID_QP_VALUE</a> ) <span class="comment">// use the QP value from the last available frame of that level</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    {</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;      lastLevelQP = ( *it )-&gt;picQP;</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      setLastLevelQP = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    }</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#aa03c2b87d895da2089dcc9e5448b7cd2">framesCoded</a> &lt; <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ad0db87e2ca0c90c9609a9a82f52174a5">gopSize</a> &amp;&amp; ( *it )-&gt;frameLevel &lt; <a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a> &amp;&amp; ( *it )-&gt;picQP &gt; <a class="code" href="namespacevvenc.html#ac7434cfc270369ca2c897d06347885db">RC_INVALID_QP_VALUE</a> &amp;&amp; !setLastLevelQP )</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    {</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;      lastLevelQP = ( *it )-&gt;picQP;</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    }</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    lastPicQP = ( *it )-&gt;picQP;</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    <span class="keywordflow">if</span> ( lastPicQP &gt; <a class="code" href="namespacevvenc.html#ac7434cfc270369ca2c897d06347885db">RC_INVALID_QP_VALUE</a> )</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    {</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;      lastValidQP = lastPicQP;</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    }</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  }</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160; </div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;  <span class="keywordflow">if</span> ( lastLevelQP &gt; <a class="code" href="namespacevvenc.html#ac7434cfc270369ca2c897d06347885db">RC_INVALID_QP_VALUE</a> )</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;  {</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;    QP = Clip3( lastLevelQP - ( 5 + <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a177fb8c710ad770bd0faad793da46ab9">fppParFrames</a> ), lastLevelQP + ( 5 + <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a177fb8c710ad770bd0faad793da46ab9">fppParFrames</a> ), QP );</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;  }</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160; </div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  <span class="keywordflow">if</span> ( <a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a> &gt; 2 )</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  {</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;    <span class="keywordtype">int</span> tlQpOffset = <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ad0db87e2ca0c90c9609a9a82f52174a5">gopSize</a> == 32 ? <a class="code" href="namespacevvenc.html#a59c60ed5c173ea5b12a62f25655236a1">RC_GOP_ID_QP_OFFSET_GOP32</a>[ <a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a> ] : <a class="code" href="namespacevvenc.html#a1aab7e3788f646db5393de39ebaa0e8d">RC_GOP_ID_QP_OFFSET</a>[ <a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a> ];</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    QP = Clip3( lastPrevTLQP + tlQpOffset, <a class="code" href="namespacevvenc.html#aa2aaf0a0822296d132b363aeaf9df0ca">MAX_QP</a>, QP );</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;  }</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160; </div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;  <span class="keywordflow">if</span> ( lastPicQP &gt; <a class="code" href="namespacevvenc.html#ac7434cfc270369ca2c897d06347885db">RC_INVALID_QP_VALUE</a> )</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;  {</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    <span class="keywordtype">int</span> clipRange = <a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a> &gt; 1 ? 10 : 12;</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    QP = Clip3( lastPicQP - clipRange, lastPicQP + clipRange, QP );</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;  }</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( lastValidQP &gt; <a class="code" href="namespacevvenc.html#ac7434cfc270369ca2c897d06347885db">RC_INVALID_QP_VALUE</a> )</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;  {</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    <span class="keywordtype">int</span> clipRange = <a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a> &gt; 1 ? 10 : 12;</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    QP = Clip3( lastValidQP - clipRange, lastValidQP + clipRange, QP );</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;  }</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;}</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160; </div>
<div class="line"><a name="l00936"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCPic.html#ac036fd34f712c951c1c05593d44bde3e">  936</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvvenc_1_1EncRCPic.html#ac036fd34f712c951c1c05593d44bde3e">EncRCPic::clipTargetQP</a> (std::list&lt;EncRCPic*&gt;&amp; listPreviousPictures, <span class="keywordtype">int</span> &amp;qp)</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;{</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;  <span class="keywordtype">int</span> lastCurrTLQP = -1;</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;  <span class="keywordtype">int</span> lastPrevTLQP = -1;</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  std::list&lt;EncRCPic*&gt;::iterator it;</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160; </div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;  <span class="keywordflow">for</span> (it = listPreviousPictures.begin(); it != listPreviousPictures.end(); it++)</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;  {</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    <span class="keywordflow">if</span> ((*it)-&gt;frameLevel == <a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a> &amp;&amp; (*it)-&gt;picQP &gt;= 0)  <span class="comment">// current temporal level</span></div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    {</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;      lastCurrTLQP = (*it)-&gt;picQP;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    }</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    <span class="keywordflow">if</span> ((*it)-&gt;frameLevel == <a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a> - 1 &amp;&amp; (*it)-&gt;picQP &gt;= 0) <span class="comment">// last temporal level</span></div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    {</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;      lastPrevTLQP = (*it)-&gt;picQP;</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    }</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;  }</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160; </div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;  qp = Clip3 (0, <a class="code" href="namespacevvenc.html#aa2aaf0a0822296d132b363aeaf9df0ca">MAX_QP</a>, qp);</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160; </div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;  <span class="keywordflow">if</span> (lastCurrTLQP &gt;= 0) <span class="comment">// limit QP changes among prev. frames from same temporal level</span></div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;  {</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> clipRange = (<a class="code" href="classvvenc_1_1EncRCPic.html#a27f637ec99a55ae334338affeca0e1d7">refreshParams</a> ? 5 + <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a75852d45ae317ffce5daf5eb321b167a">intraPeriod</a> / <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ad0db87e2ca0c90c9609a9a82f52174a5">gopSize</a> : std::max(3, 6 - (<a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a> &gt;&gt; 1)));</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160; </div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    qp = Clip3 (lastCurrTLQP - clipRange, std::min (<a class="code" href="namespacevvenc.html#aa2aaf0a0822296d132b363aeaf9df0ca">MAX_QP</a>, lastCurrTLQP + clipRange), qp);</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;  }</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;  <span class="keywordflow">if</span> (lastPrevTLQP &gt;= 0) <span class="comment">// prevent QP from being lower than QPs at lower temporal level</span></div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  {</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    qp = Clip3 (lastPrevTLQP + 1, <a class="code" href="namespacevvenc.html#aa2aaf0a0822296d132b363aeaf9df0ca">MAX_QP</a>, qp);</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  }</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#aad35fc85fff0a753627ea3ff5192834c">lastIntraQP</a> &gt;= 0 &amp;&amp; (<a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a> == 1 || <a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a> == 2))</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;  {</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    qp = Clip3 (<a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#aad35fc85fff0a753627ea3ff5192834c">lastIntraQP</a>, <a class="code" href="namespacevvenc.html#aa2aaf0a0822296d132b363aeaf9df0ca">MAX_QP</a>, qp);</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;  }</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;}</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160; </div>
<div class="line"><a name="l00972"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCPic.html#a525e1f8954bc8a288b4ddca834e65144">  972</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvvenc_1_1EncRCPic.html#a525e1f8954bc8a288b4ddca834e65144">EncRCPic::updateAfterCTU</a>( <span class="keywordtype">int</span> LCUIdx, <span class="keywordtype">int</span> bits, <span class="keywordtype">double</span> lambda )</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;{</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a306c1d7f4f6833176d12c84d77b9b412">twoPass</a>) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160; </div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#a3be042b10e524d82819aeb3276035847">lcu</a>[ LCUIdx ].<a class="code" href="structvvenc_1_1TRCLCU.html#a3db359547eed8cfd48ca821d95f577af">lambda</a> = lambda;</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#a3be042b10e524d82819aeb3276035847">lcu</a>[ LCUIdx ].<a class="code" href="structvvenc_1_1TRCLCU.html#ad6f0bebdd354df4050cdb476d94f9db1">actualSSE</a> = <a class="code" href="classvvenc_1_1EncRCPic.html#a3be042b10e524d82819aeb3276035847">lcu</a>[ LCUIdx ].<a class="code" href="structvvenc_1_1TRCLCU.html#a7ae450af8cebf1f528a9a738c2cd6531">actualMSE</a> * <a class="code" href="classvvenc_1_1EncRCPic.html#a3be042b10e524d82819aeb3276035847">lcu</a>[ LCUIdx ].<a class="code" href="structvvenc_1_1TRCLCU.html#aae0bdbf90049bf94c419c0918b5e1d3d">numberOfPixel</a>;</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160; </div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#a7192b8cd46d8604a40846c7a736b84fe">bitsLeft</a> -= bits;</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;}</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160; </div>
<div class="line"><a name="l00982"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCPic.html#a7ed72c08dc73f91e000b5d36821cc49f">  982</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvvenc_1_1EncRCPic.html#a7ed72c08dc73f91e000b5d36821cc49f">EncRCPic::calPicMSE</a>()</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;{</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;  <span class="keywordtype">double</span> totalSSE = 0.0;</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;  <span class="keywordtype">int</span> totalPixels = 0;</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;  <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classvvenc_1_1EncRCPic.html#a516a779a4b162eddb49c63d03b75c2a9">numberOfLCU</a>; i++ )</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;  {</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="classvvenc_1_1EncRCPic.html#a3be042b10e524d82819aeb3276035847">lcu</a>[ i ].lambda &gt; 0.1 &amp;&amp; <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ab0af52bb2fd3511beea867ee60f1895c">adaptiveBits</a> &gt; 0 )</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    {</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;      <a class="code" href="classvvenc_1_1EncRCPic.html#aa63b95dd79aafa6698666c048ac5434d">validPixelsInPic</a> += <a class="code" href="classvvenc_1_1EncRCPic.html#a3be042b10e524d82819aeb3276035847">lcu</a>[ i ].<a class="code" href="structvvenc_1_1TRCLCU.html#aae0bdbf90049bf94c419c0918b5e1d3d">numberOfPixel</a>;</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;      totalSSE += <a class="code" href="classvvenc_1_1EncRCPic.html#a3be042b10e524d82819aeb3276035847">lcu</a>[ i ].<a class="code" href="structvvenc_1_1TRCLCU.html#ad6f0bebdd354df4050cdb476d94f9db1">actualSSE</a>;</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;      totalPixels += <a class="code" href="classvvenc_1_1EncRCPic.html#a3be042b10e524d82819aeb3276035847">lcu</a>[ i ].<a class="code" href="structvvenc_1_1TRCLCU.html#aae0bdbf90049bf94c419c0918b5e1d3d">numberOfPixel</a>;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    }</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;  }</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160; </div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#a26b5d3262aa716d856c03490baad4093">picMSE</a> = totalPixels &gt; 0 ? totalSSE / (double)totalPixels : 1.0;</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;}</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160; </div>
<div class="line"><a name="l00999"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCPic.html#a20b50beeb0bd45f40478f991667d91e8">  999</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvvenc_1_1EncRCPic.html#a20b50beeb0bd45f40478f991667d91e8">EncRCPic::updateAfterPicture</a>( <span class="keywordtype">int</span> actualHeaderBits, <span class="keywordtype">int</span> actualTotalBits, <span class="keywordtype">double</span> averageQP, <span class="keywordtype">double</span> averageLambda, <span class="keywordtype">bool</span> isIRAP)</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;{</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#aa88894359f052c7c1759e3cb7e0ad34b">picActualHeaderBits</a> = actualHeaderBits;</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#af07f2ed00b0ed8af5fc86acaf0e2f503">picActualBits</a>       = actualTotalBits;</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#ae9bfbf4ef5133ec729ce28146b0ff549">picLambda</a>           = averageLambda;</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#a439f1eea14cde0384fd9a48d8fcda8f8">picQP</a>               = int (averageQP + 0.5);</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160; </div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a306c1d7f4f6833176d12c84d77b9b412">twoPass</a>)</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;  {</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    <span class="keywordflow">if</span> ( averageQP &gt; 0.0 )</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;    {</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;      <a class="code" href="classvvenc_1_1EncRCPic.html#a439f1eea14cde0384fd9a48d8fcda8f8">picQP</a>           = int( averageQP + 0.5 );</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    }</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    {</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;      <a class="code" href="classvvenc_1_1EncRCPic.html#a439f1eea14cde0384fd9a48d8fcda8f8">picQP</a>           = <a class="code" href="namespacevvenc.html#ac7434cfc270369ca2c897d06347885db">RC_INVALID_QP_VALUE</a>;</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    }</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160; </div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    <span class="keywordtype">double</span> alpha = <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">picParam</a>[ <a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a> ].<a class="code" href="structvvenc_1_1TRCParameter.html#a20f4c4490bc8ecbdd1ffcb79acce6035">alpha</a>;</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    <span class="keywordtype">double</span> beta  = <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">picParam</a>[ <a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a> ].<a class="code" href="structvvenc_1_1TRCParameter.html#a9424343761f8c4f4c1afe8f5b6bf471b">beta</a>;</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    <span class="keywordtype">double</span> skipRatio = 0;</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    <span class="keywordtype">int</span> numOfSkipPixel = 0;</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> LCUIdx = 0; LCUIdx &lt; <a class="code" href="classvvenc_1_1EncRCPic.html#a516a779a4b162eddb49c63d03b75c2a9">numberOfLCU</a>; LCUIdx++)</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    {</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;      numOfSkipPixel += int( <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">picParam</a>[ <a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a> ].<a class="code" href="structvvenc_1_1TRCParameter.html#a37e8135dece9bf76f60832f12fc51cf8">skipRatio</a> * <a class="code" href="classvvenc_1_1EncRCPic.html#a3be042b10e524d82819aeb3276035847">lcu</a>[ LCUIdx ].<a class="code" href="structvvenc_1_1TRCLCU.html#aae0bdbf90049bf94c419c0918b5e1d3d">numberOfPixel</a> );</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    }</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    skipRatio = (double)numOfSkipPixel / (<span class="keywordtype">double</span>)<a class="code" href="classvvenc_1_1EncRCPic.html#aae0bdbf90049bf94c419c0918b5e1d3d">numberOfPixel</a>;</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160; </div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    <span class="keywordflow">if</span> (isIRAP)</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    {</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;      <a class="code" href="classvvenc_1_1EncRCPic.html#a13f66554cee03d7d3b4d59952822999c">updateAlphaBetaIntra</a>(alpha, beta);</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;      <a class="code" href="structvvenc_1_1TRCParameter.html">TRCParameter</a> rcPara;</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;      rcPara.<a class="code" href="structvvenc_1_1TRCParameter.html#a37e8135dece9bf76f60832f12fc51cf8">skipRatio</a> = skipRatio;</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;      rcPara.<a class="code" href="structvvenc_1_1TRCParameter.html#a0c2c12d17099a37f01345fcab95a7ebf">validPix</a> = <a class="code" href="classvvenc_1_1EncRCPic.html#aa63b95dd79aafa6698666c048ac5434d">validPixelsInPic</a>;</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;      rcPara.<a class="code" href="structvvenc_1_1TRCParameter.html#a20f4c4490bc8ecbdd1ffcb79acce6035">alpha</a> = alpha;</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;      rcPara.<a class="code" href="structvvenc_1_1TRCParameter.html#a9424343761f8c4f4c1afe8f5b6bf471b">beta</a> = beta;</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;      <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">picParam</a>[ <a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a> ] = rcPara;</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;    }</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    {</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;      <span class="comment">// update parameters</span></div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;      <span class="keywordtype">double</span> pictureActualBits = (double)<a class="code" href="classvvenc_1_1EncRCPic.html#af07f2ed00b0ed8af5fc86acaf0e2f503">picActualBits</a>;</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;      <span class="keywordtype">double</span> pictureActualBpp = <a class="code" href="classvvenc_1_1EncRCPic.html#aa63b95dd79aafa6698666c048ac5434d">validPixelsInPic</a> &gt; 0 ? pictureActualBits / (double)<a class="code" href="classvvenc_1_1EncRCPic.html#aa63b95dd79aafa6698666c048ac5434d">validPixelsInPic</a> : 0.001;</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;      <a class="code" href="structvvenc_1_1TRCParameter.html">TRCParameter</a> rcPara;</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;      rcPara.<a class="code" href="structvvenc_1_1TRCParameter.html#a37e8135dece9bf76f60832f12fc51cf8">skipRatio</a> = skipRatio;</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;      rcPara.<a class="code" href="structvvenc_1_1TRCParameter.html#a0c2c12d17099a37f01345fcab95a7ebf">validPix</a> = <a class="code" href="classvvenc_1_1EncRCPic.html#aa63b95dd79aafa6698666c048ac5434d">validPixelsInPic</a>;</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;      <span class="keywordtype">double</span> avgMSE = <a class="code" href="classvvenc_1_1EncRCPic.html#a26b5d3262aa716d856c03490baad4093">picMSE</a>;</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;      <span class="keywordtype">double</span> updatedK = pictureActualBpp * averageLambda / avgMSE;</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;      <span class="keywordtype">double</span> updatedC = avgMSE / pow( pictureActualBpp, -updatedK );</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;      rcPara.<a class="code" href="structvvenc_1_1TRCParameter.html#a20f4c4490bc8ecbdd1ffcb79acce6035">alpha</a> = updatedC * updatedK;</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;      rcPara.<a class="code" href="structvvenc_1_1TRCParameter.html#a9424343761f8c4f4c1afe8f5b6bf471b">beta</a> = -updatedK - 1.0;</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;      <span class="keywordflow">if</span> ( <a class="code" href="classvvenc_1_1EncRCPic.html#aa63b95dd79aafa6698666c048ac5434d">validPixelsInPic</a> &gt; 0 )</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;      {</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;        <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a02fd3c2635e6886180079e82fd389744">clipRcAlpha</a>( rcPara.<a class="code" href="structvvenc_1_1TRCParameter.html#a20f4c4490bc8ecbdd1ffcb79acce6035">alpha</a> );</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;        <a class="code" href="classvvenc_1_1EncRCPic.html#a6c8773e9e7302babc02840a2426eda20">clipRcBeta</a>( rcPara.<a class="code" href="structvvenc_1_1TRCParameter.html#a9424343761f8c4f4c1afe8f5b6bf471b">beta</a> );</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;        <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">picParam</a>[ <a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a> ] = rcPara;</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;      }</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;      <span class="keywordflow">if</span> ( <a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a> == 1 )</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;      {</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;        <span class="keywordtype">double</span> currLambda = Clip3( <a class="code" href="classvvenc_1_1EncRCPic.html#a2b5fcef61b77355d86a065adc308528e">encRCGOP</a>-&gt;<a class="code" href="classvvenc_1_1EncRCGOP.html#a9fc04d1dbe9e90211adae22edf1aa4ea">minEstLambda</a>, <a class="code" href="classvvenc_1_1EncRCPic.html#a2b5fcef61b77355d86a065adc308528e">encRCGOP</a>-&gt;<a class="code" href="classvvenc_1_1EncRCGOP.html#a3a2e8b59f1816785bf9179457a42032a">maxEstLambda</a>, <a class="code" href="classvvenc_1_1EncRCPic.html#ae9bfbf4ef5133ec729ce28146b0ff549">picLambda</a> );</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;        <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#aa921605b08e04dcf79d24564b00dcc84">lastLambda</a> = <a class="code" href="namespacevvenc.html#a744241f8e002c7492b74159ce1caf63d">RC_WEIGHT_HISTORY_LAMBDA</a> * <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#aa921605b08e04dcf79d24564b00dcc84">lastLambda</a> + ( 1.0 - <a class="code" href="namespacevvenc.html#a744241f8e002c7492b74159ce1caf63d">RC_WEIGHT_HISTORY_LAMBDA</a> ) * currLambda;</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;      }</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;    }</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;  } <span class="comment">// if !twoPass</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160; </div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;  <span class="keywordflow">if</span> ((<a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a> &lt;= 7) &amp;&amp; (<a class="code" href="classvvenc_1_1EncRCPic.html#af07f2ed00b0ed8af5fc86acaf0e2f503">picActualBits</a> &gt; 0) &amp;&amp; (<a class="code" href="classvvenc_1_1EncRCPic.html#a4973b73ee65d239c9bec2f8bf78846a3">targetBits</a> &gt; 0)) <span class="comment">// update qpCorrection for EncGOP::picInitRateControl()</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;  {</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> refreshed = (<a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a65f367eacfb22811464a0a5379ffc72e">actualBitCnt</a>[<a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a>] == 0) &amp;&amp; (<a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a0537991a88d47e85ab1a38c1a8c828f9">targetBitCnt</a>[<a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a>] == 0);</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160; </div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a65f367eacfb22811464a0a5379ffc72e">actualBitCnt</a>[<a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a>] += (uint64_t) <a class="code" href="classvvenc_1_1EncRCPic.html#af07f2ed00b0ed8af5fc86acaf0e2f503">picActualBits</a>;</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a0537991a88d47e85ab1a38c1a8c828f9">targetBitCnt</a>[<a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a>] += (uint64_t) <a class="code" href="classvvenc_1_1EncRCPic.html#a4973b73ee65d239c9bec2f8bf78846a3">targetBits</a>;</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160; </div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ad4b745de663253d20459b3744de3ecd1">qpCorrection</a>[<a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a>] = (refreshed ? 1.0 : 6.0) * log ((<span class="keywordtype">double</span>) <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a65f367eacfb22811464a0a5379ffc72e">actualBitCnt</a>[<a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a>] / (<span class="keywordtype">double</span>) <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a0537991a88d47e85ab1a38c1a8c828f9">targetBitCnt</a>[<a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a>]) / log (2.0);</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ad4b745de663253d20459b3744de3ecd1">qpCorrection</a>[<a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a>] = Clip3 (-12.0, 12.0, <a class="code" href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ad4b745de663253d20459b3744de3ecd1">qpCorrection</a>[<a class="code" href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">frameLevel</a>]);</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;  }</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;}</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160; </div>
<div class="line"><a name="l01076"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCPic.html#a6c8773e9e7302babc02840a2426eda20"> 1076</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvvenc_1_1EncRCPic.html#a6c8773e9e7302babc02840a2426eda20">EncRCPic::clipRcBeta</a>( <span class="keywordtype">double</span>&amp; beta)</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;{</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;  beta =  Clip3( <a class="code" href="namespacevvenc.html#a4f573f5f27f5af8ecb4786131b1f3b8f">RC_BETA_MIN_VALUE</a>, <a class="code" href="namespacevvenc.html#a95d815af88e0ec2f5f2edad706d9b978">RC_BETA_MAX_VALUE</a>, beta );</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;}</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160; </div>
<div class="line"><a name="l01081"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCPic.html#a62da06f3dacb4dfdb0b1bfe66132d3d5"> 1081</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classvvenc_1_1EncRCPic.html#a62da06f3dacb4dfdb0b1bfe66132d3d5">EncRCPic::getRefineBitsForIntra</a>( <span class="keywordtype">int</span> orgBits )</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;{</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;  <span class="keywordtype">double</span> alpha = 0.25, beta = 0.5582;</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;  <span class="keywordtype">int</span> iIntraBits;</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160; </div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;  alpha = orgBits * 40 &lt; <a class="code" href="classvvenc_1_1EncRCPic.html#aae0bdbf90049bf94c419c0918b5e1d3d">numberOfPixel</a> ? 0.25 : 0.3 ;</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160; </div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;  iIntraBits = (int)( alpha * pow( <a class="code" href="classvvenc_1_1EncRCPic.html#a99e631187ad969a67befaf60f7f441f3">totalCostIntra</a> * 4.0 / (<span class="keywordtype">double</span>)orgBits, beta ) * (double)orgBits + 0.5 );</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160; </div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  <span class="keywordflow">return</span> iIntraBits;</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;}</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160; </div>
<div class="line"><a name="l01093"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCPic.html#a05656446c705e5c9331f8181ca223466"> 1093</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="classvvenc_1_1EncRCPic.html#a05656446c705e5c9331f8181ca223466">EncRCPic::calculateLambdaIntra</a>(<span class="keywordtype">double</span> alpha, <span class="keywordtype">double</span> beta, <span class="keywordtype">double</span> MADPerPixel, <span class="keywordtype">double</span> bitsPerPixel)</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;{</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;  <span class="keywordflow">return</span> ( (alpha / 256.0) * pow( MADPerPixel / bitsPerPixel, beta ) );</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;}</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160; </div>
<div class="line"><a name="l01098"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCPic.html#a13f66554cee03d7d3b4d59952822999c"> 1098</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvvenc_1_1EncRCPic.html#a13f66554cee03d7d3b4d59952822999c">EncRCPic::updateAlphaBetaIntra</a>(<span class="keywordtype">double</span>&amp; alpha, <span class="keywordtype">double</span>&amp; beta)</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;{</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;  <span class="keywordtype">double</span> lnbpp = log( pow( <a class="code" href="classvvenc_1_1EncRCPic.html#a99e631187ad969a67befaf60f7f441f3">totalCostIntra</a> / (<span class="keywordtype">double</span>)<a class="code" href="classvvenc_1_1EncRCPic.html#aae0bdbf90049bf94c419c0918b5e1d3d">numberOfPixel</a>, <a class="code" href="namespacevvenc.html#a18c769e91b6d473f74679144f9ff4fb5">RC_BETA1</a> ) ) - log( (<span class="keywordtype">double</span>)<a class="code" href="classvvenc_1_1EncRCPic.html#af07f2ed00b0ed8af5fc86acaf0e2f503">picActualBits</a> / (<span class="keywordtype">double</span>)<a class="code" href="classvvenc_1_1EncRCPic.html#aae0bdbf90049bf94c419c0918b5e1d3d">numberOfPixel</a> );</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;  <span class="keywordtype">double</span> diffLambda = beta * ( log( (<span class="keywordtype">double</span>)<a class="code" href="classvvenc_1_1EncRCPic.html#af07f2ed00b0ed8af5fc86acaf0e2f503">picActualBits</a> ) - log( (<span class="keywordtype">double</span>)<a class="code" href="classvvenc_1_1EncRCPic.html#a4973b73ee65d239c9bec2f8bf78846a3">targetBits</a> ) );</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160; </div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;  diffLambda = Clip3(-0.125, 0.125, 0.25*diffLambda);</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;  alpha    =  alpha * exp(diffLambda);</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;  beta     =  beta + diffLambda / lnbpp;</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;}</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160; </div>
<div class="line"><a name="l01108"></a><span class="lineno"><a class="line" href="classvvenc_1_1RateCtrl.html#a0e994a827dec227d6f8ad66e170645b2"> 1108</a></span>&#160;<a class="code" href="classvvenc_1_1RateCtrl.html#a0e994a827dec227d6f8ad66e170645b2">RateCtrl::RateCtrl</a>()</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;{</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;  <a class="code" href="classvvenc_1_1RateCtrl.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>      = <a class="code" href="CommonDef_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;  <a class="code" href="classvvenc_1_1RateCtrl.html#a2b5fcef61b77355d86a065adc308528e">encRCGOP</a>      = <a class="code" href="CommonDef_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;  <a class="code" href="classvvenc_1_1RateCtrl.html#afd36d4c3cfe408edbe75579fd69bafd0">encRCPic</a>      = <a class="code" href="CommonDef_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;  <a class="code" href="classvvenc_1_1RateCtrl.html#a9f42bf2ad9de6fce9ed88e35a325d442">flushPOC</a>      = -1;</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;  <a class="code" href="classvvenc_1_1RateCtrl.html#ab4eb30394f0c5fe824c23077d4258bf6">rcPass</a>        = 0;</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;  <a class="code" href="classvvenc_1_1RateCtrl.html#a7314a6a143d85804239b97a36965755f">rcMaxPass</a>     = 0;</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;  <a class="code" href="classvvenc_1_1RateCtrl.html#a5a6de978047f62096b6c0d20659e756b">rcIsFinalPass</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;}</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160; </div>
<div class="line"><a name="l01119"></a><span class="lineno"><a class="line" href="classvvenc_1_1RateCtrl.html#abdf88f286c886ea0348082c091a22ad3"> 1119</a></span>&#160;<a class="code" href="classvvenc_1_1RateCtrl.html#abdf88f286c886ea0348082c091a22ad3">RateCtrl::~RateCtrl</a>()</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;{</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;  <a class="code" href="classvvenc_1_1RateCtrl.html#a3a80b6032f86a56bec74609034b3246f">destroy</a>();</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;}</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160; </div>
<div class="line"><a name="l01124"></a><span class="lineno"><a class="line" href="classvvenc_1_1RateCtrl.html#a3a80b6032f86a56bec74609034b3246f"> 1124</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvvenc_1_1RateCtrl.html#a3a80b6032f86a56bec74609034b3246f">RateCtrl::destroy</a>()</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;{</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;  <span class="keywordflow">if</span> ( <a class="code" href="classvvenc_1_1RateCtrl.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a> != <a class="code" href="CommonDef_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> )</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;  {</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;    <span class="keyword">delete</span> <a class="code" href="classvvenc_1_1RateCtrl.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>;</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    <a class="code" href="classvvenc_1_1RateCtrl.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a> = <a class="code" href="CommonDef_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;  }</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;  <span class="keywordflow">if</span> ( <a class="code" href="classvvenc_1_1RateCtrl.html#a2b5fcef61b77355d86a065adc308528e">encRCGOP</a> != <a class="code" href="CommonDef_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> )</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;  {</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    <span class="keyword">delete</span> <a class="code" href="classvvenc_1_1RateCtrl.html#a2b5fcef61b77355d86a065adc308528e">encRCGOP</a>;</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    <a class="code" href="classvvenc_1_1RateCtrl.html#a2b5fcef61b77355d86a065adc308528e">encRCGOP</a> = <a class="code" href="CommonDef_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;  }</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;  <span class="keywordflow">while</span> ( <a class="code" href="classvvenc_1_1RateCtrl.html#a4849a16cf9c140b9f8194af1a2f0db23">m_listRCPictures</a>.size() &gt; 0 )</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;  {</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    <a class="code" href="classvvenc_1_1EncRCPic.html">EncRCPic</a>* p = <a class="code" href="classvvenc_1_1RateCtrl.html#a4849a16cf9c140b9f8194af1a2f0db23">m_listRCPictures</a>.front();</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;    <a class="code" href="classvvenc_1_1RateCtrl.html#a4849a16cf9c140b9f8194af1a2f0db23">m_listRCPictures</a>.pop_front();</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    <span class="keyword">delete</span> p;</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;  }</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;}</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160; </div>
<div class="line"><a name="l01144"></a><span class="lineno"><a class="line" href="classvvenc_1_1RateCtrl.html#ae94098c4175277c311c4bd6807cca139"> 1144</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvvenc_1_1RateCtrl.html#ae94098c4175277c311c4bd6807cca139">RateCtrl::init</a>( <span class="keywordtype">int</span> totalFrames, <span class="keywordtype">int</span> targetBitrate, <span class="keywordtype">int</span> frameRate, <span class="keywordtype">int</span> intraPeriod, <span class="keywordtype">int</span> GOPSize,</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;                     <span class="keywordtype">int</span> picWidth, <span class="keywordtype">int</span> picHeight, <span class="keywordtype">int</span> LCUWidth, <span class="keywordtype">int</span> LCUHeight, <span class="keywordtype">int</span> bitDepth,</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;                     <span class="keyword">const</span> vvencGOPEntry GOPList[ VVENC_MAX_GOP ], <span class="keywordtype">int</span> maxParallelFrames )</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;{</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;  <a class="code" href="classvvenc_1_1RateCtrl.html#a3a80b6032f86a56bec74609034b3246f">destroy</a>();</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160; </div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;  <span class="keywordtype">bool</span> isLowdelay = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;  <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; GOPSize - 1; i++ )</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;  {</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;    <span class="keywordflow">if</span> ( GOPList[ i ].m_POC &gt; GOPList[ i + 1 ].m_POC )</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    {</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;      isLowdelay = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    }</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;  }</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160; </div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;  <span class="keywordtype">int</span> numberOfLevel = 1;</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;  <span class="keywordtype">int</span> adaptiveBit = 0;</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;  <span class="keywordflow">if</span> ( !isLowdelay &amp;&amp; ( GOPSize == 32 || GOPSize == 16 || GOPSize == 8 ) )</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;  {</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    numberOfLevel = int( log( (<span class="keywordtype">double</span>)GOPSize ) / log( 2.0 ) + 0.5 ) + 1;</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;  }</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;  numberOfLevel++;    <span class="comment">// intra picture</span></div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;  numberOfLevel++;    <span class="comment">// non-reference picture</span></div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160; </div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160; </div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;  <span class="keywordtype">int</span>* bitsRatio;</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;  bitsRatio = <span class="keyword">new</span> <span class="keywordtype">int</span>[ GOPSize ];</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;  <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; GOPSize; i++ )</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;  {</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    bitsRatio[ i ] = 10;</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    <span class="keywordflow">if</span> ( !GOPList[ i ].m_refPic )</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;    {</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;      bitsRatio[ i ] = 2;</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    }</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;  }</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160; </div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;  <span class="keywordtype">double</span> bpp = (double)( targetBitrate / (<span class="keywordtype">double</span>)( frameRate * picWidth * picHeight ) );</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;  <span class="keywordflow">if</span> ( GOPSize == 4 &amp;&amp; isLowdelay )</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;  {</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;    <span class="keywordflow">if</span> ( bpp &gt; 0.2 )</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    {</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;      <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classvvenc_1_1RateCtrl.html#ae94098c4175277c311c4bd6807cca139">init</a>[] = { 2, 3, 2, 6 };</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;      std::copy_n( <a class="code" href="classvvenc_1_1RateCtrl.html#ae94098c4175277c311c4bd6807cca139">init</a>, 4, bitsRatio );</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    }</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( bpp &gt; 0.1 )</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    {</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;      <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classvvenc_1_1RateCtrl.html#ae94098c4175277c311c4bd6807cca139">init</a>[] = { 2, 3, 2, 10 };</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;      std::copy_n( <a class="code" href="classvvenc_1_1RateCtrl.html#ae94098c4175277c311c4bd6807cca139">init</a>, 4, bitsRatio );</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;    }</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( bpp &gt; 0.05 )</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;    {</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;      <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classvvenc_1_1RateCtrl.html#ae94098c4175277c311c4bd6807cca139">init</a>[] = { 2, 3, 2, 12 };</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;      std::copy_n( <a class="code" href="classvvenc_1_1RateCtrl.html#ae94098c4175277c311c4bd6807cca139">init</a>, 4, bitsRatio );</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;    }</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    {</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;      <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classvvenc_1_1RateCtrl.html#ae94098c4175277c311c4bd6807cca139">init</a>[] = { 2, 3, 2, 14 };</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;      std::copy_n( <a class="code" href="classvvenc_1_1RateCtrl.html#ae94098c4175277c311c4bd6807cca139">init</a>, 4, bitsRatio );</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;    }</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160; </div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;    adaptiveBit = 1;</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;  }</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( GOPSize == 8 &amp;&amp; !isLowdelay )</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;  {</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;    <span class="keywordflow">if</span> ( bpp &gt; 0.2 )</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;    {</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;      <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classvvenc_1_1RateCtrl.html#ae94098c4175277c311c4bd6807cca139">init</a>[] = { 15, 5, 4, 1, 1, 4, 1, 1 };</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;      std::copy_n( <a class="code" href="classvvenc_1_1RateCtrl.html#ae94098c4175277c311c4bd6807cca139">init</a>, 8, bitsRatio );</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    }</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( bpp &gt; 0.1 )</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;    {</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;      <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classvvenc_1_1RateCtrl.html#ae94098c4175277c311c4bd6807cca139">init</a>[] = { 20, 6, 4, 1, 1, 4, 1, 1 };</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;      std::copy_n( <a class="code" href="classvvenc_1_1RateCtrl.html#ae94098c4175277c311c4bd6807cca139">init</a>, 8, bitsRatio );</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    }</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( bpp &gt; 0.05 )</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    {</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;      <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classvvenc_1_1RateCtrl.html#ae94098c4175277c311c4bd6807cca139">init</a>[] = { 25, 7, 4, 1, 1, 4, 1, 1 };</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;      std::copy_n( <a class="code" href="classvvenc_1_1RateCtrl.html#ae94098c4175277c311c4bd6807cca139">init</a>, 8, bitsRatio );</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;    }</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;    {</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;      <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classvvenc_1_1RateCtrl.html#ae94098c4175277c311c4bd6807cca139">init</a>[] = { 30, 8, 4, 1, 1, 4, 1, 1 };</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;      std::copy_n( <a class="code" href="classvvenc_1_1RateCtrl.html#ae94098c4175277c311c4bd6807cca139">init</a>, 8, bitsRatio );</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;    }</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160; </div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    adaptiveBit = 2;</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;  }</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( GOPSize == 16 &amp;&amp; !isLowdelay )</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;  {</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;    bitsRatio[  0 ] = (int)( ( -0.5691 * bpp + 0.3577 ) * 1000 + 0.5 );</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;    bitsRatio[  1 ] = (int)( ( -0.0332 * bpp + 0.1782 ) * 1000 + 0.5 );</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    bitsRatio[  2 ] = (int)( (  0.0595 * bpp + 0.0810 ) * 1000 + 0.5 );</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    bitsRatio[  3 ] = (int)( (  0.0710 * bpp + 0.0392 ) * 1000 + 0.5 );</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;    bitsRatio[  4 ] = (int)( (  0.0249 * bpp + 0.0181 ) * 1000 + 0.5 );</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    bitsRatio[  5 ] = (int)( (  0.0249 * bpp + 0.0181 ) * 1000 + 0.5 );</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;    bitsRatio[  6 ] = (int)( (  0.0710 * bpp + 0.0392 ) * 1000 + 0.5 );</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;    bitsRatio[  7 ] = (int)( (  0.0249 * bpp + 0.0181 ) * 1000 + 0.5 );</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;    bitsRatio[  8 ] = (int)( (  0.0249 * bpp + 0.0181 ) * 1000 + 0.5 );</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;    bitsRatio[  9 ] = (int)( (  0.0595 * bpp + 0.0810 ) * 1000 + 0.5 );</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;    bitsRatio[ 10 ] = (int)( (  0.0710 * bpp + 0.0392 ) * 1000 + 0.5 );</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    bitsRatio[ 11 ] = (int)( (  0.0249 * bpp + 0.0181 ) * 1000 + 0.5 );</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;    bitsRatio[ 12 ] = (int)( (  0.0249 * bpp + 0.0181 ) * 1000 + 0.5 );</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;    bitsRatio[ 13 ] = (int)( (  0.0710 * bpp + 0.0392 ) * 1000 + 0.5 );</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;    bitsRatio[ 14 ] = (int)( (  0.0249 * bpp + 0.0181 ) * 1000 + 0.5 );</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    bitsRatio[ 15 ] = (int)( (  0.0249 * bpp + 0.0181 ) * 1000 + 0.5 );</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160; </div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;    adaptiveBit = 2;</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;  }</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( GOPSize == 32 &amp;&amp; !isLowdelay )</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;  {</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> bitsRatioInit[ 4 ][ 6 ] = {</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;      { 16, 10, 8, 4, 2, 1 },</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;      { 16, 10, 8, 4, 2, 1 },</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;      { 16, 10, 8, 4, 2, 1 },</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;      { 10,  8, 6, 4, 2, 1 } };</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;    <span class="keywordtype">int</span> cls;</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    <span class="keywordflow">if</span> ( bpp &gt; 0.2 )</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;    {</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;      cls = 0;</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    }</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( bpp &gt; 0.1 )</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    {</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;      cls = 1;</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;    }</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( bpp &gt; 0.05 )</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;    {</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;      cls = 2;</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    }</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;    {</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;      cls = 3;</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;    }</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> index[ 32 ] = { 0, 1, 2, 3, 4, 5, 5, 4, 5, 5, 3, 4, 5, 5, 4, 5, 5, 2, 3, 4, 5, 5, 4, 5, 5, 3, 4, 5, 5, 4, 5, 5 };</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160; </div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;    <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; 32; i++ )</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;    {</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;      bitsRatio[ i ] = bitsRatioInit[ cls ][ index[ i ] ];</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;    }</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;    adaptiveBit = 2;</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;  }</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;  {</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;    <a class="code" href="namespacevvenc.html#afdcc3f5f4435932506df86e4f2ca6b90">msg</a>( VVENC_WARNING, <span class="stringliteral">&quot;\n hierarchical bit allocation is not currently supported for the specified coding structure.\n&quot;</span> );</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;  }</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160; </div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;  <span class="keywordtype">int</span>* GOPID2Level = <span class="keyword">new</span> <span class="keywordtype">int</span>[ GOPSize ];</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;  <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i&lt;GOPSize; i++ )</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;  {</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    GOPID2Level[ i ] = 1;</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;    <span class="keywordflow">if</span> ( !GOPList[ i ].m_refPic )</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;    {</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;      GOPID2Level[ i ] = 2;</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;    }</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;  }</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160; </div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;  <span class="keywordflow">if</span> ( GOPSize == 4 &amp;&amp; isLowdelay )</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;  {</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classvvenc_1_1RateCtrl.html#ae94098c4175277c311c4bd6807cca139">init</a>[] = { 3, 2, 3, 1 };</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;    std::copy_n( <a class="code" href="classvvenc_1_1RateCtrl.html#ae94098c4175277c311c4bd6807cca139">init</a>, 4, GOPID2Level );</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;  }</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( GOPSize == 8 &amp;&amp; !isLowdelay )</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;  {</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classvvenc_1_1RateCtrl.html#ae94098c4175277c311c4bd6807cca139">init</a>[] = { 1, 2, 3, 4, 4, 3, 4, 4 };</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;    std::copy_n( <a class="code" href="classvvenc_1_1RateCtrl.html#ae94098c4175277c311c4bd6807cca139">init</a>, 8, GOPID2Level );</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;  }</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( GOPSize == 16 &amp;&amp; !isLowdelay )</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;  {</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classvvenc_1_1RateCtrl.html#ae94098c4175277c311c4bd6807cca139">init</a>[] = { 1, 2, 3, 4, 5, 5, 4, 5, 5, 3, 4, 5, 5, 4, 5, 5 };</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;    std::copy_n( <a class="code" href="classvvenc_1_1RateCtrl.html#ae94098c4175277c311c4bd6807cca139">init</a>, 16, GOPID2Level );</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;  }</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( GOPSize == 32 &amp;&amp; !isLowdelay )</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;  {</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classvvenc_1_1RateCtrl.html#ae94098c4175277c311c4bd6807cca139">init</a>[] = { 1, 2, 3, 4,  5, 6, 6, 6,  6, 6, 4, 5,  6, 6, 5, 6,  6, 3, 4, 5,  6, 6, 5, 6,  6, 4, 5, 6,  6, 5, 6, 6 };</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;    std::copy_n( <a class="code" href="classvvenc_1_1RateCtrl.html#ae94098c4175277c311c4bd6807cca139">init</a>, 32, GOPID2Level );</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;  }</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160; </div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;  <a class="code" href="classvvenc_1_1RateCtrl.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a> = <span class="keyword">new</span> <a class="code" href="classvvenc_1_1EncRCSeq.html">EncRCSeq</a>;</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;  <a class="code" href="classvvenc_1_1RateCtrl.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a0c6695ec3f5a446595ddcffa3a806638">create</a>( <a class="code" href="classvvenc_1_1RateCtrl.html#a7314a6a143d85804239b97a36965755f">rcMaxPass</a> == 1, totalFrames, targetBitrate, frameRate, intraPeriod, GOPSize, picWidth, picHeight, LCUWidth, LCUHeight, numberOfLevel, adaptiveBit, <a class="code" href="classvvenc_1_1RateCtrl.html#a9dd6e807e3dfd65b60299ec229f51ae6">getFirstPassStats</a>() );</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;  <a class="code" href="classvvenc_1_1RateCtrl.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a75ac805c2469793c17ab6b63d2e6ba62">initBitsRatio</a>( bitsRatio );</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;  <a class="code" href="classvvenc_1_1RateCtrl.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#abd81d866fc4161422a991e1a9d18a590">initGOPID2Level</a>( GOPID2Level );</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;  <a class="code" href="classvvenc_1_1RateCtrl.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ac77b590e38a8e565a52609ab911451d1">bitDepth</a> = bitDepth;</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classvvenc_1_1RateCtrl.html#a7314a6a143d85804239b97a36965755f">rcMaxPass</a> &lt;= 0) <a class="code" href="classvvenc_1_1RateCtrl.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ae858753d5596f9b39e1a73afe294dd0a">initPicPara</a>();</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;  <a class="code" href="classvvenc_1_1RateCtrl.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a177fb8c710ad770bd0faad793da46ab9">fppParFrames</a> = maxParallelFrames;</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160; </div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;  <span class="keyword">delete</span>[] bitsRatio;</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;  <span class="keyword">delete</span>[] GOPID2Level;</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;}</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160; </div>
<div class="line"><a name="l01333"></a><span class="lineno"><a class="line" href="classvvenc_1_1RateCtrl.html#a6f7e3186e9dcbb329b169bf869bee0f9"> 1333</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvvenc_1_1RateCtrl.html#a6f7e3186e9dcbb329b169bf869bee0f9">RateCtrl::initRCGOP</a> (<span class="keyword">const</span> <span class="keywordtype">int</span> numberOfPictures)</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;{</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;  <a class="code" href="classvvenc_1_1RateCtrl.html#a2b5fcef61b77355d86a065adc308528e">encRCGOP</a> = <span class="keyword">new</span> <a class="code" href="classvvenc_1_1EncRCGOP.html">EncRCGOP</a>;</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;  <a class="code" href="classvvenc_1_1RateCtrl.html#a2b5fcef61b77355d86a065adc308528e">encRCGOP</a>-&gt;<a class="code" href="classvvenc_1_1EncRCGOP.html#a39d3ea6b32b0fb45ae6b9f56609b19b9">create</a> (<a class="code" href="classvvenc_1_1RateCtrl.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>, numberOfPictures);</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;}</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160; </div>
<div class="line"><a name="l01339"></a><span class="lineno"><a class="line" href="classvvenc_1_1RateCtrl.html#a79f7acf16b464529fa6bb95693ce8c8f"> 1339</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvvenc_1_1RateCtrl.html#a79f7acf16b464529fa6bb95693ce8c8f">RateCtrl::destroyRCGOP</a>()</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;{</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;  <span class="keyword">delete</span> <a class="code" href="classvvenc_1_1RateCtrl.html#a2b5fcef61b77355d86a065adc308528e">encRCGOP</a>;</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;  <a class="code" href="classvvenc_1_1RateCtrl.html#a2b5fcef61b77355d86a065adc308528e">encRCGOP</a> = <a class="code" href="CommonDef_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;}</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160; </div>
<div class="line"><a name="l01345"></a><span class="lineno"><a class="line" href="classvvenc_1_1RateCtrl.html#aa147428e6e802a31501dbe56fefab751"> 1345</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvvenc_1_1RateCtrl.html#aa147428e6e802a31501dbe56fefab751">RateCtrl::setRCPass</a> (<span class="keyword">const</span> <span class="keywordtype">int</span> pass, <span class="keyword">const</span> <span class="keywordtype">int</span> maxPass)</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;{</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;  <a class="code" href="classvvenc_1_1RateCtrl.html#ab4eb30394f0c5fe824c23077d4258bf6">rcPass</a>        = pass;</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;  <a class="code" href="classvvenc_1_1RateCtrl.html#a7314a6a143d85804239b97a36965755f">rcMaxPass</a>     = maxPass;</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;  <a class="code" href="classvvenc_1_1RateCtrl.html#a5a6de978047f62096b6c0d20659e756b">rcIsFinalPass</a> = (pass &gt;= maxPass);</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;}</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160; </div>
<div class="line"><a name="l01352"></a><span class="lineno"><a class="line" href="classvvenc_1_1RateCtrl.html#a44454aab4f68d33cad07a7bc2213af81"> 1352</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvvenc_1_1RateCtrl.html#a44454aab4f68d33cad07a7bc2213af81">RateCtrl::processFirstPassData</a> (<span class="keyword">const</span> <span class="keywordtype">int</span> secondPassBaseQP)</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;{</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;  <a class="code" href="StatCounter_8h.html#a87a0b8601d301b04efad305d35b8ba20">CHECK</a>( <a class="code" href="classvvenc_1_1RateCtrl.html#a61918dfad5b3d7354ea66212c73e62d1">m_listRCFirstPassStats</a>.size() == 0, <span class="stringliteral">&quot;No data available from the first pass!&quot;</span> );</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160; </div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;  <a class="code" href="classvvenc_1_1RateCtrl.html#a61918dfad5b3d7354ea66212c73e62d1">m_listRCFirstPassStats</a>.sort( []( <span class="keyword">const</span> <a class="code" href="structvvenc_1_1TRCPassStats.html">TRCPassStats</a>&amp; a, <span class="keyword">const</span> <a class="code" href="structvvenc_1_1TRCPassStats.html">TRCPassStats</a>&amp; b ) { <span class="keywordflow">return</span> a.<a class="code" href="structvvenc_1_1TRCPassStats.html#af1fa96a850f404aded578d3e29dedbcb">poc</a> &lt; b.<a class="code" href="structvvenc_1_1TRCPassStats.html#af1fa96a850f404aded578d3e29dedbcb">poc</a>; } );</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160; </div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;  <span class="comment">// run a simple scene change detection</span></div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;  <a class="code" href="classvvenc_1_1RateCtrl.html#a8e9b3197dbe3e05240316465571a224f">detectNewScene</a>();</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160; </div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;  <span class="comment">// process and scale GOP and frame bits using the data from the first pass to account for different target bitrates</span></div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;  <a class="code" href="classvvenc_1_1RateCtrl.html#a9999fe1b98bedff27bb63d4fc0668c36">processGops</a> (secondPassBaseQP);</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160; </div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;  <span class="comment">// loop though the first pass data and update RC parameters when new scenes are detected</span></div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;  <a class="code" href="classvvenc_1_1RateCtrl.html#a98f6c7eeb90433d8872112409d7e32f1">adaptToSceneChanges</a>();</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;}</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160; </div>
<div class="line"><a name="l01368"></a><span class="lineno"><a class="line" href="classvvenc_1_1RateCtrl.html#a561871957c2beb5abbfd5f1bcf270f72"> 1368</a></span>&#160;uint64_t <a class="code" href="classvvenc_1_1RateCtrl.html#a561871957c2beb5abbfd5f1bcf270f72">RateCtrl::getTotalBitsInFirstPass</a>()</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;{</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;  uint64_t totalBitsFirstPass = 0;</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;  std::list&lt;TRCPassStats&gt;::iterator it;</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160; </div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;  <span class="keywordflow">for</span> (it = <a class="code" href="classvvenc_1_1RateCtrl.html#a61918dfad5b3d7354ea66212c73e62d1">m_listRCFirstPassStats</a>.begin(); it != <a class="code" href="classvvenc_1_1RateCtrl.html#a61918dfad5b3d7354ea66212c73e62d1">m_listRCFirstPassStats</a>.end(); it++)</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;  {</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;    totalBitsFirstPass += it-&gt;numBits;</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;  }</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160; </div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;  <span class="keywordflow">return</span> totalBitsFirstPass;</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;}</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160; </div>
<div class="line"><a name="l01381"></a><span class="lineno"><a class="line" href="classvvenc_1_1RateCtrl.html#a8e9b3197dbe3e05240316465571a224f"> 1381</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvvenc_1_1RateCtrl.html#a8e9b3197dbe3e05240316465571a224f">RateCtrl::detectNewScene</a>()</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;{</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;  uint16_t visActPrev = 0;</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;  <span class="keywordtype">double</span>   psnrPrev = 0.0;</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;  std::list&lt;TRCPassStats&gt;::iterator it;</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160; </div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;  <span class="keywordflow">for</span> (it = <a class="code" href="classvvenc_1_1RateCtrl.html#a61918dfad5b3d7354ea66212c73e62d1">m_listRCFirstPassStats</a>.begin(); it != <a class="code" href="classvvenc_1_1RateCtrl.html#a61918dfad5b3d7354ea66212c73e62d1">m_listRCFirstPassStats</a>.end(); it++)</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;  {</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;    it-&gt;isNewScene = ((it-&gt;visActY * 64 &gt; visActPrev * 181) || (it-&gt;tempLayer &lt;= 1 &amp;&amp; it-&gt;visActY &lt;= (1u &lt;&lt; (<a class="code" href="classvvenc_1_1RateCtrl.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ac77b590e38a8e565a52609ab911451d1">bitDepth</a> - 6))) || (it-&gt;isIntra &amp;&amp; it-&gt;visActY &gt; visActPrev &amp;&amp; std::abs(it-&gt;psnrY - psnrPrev) &gt; 4.5));</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;    visActPrev = it-&gt;visActY;</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;    <span class="keywordflow">if</span> (it-&gt;isIntra) psnrPrev = it-&gt;psnrY;</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;  }</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;}</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160; </div>
<div class="line"><a name="l01395"></a><span class="lineno"><a class="line" href="classvvenc_1_1RateCtrl.html#a9999fe1b98bedff27bb63d4fc0668c36"> 1395</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvvenc_1_1RateCtrl.html#a9999fe1b98bedff27bb63d4fc0668c36">RateCtrl::processGops</a> (<span class="keyword">const</span> <span class="keywordtype">int</span> secondPassBaseQP)</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;{</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> fps = <a class="code" href="classvvenc_1_1RateCtrl.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#aebcd9a87b695d3618612fcba5248dbf8">frameRate</a>;</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> gopShift = int (0.5 + log ((<span class="keywordtype">double</span>) <a class="code" href="classvvenc_1_1RateCtrl.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ad0db87e2ca0c90c9609a9a82f52174a5">gopSize</a>) / log (2.0));</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> qpOffset = Clip3 (0, 6, ((secondPassBaseQP + 1) &gt;&gt; 1) - 9);</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> bp1pf = <a class="code" href="classvvenc_1_1RateCtrl.html#a561871957c2beb5abbfd5f1bcf270f72">getTotalBitsInFirstPass</a>() / (double) <a class="code" href="classvvenc_1_1RateCtrl.html#a61918dfad5b3d7354ea66212c73e62d1">m_listRCFirstPassStats</a>.size(); <span class="comment">// first pass</span></div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> ratio = (double) <a class="code" href="classvvenc_1_1RateCtrl.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#a4fd2f41f944b9e6ffa3df9815904bed8">targetRate</a> / (fps * bp1pf);  <span class="comment">// ratio of second and first pass</span></div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> rp[6] = { pow (ratio, 0.5), pow (ratio, 0.75), pow (ratio, 0.875), pow (ratio, 0.9375), pow (ratio, 0.96875), pow (ratio, 0.984375) };</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;  std::list&lt;TRCPassStats&gt;::iterator it;</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;  std::vector&lt;uint32_t&gt; gopBits (2 + (<a class="code" href="classvvenc_1_1RateCtrl.html#a61918dfad5b3d7354ea66212c73e62d1">m_listRCFirstPassStats</a>.size() - 1) / <a class="code" href="classvvenc_1_1RateCtrl.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ad0db87e2ca0c90c9609a9a82f52174a5">gopSize</a>); <span class="comment">// +2 for the first I frame (GOP) and a potential last incomplete GOP</span></div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;  std::vector&lt;uint32_t&gt; tgtBits (2 + (<a class="code" href="classvvenc_1_1RateCtrl.html#a61918dfad5b3d7354ea66212c73e62d1">m_listRCFirstPassStats</a>.size() - 1) / <a class="code" href="classvvenc_1_1RateCtrl.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ad0db87e2ca0c90c9609a9a82f52174a5">gopSize</a>);</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160; </div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;  <span class="keywordflow">for</span> (it = <a class="code" href="classvvenc_1_1RateCtrl.html#a61918dfad5b3d7354ea66212c73e62d1">m_listRCFirstPassStats</a>.begin(); it != <a class="code" href="classvvenc_1_1RateCtrl.html#a61918dfad5b3d7354ea66212c73e62d1">m_listRCFirstPassStats</a>.end(); it++) <span class="comment">// scaling, part 1</span></div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;  {</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> vecIdx = 1 + ((it-&gt;poc - 1) &gt;&gt; gopShift);</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160; </div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;    it-&gt;targetBits = std::max (0, <span class="keywordtype">int</span> (0.5 + it-&gt;numBits * (it-&gt;tempLayer + qpOffset &lt; 6 ? rp[it-&gt;tempLayer + qpOffset] : ratio)));</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;    gopBits[vecIdx] += (uint32_t) it-&gt;targetBits; <span class="comment">// similar to g in VCIP paper</span></div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;    tgtBits[vecIdx] += (uint32_t) (0.5 + it-&gt;numBits * ratio);</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;  }</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;  <span class="keywordflow">for</span> (it = <a class="code" href="classvvenc_1_1RateCtrl.html#a61918dfad5b3d7354ea66212c73e62d1">m_listRCFirstPassStats</a>.begin(); it != <a class="code" href="classvvenc_1_1RateCtrl.html#a61918dfad5b3d7354ea66212c73e62d1">m_listRCFirstPassStats</a>.end(); it++) <span class="comment">// scaling, part 2</span></div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;  {</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> vecIdx = 1 + ((it-&gt;poc - 1) &gt;&gt; gopShift);</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160; </div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;    it-&gt;frameInGopRatio = (double) it-&gt;targetBits / gopBits[vecIdx];</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;    it-&gt;targetBits = std::max (1, int (0.5 + it-&gt;frameInGopRatio * tgtBits[vecIdx]));</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;  }</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;}</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160; </div>
<div class="line"><a name="l01424"></a><span class="lineno"><a class="line" href="classvvenc_1_1RateCtrl.html#a98f6c7eeb90433d8872112409d7e32f1"> 1424</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvvenc_1_1RateCtrl.html#a98f6c7eeb90433d8872112409d7e32f1">RateCtrl::adaptToSceneChanges</a>()</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;{</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> numOfLevels = int ( log( <a class="code" href="classvvenc_1_1RateCtrl.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ad0db87e2ca0c90c9609a9a82f52174a5">gopSize</a> ) / log( 2.0 ) + 0.5 ) + 2;</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160; </div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;  std::list&lt;TRCPassStats&gt;::iterator it;</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;  <span class="keywordtype">int</span> prevSceneChange = -100;</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;  <span class="keywordflow">for</span> ( it = <a class="code" href="classvvenc_1_1RateCtrl.html#a61918dfad5b3d7354ea66212c73e62d1">m_listRCFirstPassStats</a>.begin(); it != <a class="code" href="classvvenc_1_1RateCtrl.html#a61918dfad5b3d7354ea66212c73e62d1">m_listRCFirstPassStats</a>.end(); it++ )</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;  {</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;    <span class="keywordflow">if</span> ( it-&gt;isNewScene ) <span class="comment">// filter out scene cuts which happen too close to the previous detected scene cut</span></div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;    {</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;      <span class="keywordflow">if</span> ( it-&gt;poc &gt;= prevSceneChange + (<a class="code" href="classvvenc_1_1RateCtrl.html#ac792156088c1bfd18ac85b5835b95540">encRCSeq</a>-&gt;<a class="code" href="classvvenc_1_1EncRCSeq.html#ad0db87e2ca0c90c9609a9a82f52174a5">gopSize</a> &gt;&gt; 1) )</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;      {</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;        prevSceneChange = it-&gt;poc;</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;      }</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;      {</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;        it-&gt;isNewScene = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;      }</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;    }</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;  }</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160; </div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;  <span class="comment">// assumption: scene cut detection data cleaned and RC parameters updated; first-pass data sorted by POC</span></div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;  <span class="comment">// mark frames where parameter refresh is needed after a scene cut</span></div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;  <span class="keywordtype">bool</span>* refreshNeeded = <span class="keyword">new</span> <span class="keywordtype">bool</span>[ numOfLevels ];</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;  <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; numOfLevels; i++ )</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;  {</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;    refreshNeeded[ i ] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;  }</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;  <span class="keywordflow">for</span> ( it = <a class="code" href="classvvenc_1_1RateCtrl.html#a61918dfad5b3d7354ea66212c73e62d1">m_listRCFirstPassStats</a>.begin(); it != <a class="code" href="classvvenc_1_1RateCtrl.html#a61918dfad5b3d7354ea66212c73e62d1">m_listRCFirstPassStats</a>.end(); it++ )</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;  {</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;    <span class="keywordflow">if</span> ( it-&gt;isNewScene )</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;    {</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;      <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; numOfLevels; i++ )</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;      {</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;        refreshNeeded[ i ] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;      }</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;    }</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;    it-&gt;refreshParameters = refreshNeeded[ it-&gt;tempLayer ];</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;    refreshNeeded[ it-&gt;tempLayer ] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;  }</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160; </div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;  <span class="keyword">delete</span>[] refreshNeeded;</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;}</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160; </div>
<div class="line"><a name="l01468"></a><span class="lineno"><a class="line" href="classvvenc_1_1RateCtrl.html#ab932255b352c7d7ccade22225676ef05"> 1468</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvvenc_1_1RateCtrl.html#ab932255b352c7d7ccade22225676ef05">RateCtrl::addRCPassStats</a> (<span class="keyword">const</span> <span class="keywordtype">int</span> poc, <span class="keyword">const</span> <span class="keywordtype">int</span> qp, <span class="keyword">const</span> <span class="keywordtype">double</span> lambda, <span class="keyword">const</span> uint16_t visActY,</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;                               <span class="keyword">const</span> uint32_t numBits, <span class="keyword">const</span> <span class="keywordtype">double</span> psnrY, <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="namespacevvenc_1_1CU.html#ab722b39b132601673d1dcd3547c2c01c">isIntra</a>, <span class="keyword">const</span> <span class="keywordtype">int</span> tempLayer)</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;{</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classvvenc_1_1RateCtrl.html#ab4eb30394f0c5fe824c23077d4258bf6">rcPass</a> &lt; <a class="code" href="classvvenc_1_1RateCtrl.html#a7314a6a143d85804239b97a36965755f">rcMaxPass</a>)</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;  {</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;    <a class="code" href="classvvenc_1_1RateCtrl.html#a61918dfad5b3d7354ea66212c73e62d1">m_listRCFirstPassStats</a>.push_back( <a class="code" href="structvvenc_1_1TRCPassStats.html">TRCPassStats</a>( poc, qp, lambda, visActY,</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;                                                    numBits, psnrY, <a class="code" href="namespacevvenc_1_1CU.html#ab722b39b132601673d1dcd3547c2c01c">isIntra</a>, tempLayer ) );</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;  }</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;}</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160; </div>
<div class="line"><a name="l01478"></a><span class="lineno"><a class="line" href="namespacevvenc.html#a7f349632878be19b99945fca37c91813"> 1478</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="namespacevvenc.html#a7f349632878be19b99945fca37c91813">xCalcHADs8x8_ISlice</a>( <span class="keyword">const</span> <a class="code" href="namespacevvenc.html#a788273bea30966f2f3088cc9d64f2f33">Pel</a> *piOrg, <span class="keyword">const</span> <span class="keywordtype">int</span> iStrideOrg )</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;{</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;  <span class="keywordtype">int</span> k, i, j, jj;</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;  <span class="keywordtype">int</span> diff[ 64 ], m1[ 8 ][ 8 ], m2[ 8 ][ 8 ], m3[ 8 ][ 8 ], iSumHad = 0;</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160; </div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;  <span class="keywordflow">for</span> ( k = 0; k &lt; 64; k += 8 )</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;  {</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;    diff[ k + 0 ] = piOrg[ 0 ];</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;    diff[ k + 1 ] = piOrg[ 1 ];</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;    diff[ k + 2 ] = piOrg[ 2 ];</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;    diff[ k + 3 ] = piOrg[ 3 ];</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;    diff[ k + 4 ] = piOrg[ 4 ];</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;    diff[ k + 5 ] = piOrg[ 5 ];</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;    diff[ k + 6 ] = piOrg[ 6 ];</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;    diff[ k + 7 ] = piOrg[ 7 ];</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160; </div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;    piOrg += iStrideOrg;</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;  }</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160; </div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;  <span class="comment">//horizontal</span></div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;  <span class="keywordflow">for</span> ( j = 0; j &lt; 8; j++ )</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;  {</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;    jj = j &lt;&lt; 3;</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;    m2[ j ][ 0 ] = diff[ jj ] + diff[ jj + 4 ];</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;    m2[ j ][ 1 ] = diff[ jj + 1 ] + diff[ jj + 5 ];</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;    m2[ j ][ 2 ] = diff[ jj + 2 ] + diff[ jj + 6 ];</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;    m2[ j ][ 3 ] = diff[ jj + 3 ] + diff[ jj + 7 ];</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;    m2[ j ][ 4 ] = diff[ jj ] - diff[ jj + 4 ];</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;    m2[ j ][ 5 ] = diff[ jj + 1 ] - diff[ jj + 5 ];</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;    m2[ j ][ 6 ] = diff[ jj + 2 ] - diff[ jj + 6 ];</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;    m2[ j ][ 7 ] = diff[ jj + 3 ] - diff[ jj + 7 ];</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160; </div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;    m1[ j ][ 0 ] = m2[ j ][ 0 ] + m2[ j ][ 2 ];</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;    m1[ j ][ 1 ] = m2[ j ][ 1 ] + m2[ j ][ 3 ];</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;    m1[ j ][ 2 ] = m2[ j ][ 0 ] - m2[ j ][ 2 ];</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;    m1[ j ][ 3 ] = m2[ j ][ 1 ] - m2[ j ][ 3 ];</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;    m1[ j ][ 4 ] = m2[ j ][ 4 ] + m2[ j ][ 6 ];</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;    m1[ j ][ 5 ] = m2[ j ][ 5 ] + m2[ j ][ 7 ];</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;    m1[ j ][ 6 ] = m2[ j ][ 4 ] - m2[ j ][ 6 ];</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;    m1[ j ][ 7 ] = m2[ j ][ 5 ] - m2[ j ][ 7 ];</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160; </div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;    m2[ j ][ 0 ] = m1[ j ][ 0 ] + m1[ j ][ 1 ];</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;    m2[ j ][ 1 ] = m1[ j ][ 0 ] - m1[ j ][ 1 ];</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;    m2[ j ][ 2 ] = m1[ j ][ 2 ] + m1[ j ][ 3 ];</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;    m2[ j ][ 3 ] = m1[ j ][ 2 ] - m1[ j ][ 3 ];</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;    m2[ j ][ 4 ] = m1[ j ][ 4 ] + m1[ j ][ 5 ];</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;    m2[ j ][ 5 ] = m1[ j ][ 4 ] - m1[ j ][ 5 ];</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;    m2[ j ][ 6 ] = m1[ j ][ 6 ] + m1[ j ][ 7 ];</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;    m2[ j ][ 7 ] = m1[ j ][ 6 ] - m1[ j ][ 7 ];</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;  }</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160; </div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;  <span class="comment">//vertical</span></div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;  <span class="keywordflow">for</span> ( i = 0; i &lt; 8; i++ )</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;  {</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;    m3[ 0 ][ i ] = m2[ 0 ][ i ] + m2[ 4 ][ i ];</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;    m3[ 1 ][ i ] = m2[ 1 ][ i ] + m2[ 5 ][ i ];</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;    m3[ 2 ][ i ] = m2[ 2 ][ i ] + m2[ 6 ][ i ];</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;    m3[ 3 ][ i ] = m2[ 3 ][ i ] + m2[ 7 ][ i ];</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;    m3[ 4 ][ i ] = m2[ 0 ][ i ] - m2[ 4 ][ i ];</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;    m3[ 5 ][ i ] = m2[ 1 ][ i ] - m2[ 5 ][ i ];</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;    m3[ 6 ][ i ] = m2[ 2 ][ i ] - m2[ 6 ][ i ];</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;    m3[ 7 ][ i ] = m2[ 3 ][ i ] - m2[ 7 ][ i ];</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160; </div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;    m1[ 0 ][ i ] = m3[ 0 ][ i ] + m3[ 2 ][ i ];</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;    m1[ 1 ][ i ] = m3[ 1 ][ i ] + m3[ 3 ][ i ];</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;    m1[ 2 ][ i ] = m3[ 0 ][ i ] - m3[ 2 ][ i ];</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;    m1[ 3 ][ i ] = m3[ 1 ][ i ] - m3[ 3 ][ i ];</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;    m1[ 4 ][ i ] = m3[ 4 ][ i ] + m3[ 6 ][ i ];</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;    m1[ 5 ][ i ] = m3[ 5 ][ i ] + m3[ 7 ][ i ];</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;    m1[ 6 ][ i ] = m3[ 4 ][ i ] - m3[ 6 ][ i ];</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;    m1[ 7 ][ i ] = m3[ 5 ][ i ] - m3[ 7 ][ i ];</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160; </div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;    m2[ 0 ][ i ] = m1[ 0 ][ i ] + m1[ 1 ][ i ];</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;    m2[ 1 ][ i ] = m1[ 0 ][ i ] - m1[ 1 ][ i ];</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;    m2[ 2 ][ i ] = m1[ 2 ][ i ] + m1[ 3 ][ i ];</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;    m2[ 3 ][ i ] = m1[ 2 ][ i ] - m1[ 3 ][ i ];</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;    m2[ 4 ][ i ] = m1[ 4 ][ i ] + m1[ 5 ][ i ];</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;    m2[ 5 ][ i ] = m1[ 4 ][ i ] - m1[ 5 ][ i ];</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;    m2[ 6 ][ i ] = m1[ 6 ][ i ] + m1[ 7 ][ i ];</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;    m2[ 7 ][ i ] = m1[ 6 ][ i ] - m1[ 7 ][ i ];</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;  }</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160; </div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;  <span class="keywordflow">for</span> ( i = 0; i &lt; 8; i++ )</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;  {</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;    <span class="keywordflow">for</span> ( j = 0; j &lt; 8; j++ )</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;    {</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;      iSumHad += std::abs( m2[ i ][ j ] );</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;    }</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;  }</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;  iSumHad -= std::abs( m2[ 0 ][ 0 ] );</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;  iSumHad = ( iSumHad + 2 ) &gt;&gt; 2;</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;  <span class="keywordflow">return</span>( iSumHad );</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;}</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160; </div>
<div class="line"><a name="l01572"></a><span class="lineno"><a class="line" href="namespacevvenc.html#a166ed3b561f2f4b2071ba9cbdda38d86"> 1572</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="namespacevvenc.html#a166ed3b561f2f4b2071ba9cbdda38d86">updateCtuDataISlice</a>( <span class="keyword">const</span> <a class="code" href="structvvenc_1_1AreaBuf.html">CPelBuf</a> buf )</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;{</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;  <span class="keywordtype">int</span>  xBl, yBl;</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> iBlkSize = 8;</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacevvenc.html#a788273bea30966f2f3088cc9d64f2f33">Pel</a>* pOrgInit = buf.<a class="code" href="structvvenc_1_1AreaBuf.html#a915dd15479b8b2a6e8bff45b0420e37f">buf</a>;</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;  <span class="keywordtype">int</span>  iStrideOrig = buf.<a class="code" href="structvvenc_1_1AreaBuf.html#a08f66a6870d87afcd5dc1b60d1019692">stride</a>;</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160; </div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;  <span class="keywordtype">int</span> iSumHad = 0;</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;  <span class="keywordflow">for</span> ( yBl = 0; ( yBl + iBlkSize ) &lt;= buf.<a class="code" href="structvvenc_1_1Size.html#acec3c14453d8e16034230db557345f1e">height</a>; yBl += iBlkSize )</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;  {</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;    <span class="keywordflow">for</span> ( xBl = 0; ( xBl + iBlkSize ) &lt;= buf.<a class="code" href="structvvenc_1_1Size.html#a81ed27f96c08781589ca6ff77043a7b1">width</a>; xBl += iBlkSize )</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;    {</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacevvenc.html#a788273bea30966f2f3088cc9d64f2f33">Pel</a>* pOrg = pOrgInit + iStrideOrig*yBl + xBl;</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;      iSumHad += <a class="code" href="namespacevvenc.html#a7f349632878be19b99945fca37c91813">xCalcHADs8x8_ISlice</a>( pOrg, iStrideOrig );</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;    }</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;  }</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;  <span class="keywordflow">return</span>( iSumHad );</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;}</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160; </div>
<div class="line"><a name="l01591"></a><span class="lineno"><a class="line" href="classvvenc_1_1EncRCPic.html#a6dca3fb01fb0bdc3024a26d2c069b89e"> 1591</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classvvenc_1_1EncRCPic.html#a6dca3fb01fb0bdc3024a26d2c069b89e">EncRCPic::calCostSliceI</a>( <a class="code" href="structvvenc_1_1Picture.html">Picture</a>* pic ) <span class="comment">// TODO: this only analyses the first slice segment. What about the others?</span></div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;{</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;  <span class="keywordtype">double</span>      iSumHadSlice = 0;</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;  <span class="keyword">const</span> <a class="code" href="classvvenc_1_1PreCalcValues.html">PreCalcValues</a>&amp; pcv = *pic-&gt;<a class="code" href="structvvenc_1_1Picture.html#a83dedaccc39c9d31f3ef20ff7ccb4b4f">cs</a>-&gt;<a class="code" href="classvvenc_1_1CodingStructure.html#a5e9c1ca891ed69b925ad083b0e92c641">pcv</a>;</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span>          shift = pic-&gt;<a class="code" href="structvvenc_1_1Picture.html#a83dedaccc39c9d31f3ef20ff7ccb4b4f">cs</a>-&gt;<a class="code" href="classvvenc_1_1CodingStructure.html#a2d3ec636d347d8ea142e64ca27ceaad4">sps</a>-&gt;<a class="code" href="structvvenc_1_1SPS.html#a698a46d463e05520421479a1ac78eb05">bitDepths</a>[ <a class="code" href="namespacevvenc.html#a19a96edeeb9d37072c4ce9f862d19ba8a9eef8706f96e8b3511a2450e90075f59">CH_L</a> ] - 8;</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span>         offset = ( shift&gt;0 ) ? ( 1 &lt;&lt; ( shift - 1 ) ) : 0;</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160; </div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;  <span class="keywordflow">for</span> ( uint32_t ctuIdx = 0; ctuIdx &lt; pic-&gt;<a class="code" href="structvvenc_1_1Picture.html#a83dedaccc39c9d31f3ef20ff7ccb4b4f">cs</a>-&gt;<a class="code" href="classvvenc_1_1CodingStructure.html#a5e9c1ca891ed69b925ad083b0e92c641">pcv</a>-&gt;<a class="code" href="classvvenc_1_1PreCalcValues.html#a52cdd32a3b7ffde866c7f2d6cd7d7df6">sizeInCtus</a>; ctuIdx++ )</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;  {</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;    uint32_t ctuRsAddr = ctuIdx;</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;    <a class="code" href="structvvenc_1_1Position.html">Position</a> pos( ( ctuRsAddr % pcv.<a class="code" href="classvvenc_1_1PreCalcValues.html#a38f9d60d3484f67626f5198df8170b51">widthInCtus</a> ) * pcv.<a class="code" href="classvvenc_1_1PreCalcValues.html#afcdcde8a5587ac7f5495cd5b31fefb17">maxCUSize</a>, ( ctuRsAddr / pcv.<a class="code" href="classvvenc_1_1PreCalcValues.html#a38f9d60d3484f67626f5198df8170b51">widthInCtus</a> ) * pcv.<a class="code" href="classvvenc_1_1PreCalcValues.html#afcdcde8a5587ac7f5495cd5b31fefb17">maxCUSize</a> );</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160; </div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> height = std::min( pcv.<a class="code" href="classvvenc_1_1PreCalcValues.html#afcdcde8a5587ac7f5495cd5b31fefb17">maxCUSize</a>, pcv.<a class="code" href="classvvenc_1_1PreCalcValues.html#af17e83769be75df61e6eee524af767a0">lumaHeight</a> - pos.<a class="code" href="structvvenc_1_1Position.html#a4f5d13e73c7d4e9eae1aa12beac2fda8">y</a> );</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> width = std::min( pcv.<a class="code" href="classvvenc_1_1PreCalcValues.html#afcdcde8a5587ac7f5495cd5b31fefb17">maxCUSize</a>, pcv.<a class="code" href="classvvenc_1_1PreCalcValues.html#a83cf297779a1afc59e7d71a87d575861">lumaWidth</a> - pos.<a class="code" href="structvvenc_1_1Position.html#a9685e0c777668f378eb6fa531933ac6a">x</a> );</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;    <span class="keyword">const</span> <a class="code" href="structvvenc_1_1CompArea.html">CompArea</a> blk( <a class="code" href="namespacevvenc.html#af483359f17deab82472b16da461a9a0fa3b276b5937d942b2fe5cbfa69d5a016a">COMP_Y</a>, pcv.<a class="code" href="classvvenc_1_1PreCalcValues.html#accd995becc51735172dd859be536687a">chrFormat</a>, pos, <a class="code" href="structvvenc_1_1Size.html">Size</a>( width, height ) );</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;    <span class="keywordtype">int</span> iSumHad = <a class="code" href="namespacevvenc.html#a166ed3b561f2f4b2071ba9cbdda38d86">updateCtuDataISlice</a>( pic-&gt;<a class="code" href="structvvenc_1_1Picture.html#a7b8e59f547b3a21d59f72e2fd97f751c">getOrigBuf</a>( blk ) );</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160; </div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;    <span class="keywordtype">int</span> cost = ( iSumHad + offset ) &gt;&gt; shift;</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;    iSumHadSlice += cost;</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;  }</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160; </div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;  <a class="code" href="classvvenc_1_1EncRCPic.html#a99e631187ad969a67befaf60f7f441f3">totalCostIntra</a> = iSumHadSlice;</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;}</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160; </div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160; </div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="astructvvenc_1_1TRCParameter_html_a20f4c4490bc8ecbdd1ffcb79acce6035"><div class="ttname"><a href="structvvenc_1_1TRCParameter.html#a20f4c4490bc8ecbdd1ffcb79acce6035">vvenc::TRCParameter::alpha</a></div><div class="ttdeci">double alpha</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00076">RateCtrl.h:76</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_a166b361eddf214b13bba8bb03218a165"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#a166b361eddf214b13bba8bb03218a165">vvenc::EncRCPic::rcIdxInGop</a></div><div class="ttdeci">int rcIdxInGop</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00224">RateCtrl.h:224</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_ab860e42c655773f0dd240021634c82fd"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#ab860e42c655773f0dd240021634c82fd">vvenc::EncRCPic::EncRCPic</a></div><div class="ttdeci">EncRCPic()</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00581">RateCtrl.cpp:581</a></div></div>
<div class="ttc" id="aclassvvenc_1_1RateCtrl_html_a7314a6a143d85804239b97a36965755f"><div class="ttname"><a href="classvvenc_1_1RateCtrl.html#a7314a6a143d85804239b97a36965755f">vvenc::RateCtrl::rcMaxPass</a></div><div class="ttdeci">int rcMaxPass</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00280">RateCtrl.h:280</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCGOP_html_a605565fdf0a219dff93994674ba113e9"><div class="ttname"><a href="classvvenc_1_1EncRCGOP.html#a605565fdf0a219dff93994674ba113e9">vvenc::EncRCGOP::picTargetBitInGOP</a></div><div class="ttdeci">int * picTargetBitInGOP</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00180">RateCtrl.h:180</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_a516a779a4b162eddb49c63d03b75c2a9"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#a516a779a4b162eddb49c63d03b75c2a9">vvenc::EncRCSeq::numberOfLCU</a></div><div class="ttdeci">int numberOfLCU</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00136">RateCtrl.h:136</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_a27f637ec99a55ae334338affeca0e1d7"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#a27f637ec99a55ae334338affeca0e1d7">vvenc::EncRCPic::refreshParams</a></div><div class="ttdeci">bool refreshParams</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00244">RateCtrl.h:244</a></div></div>
<div class="ttc" id="astructvvenc_1_1Size_html"><div class="ttname"><a href="structvvenc_1_1Size.html">vvenc::Size</a></div><div class="ttdef"><b>Definition:</b> <a href="Common_8h_source.html#l00080">Common.h:80</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_a8fef0bac5e1611ffdb8b0b437ea98d8b"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#a8fef0bac5e1611ffdb8b0b437ea98d8b">vvenc::EncRCSeq::bitsRatio</a></div><div class="ttdeci">int * bitsRatio</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00150">RateCtrl.h:150</a></div></div>
<div class="ttc" id="aclassvvenc_1_1RateCtrl_html_a9999fe1b98bedff27bb63d4fc0668c36"><div class="ttname"><a href="classvvenc_1_1RateCtrl.html#a9999fe1b98bedff27bb63d4fc0668c36">vvenc::RateCtrl::processGops</a></div><div class="ttdeci">void processGops(const int secondPassBaseQP)</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l01395">RateCtrl.cpp:1395</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_aa8c918708805c64a7d573936acf8e19d"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#aa8c918708805c64a7d573936acf8e19d">vvenc::EncRCPic::clipQpFrameRc</a></div><div class="ttdeci">void clipQpFrameRc(std::list&lt; EncRCPic * &gt; &amp;listPreviousPictures, int &amp;QP)</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00883">RateCtrl.cpp:883</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_aa03c2b87d895da2089dcc9e5448b7cd2"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#aa03c2b87d895da2089dcc9e5448b7cd2">vvenc::EncRCSeq::framesCoded</a></div><div class="ttdeci">int framesCoded</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00137">RateCtrl.h:137</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_ad6f561fb8a4aed1c50d7b7c03e716078"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#ad6f561fb8a4aed1c50d7b7c03e716078">vvenc::EncRCPic::estimatePicQP</a></div><div class="ttdeci">int estimatePicQP(double lambda, std::list&lt; EncRCPic * &gt; &amp;listPreviousPictures)</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00871">RateCtrl.cpp:871</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_a75852d45ae317ffce5daf5eb321b167a"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#a75852d45ae317ffce5daf5eb321b167a">vvenc::EncRCSeq::intraPeriod</a></div><div class="ttdeci">int intraPeriod</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00134">RateCtrl.h:134</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCGOP_html_a5616af21697c6fbd66212a2ef31035fc"><div class="ttname"><a href="classvvenc_1_1EncRCGOP.html#a5616af21697c6fbd66212a2ef31035fc">vvenc::EncRCGOP::xSolveEqua</a></div><div class="ttdeci">double xSolveEqua(EncRCSeq *encRCSeq, double targetBpp, double *equaCoeffA, double *equaCoeffB, int GOPSize)</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00522">RateCtrl.cpp:522</a></div></div>
<div class="ttc" id="anamespacevvenc_html_ad8687adca4e586b6da300600d9fb022b"><div class="ttname"><a href="namespacevvenc.html#ad8687adca4e586b6da300600d9fb022b">vvenc::RC_ITERATION_NUM</a></div><div class="ttdeci">static const int RC_ITERATION_NUM</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00060">RateCtrl.cpp:60</a></div></div>
<div class="ttc" id="astructvvenc_1_1AreaBuf_html"><div class="ttname"><a href="structvvenc_1_1AreaBuf.html">vvenc::AreaBuf&lt; const Pel &gt;</a></div></div>
<div class="ttc" id="aclassvvenc_1_1RateCtrl_html_afd36d4c3cfe408edbe75579fd69bafd0"><div class="ttname"><a href="classvvenc_1_1RateCtrl.html#afd36d4c3cfe408edbe75579fd69bafd0">vvenc::RateCtrl::encRCPic</a></div><div class="ttdeci">EncRCPic * encRCPic</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00276">RateCtrl.h:276</a></div></div>
<div class="ttc" id="astructvvenc_1_1TRCLCU_html_aae0bdbf90049bf94c419c0918b5e1d3d"><div class="ttname"><a href="structvvenc_1_1TRCLCU.html#aae0bdbf90049bf94c419c0918b5e1d3d">vvenc::TRCLCU::numberOfPixel</a></div><div class="ttdeci">int numberOfPixel</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00071">RateCtrl.h:71</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_a2b5fcef61b77355d86a065adc308528e"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#a2b5fcef61b77355d86a065adc308528e">vvenc::EncRCPic::encRCGOP</a></div><div class="ttdeci">EncRCGOP * encRCGOP</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00231">RateCtrl.h:231</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCGOP_html_aaaa6ab10c878338e74a04f5ca10b0fbb"><div class="ttname"><a href="classvvenc_1_1EncRCGOP.html#aaaa6ab10c878338e74a04f5ca10b0fbb">vvenc::EncRCGOP::numPics</a></div><div class="ttdeci">int numPics</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00176">RateCtrl.h:176</a></div></div>
<div class="ttc" id="anamespacevvenc_html_aa2aaf0a0822296d132b363aeaf9df0ca"><div class="ttname"><a href="namespacevvenc.html#aa2aaf0a0822296d132b363aeaf9df0ca">vvenc::MAX_QP</a></div><div class="ttdeci">static const int MAX_QP</div><div class="ttdef"><b>Definition:</b> <a href="CommonDef_8h_source.html#l00196">CommonDef.h:196</a></div></div>
<div class="ttc" id="anamespacevvenc_html_a788273bea30966f2f3088cc9d64f2f33"><div class="ttname"><a href="namespacevvenc.html#a788273bea30966f2f3088cc9d64f2f33">vvenc::Pel</a></div><div class="ttdeci">int16_t Pel</div><div class="ttdoc">pixel type</div><div class="ttdef"><b>Definition:</b> <a href="TypeDef_8h_source.html#l00191">TypeDef.h:191</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_a439f1eea14cde0384fd9a48d8fcda8f8"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#a439f1eea14cde0384fd9a48d8fcda8f8">vvenc::EncRCPic::picQP</a></div><div class="ttdeci">int picQP</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00238">RateCtrl.h:238</a></div></div>
<div class="ttc" id="anamespacevvenc_html"><div class="ttname"><a href="namespacevvenc.html">vvenc</a></div><div class="ttdef"><b>Definition:</b> <a href="AdaptiveLoopFilter_8cpp_source.html#l00064">AdaptiveLoopFilter.cpp:64</a></div></div>
<div class="ttc" id="aclassvvenc_1_1RateCtrl_html_aa147428e6e802a31501dbe56fefab751"><div class="ttname"><a href="classvvenc_1_1RateCtrl.html#aa147428e6e802a31501dbe56fefab751">vvenc::RateCtrl::setRCPass</a></div><div class="ttdeci">void setRCPass(const int pass, const int maxPass)</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l01345">RateCtrl.cpp:1345</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCGOP_html_a9fc04d1dbe9e90211adae22edf1aa4ea"><div class="ttname"><a href="classvvenc_1_1EncRCGOP.html#a9fc04d1dbe9e90211adae22edf1aa4ea">vvenc::EncRCGOP::minEstLambda</a></div><div class="ttdeci">double minEstLambda</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00181">RateCtrl.h:181</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCGOP_html_a3a2e8b59f1816785bf9179457a42032a"><div class="ttname"><a href="classvvenc_1_1EncRCGOP.html#a3a2e8b59f1816785bf9179457a42032a">vvenc::EncRCGOP::maxEstLambda</a></div><div class="ttdeci">double maxEstLambda</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00182">RateCtrl.h:182</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_aae0bdbf90049bf94c419c0918b5e1d3d"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#aae0bdbf90049bf94c419c0918b5e1d3d">vvenc::EncRCSeq::numberOfPixel</a></div><div class="ttdeci">int numberOfPixel</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00135">RateCtrl.h:135</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_aa88894359f052c7c1759e3cb7e0ad34b"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#aa88894359f052c7c1759e3cb7e0ad34b">vvenc::EncRCPic::picActualHeaderBits</a></div><div class="ttdeci">int picActualHeaderBits</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00236">RateCtrl.h:236</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCGOP_html_a28145de951dbb6373090a892b7869eff"><div class="ttname"><a href="classvvenc_1_1EncRCGOP.html#a28145de951dbb6373090a892b7869eff">vvenc::EncRCGOP::xCalEquaCoeff</a></div><div class="ttdeci">void xCalEquaCoeff(EncRCSeq *encRCSeq, double *lambdaRatio, double *equaCoeffA, double *equaCoeffB, int GOPSize)</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00510">RateCtrl.cpp:510</a></div></div>
<div class="ttc" id="anamespacevvenc_html_a95d815af88e0ec2f5f2edad706d9b978"><div class="ttname"><a href="namespacevvenc.html#a95d815af88e0ec2f5f2edad706d9b978">vvenc::RC_BETA_MAX_VALUE</a></div><div class="ttdeci">static const double RC_BETA_MAX_VALUE</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00070">RateCtrl.cpp:70</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_a525e1f8954bc8a288b4ddca834e65144"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#a525e1f8954bc8a288b4ddca834e65144">vvenc::EncRCPic::updateAfterCTU</a></div><div class="ttdeci">void updateAfterCTU(int LCUIdx, int bits, double lambda)</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00972">RateCtrl.cpp:972</a></div></div>
<div class="ttc" id="astructvvenc_1_1Size_html_a81ed27f96c08781589ca6ff77043a7b1"><div class="ttname"><a href="structvvenc_1_1Size.html#a81ed27f96c08781589ca6ff77043a7b1">vvenc::Size::width</a></div><div class="ttdeci">SizeType width</div><div class="ttdef"><b>Definition:</b> <a href="Common_8h_source.html#l00082">Common.h:82</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_a7c166c40a06c904af730175d13d28cd9"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#a7c166c40a06c904af730175d13d28cd9">vvenc::EncRCSeq::getTargetBitsFromFirstPass</a></div><div class="ttdeci">void getTargetBitsFromFirstPass(const int poc, int &amp;targetBits, double &amp;frameVsGopRatio, bool &amp;isNewScene, bool &amp;refreshParameters)</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00246">RateCtrl.cpp:246</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCGOP_html_a06ab26652030f26f2a8e26a911b67b0b"><div class="ttname"><a href="classvvenc_1_1EncRCGOP.html#a06ab26652030f26f2a8e26a911b67b0b">vvenc::EncRCGOP::EncRCGOP</a></div><div class="ttdeci">EncRCGOP()</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00280">RateCtrl.cpp:280</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html">vvenc::EncRCSeq</a></div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00105">RateCtrl.h:105</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_a4e3179468eeee6f92e2a0641290fe74c"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#a4e3179468eeee6f92e2a0641290fe74c">vvenc::EncRCSeq::lcuHeight</a></div><div class="ttdeci">int lcuHeight</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00132">RateCtrl.h:132</a></div></div>
<div class="ttc" id="anamespacevvenc_html_a19a96edeeb9d37072c4ce9f862d19ba8a9eef8706f96e8b3511a2450e90075f59"><div class="ttname"><a href="namespacevvenc.html#a19a96edeeb9d37072c4ce9f862d19ba8a9eef8706f96e8b3511a2450e90075f59">vvenc::CH_L</a></div><div class="ttdeci">@ CH_L</div><div class="ttdef"><b>Definition:</b> <a href="TypeDef_8h_source.html#l00217">TypeDef.h:217</a></div></div>
<div class="ttc" id="astructvvenc_1_1Picture_html"><div class="ttname"><a href="structvvenc_1_1Picture.html">vvenc::Picture</a></div><div class="ttdef"><b>Definition:</b> <a href="Picture_8h_source.html#l00143">Picture.h:143</a></div></div>
<div class="ttc" id="astructvvenc_1_1TRCParameter_html_a0c2c12d17099a37f01345fcab95a7ebf"><div class="ttname"><a href="structvvenc_1_1TRCParameter.html#a0c2c12d17099a37f01345fcab95a7ebf">vvenc::TRCParameter::validPix</a></div><div class="ttdeci">int validPix</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00079">RateCtrl.h:79</a></div></div>
<div class="ttc" id="anamespacevvenc_html_af483359f17deab82472b16da461a9a0fa3b276b5937d942b2fe5cbfa69d5a016a"><div class="ttname"><a href="namespacevvenc.html#af483359f17deab82472b16da461a9a0fa3b276b5937d942b2fe5cbfa69d5a016a">vvenc::COMP_Y</a></div><div class="ttdeci">@ COMP_Y</div><div class="ttdef"><b>Definition:</b> <a href="TypeDef_8h_source.html#l00224">TypeDef.h:224</a></div></div>
<div class="ttc" id="aclassvvenc_1_1PreCalcValues_html_af17e83769be75df61e6eee524af767a0"><div class="ttname"><a href="classvvenc_1_1PreCalcValues.html#af17e83769be75df61e6eee524af767a0">vvenc::PreCalcValues::lumaHeight</a></div><div class="ttdeci">const unsigned lumaHeight</div><div class="ttdef"><b>Definition:</b> <a href="Slice_8h_source.html#l01597">Slice.h:1597</a></div></div>
<div class="ttc" id="aclassvvenc_1_1CodingStructure_html_a2d3ec636d347d8ea142e64ca27ceaad4"><div class="ttname"><a href="classvvenc_1_1CodingStructure.html#a2d3ec636d347d8ea142e64ca27ceaad4">vvenc::CodingStructure::sps</a></div><div class="ttdeci">const SPS * sps</div><div class="ttdef"><b>Definition:</b> <a href="CodingStructure_8h_source.html#l00105">CodingStructure.h:105</a></div></div>
<div class="ttc" id="aclassvvenc_1_1PreCalcValues_html_a52cdd32a3b7ffde866c7f2d6cd7d7df6"><div class="ttname"><a href="classvvenc_1_1PreCalcValues.html#a52cdd32a3b7ffde866c7f2d6cd7d7df6">vvenc::PreCalcValues::sizeInCtus</a></div><div class="ttdeci">const unsigned sizeInCtus</div><div class="ttdef"><b>Definition:</b> <a href="Slice_8h_source.html#l01595">Slice.h:1595</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCGOP_html_a4973b73ee65d239c9bec2f8bf78846a3"><div class="ttname"><a href="classvvenc_1_1EncRCGOP.html#a4973b73ee65d239c9bec2f8bf78846a3">vvenc::EncRCGOP::targetBits</a></div><div class="ttdeci">int targetBits</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00177">RateCtrl.h:177</a></div></div>
<div class="ttc" id="anamespacevvenc_1_1CU_html_ab722b39b132601673d1dcd3547c2c01c"><div class="ttname"><a href="namespacevvenc_1_1CU.html#ab722b39b132601673d1dcd3547c2c01c">vvenc::CU::isIntra</a></div><div class="ttdeci">bool isIntra(const CodingUnit &amp;cu)</div><div class="ttdef"><b>Definition:</b> <a href="UnitTools_8h_source.html#l00079">UnitTools.h:79</a></div></div>
<div class="ttc" id="anamespacevvenc_html_a44f3c28eeb9a80d6ee44649e201a17fe"><div class="ttname"><a href="namespacevvenc.html#a44f3c28eeb9a80d6ee44649e201a17fe">vvenc::RC_WEIGHT_PIC_TARGET_BIT_IN_GOP</a></div><div class="ttdeci">static const double RC_WEIGHT_PIC_TARGET_BIT_IN_GOP</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00064">RateCtrl.cpp:64</a></div></div>
<div class="ttc" id="aclassvvenc_1_1RateCtrl_html_a9dd6e807e3dfd65b60299ec229f51ae6"><div class="ttname"><a href="classvvenc_1_1RateCtrl.html#a9dd6e807e3dfd65b60299ec229f51ae6">vvenc::RateCtrl::getFirstPassStats</a></div><div class="ttdeci">std::list&lt; TRCPassStats &gt; &amp; getFirstPassStats()</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00269">RateCtrl.h:269</a></div></div>
<div class="ttc" id="astructvvenc_1_1SPS_html_a698a46d463e05520421479a1ac78eb05"><div class="ttname"><a href="structvvenc_1_1SPS.html#a698a46d463e05520421479a1ac78eb05">vvenc::SPS::bitDepths</a></div><div class="ttdeci">BitDepths bitDepths</div><div class="ttdef"><b>Definition:</b> <a href="Slice_8h_source.html#l00723">Slice.h:723</a></div></div>
<div class="ttc" id="astructvvenc_1_1TRCLCU_html_ad6f0bebdd354df4050cdb476d94f9db1"><div class="ttname"><a href="structvvenc_1_1TRCLCU.html#ad6f0bebdd354df4050cdb476d94f9db1">vvenc::TRCLCU::actualSSE</a></div><div class="ttdeci">double actualSSE</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00069">RateCtrl.h:69</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCGOP_html_a7192b8cd46d8604a40846c7a736b84fe"><div class="ttname"><a href="classvvenc_1_1EncRCGOP.html#a7192b8cd46d8604a40846c7a736b84fe">vvenc::EncRCGOP::bitsLeft</a></div><div class="ttdeci">int bitsLeft</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00179">RateCtrl.h:179</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_aa921605b08e04dcf79d24564b00dcc84"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#aa921605b08e04dcf79d24564b00dcc84">vvenc::EncRCSeq::lastLambda</a></div><div class="ttdeci">double lastLambda</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00143">RateCtrl.h:143</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_aac8f73a2e299ae450db271221a4ea0d8"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#aac8f73a2e299ae450db271221a4ea0d8">vvenc::EncRCPic::finalLambda</a></div><div class="ttdeci">double finalLambda</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00226">RateCtrl.h:226</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCGOP_html_a39d3ea6b32b0fb45ae6b9f56609b19b9"><div class="ttname"><a href="classvvenc_1_1EncRCGOP.html#a39d3ea6b32b0fb45ae6b9f56609b19b9">vvenc::EncRCGOP::create</a></div><div class="ttdeci">void create(EncRCSeq *encRCSeq, int numPic)</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00297">RateCtrl.cpp:297</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_a73b2bf1e6352c4dd8c524005a8b14081"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#a73b2bf1e6352c4dd8c524005a8b14081">vvenc::EncRCSeq::gopID2Level</a></div><div class="ttdeci">int * gopID2Level</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00151">RateCtrl.h:151</a></div></div>
<div class="ttc" id="astructvvenc_1_1TRCPassStats_html"><div class="ttname"><a href="structvvenc_1_1TRCPassStats.html">vvenc::TRCPassStats</a></div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00082">RateCtrl.h:82</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_a8ee188ba629e2bc115c79d56277fe406"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#a8ee188ba629e2bc115c79d56277fe406">vvenc::EncRCPic::isNewScene</a></div><div class="ttdeci">bool isNewScene</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00243">RateCtrl.h:243</a></div></div>
<div class="ttc" id="aclassvvenc_1_1RateCtrl_html_a4849a16cf9c140b9f8194af1a2f0db23"><div class="ttname"><a href="classvvenc_1_1RateCtrl.html#a4849a16cf9c140b9f8194af1a2f0db23">vvenc::RateCtrl::m_listRCPictures</a></div><div class="ttdeci">std::list&lt; EncRCPic * &gt; m_listRCPictures</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00273">RateCtrl.h:273</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_ac77b590e38a8e565a52609ab911451d1"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#ac77b590e38a8e565a52609ab911451d1">vvenc::EncRCSeq::bitDepth</a></div><div class="ttdeci">int bitDepth</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00140">RateCtrl.h:140</a></div></div>
<div class="ttc" id="anamespacevvenc_html_a18c769e91b6d473f74679144f9ff4fb5"><div class="ttname"><a href="namespacevvenc.html#a18c769e91b6d473f74679144f9ff4fb5">vvenc::RC_BETA1</a></div><div class="ttdeci">static const double RC_BETA1</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00072">RateCtrl.cpp:72</a></div></div>
<div class="ttc" id="anamespacevvenc_html_a6afe46d36eebf50617b754793260c5f3"><div class="ttname"><a href="namespacevvenc.html#a6afe46d36eebf50617b754793260c5f3">vvenc::RC_MAX_PIC_LIST_SIZE</a></div><div class="ttdeci">static const int RC_MAX_PIC_LIST_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00059">RateCtrl.cpp:59</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_a60612dfbccf81f1d0286a6e08b44edf4"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#a60612dfbccf81f1d0286a6e08b44edf4">vvenc::EncRCSeq::~EncRCSeq</a></div><div class="ttdeci">~EncRCSeq()</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00112">RateCtrl.cpp:112</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_a516a779a4b162eddb49c63d03b75c2a9"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#a516a779a4b162eddb49c63d03b75c2a9">vvenc::EncRCPic::numberOfLCU</a></div><div class="ttdeci">int numberOfLCU</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00221">RateCtrl.h:221</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_a3a80b6032f86a56bec74609034b3246f"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#a3a80b6032f86a56bec74609034b3246f">vvenc::EncRCPic::destroy</a></div><div class="ttdeci">void destroy()</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00756">RateCtrl.cpp:756</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_a9cb092466959de4b4a18609dc1499e45"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#a9cb092466959de4b4a18609dc1499e45">vvenc::EncRCPic::create</a></div><div class="ttdeci">void create(EncRCSeq *encRCSeq, EncRCGOP *encRCGOP, int frameLevel, int framePoc, int frameRcIdxInGop, std::list&lt; EncRCPic * &gt; &amp;listPreviousPictures)</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00694">RateCtrl.cpp:694</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_aebf7716c3a56bb979162b37c9134214c"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#aebf7716c3a56bb979162b37c9134214c">vvenc::EncRCSeq::firstPassData</a></div><div class="ttdeci">std::list&lt; TRCPassStats &gt; firstPassData</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00152">RateCtrl.h:152</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_a62da06f3dacb4dfdb0b1bfe66132d3d5"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#a62da06f3dacb4dfdb0b1bfe66132d3d5">vvenc::EncRCPic::getRefineBitsForIntra</a></div><div class="ttdeci">int getRefineBitsForIntra(int orgBits)</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l01081">RateCtrl.cpp:1081</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_a180bfc8253ef87d73463f4cdd26143cf"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#a180bfc8253ef87d73463f4cdd26143cf">vvenc::EncRCSeq::bitsLeft</a></div><div class="ttdeci">int64_t bitsLeft</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00157">RateCtrl.h:157</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_a65f367eacfb22811464a0a5379ffc72e"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#a65f367eacfb22811464a0a5379ffc72e">vvenc::EncRCSeq::actualBitCnt</a></div><div class="ttdeci">uint64_t actualBitCnt[8]</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00145">RateCtrl.h:145</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_aad35fc85fff0a753627ea3ff5192834c"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#aad35fc85fff0a753627ea3ff5192834c">vvenc::EncRCSeq::lastIntraQP</a></div><div class="ttdeci">int lastIntraQP</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00148">RateCtrl.h:148</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_a258d3cda3d572c3f9f8d074846658a78"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#a258d3cda3d572c3f9f8d074846658a78">vvenc::EncRCSeq::averageBits</a></div><div class="ttdeci">int averageBits</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00133">RateCtrl.h:133</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCGOP_html_a38746d97776368ee9ef0edfe8462fee9"><div class="ttname"><a href="classvvenc_1_1EncRCGOP.html#a38746d97776368ee9ef0edfe8462fee9">vvenc::EncRCGOP::xEstGOPTargetBits</a></div><div class="ttdeci">int xEstGOPTargetBits(EncRCSeq *encRCSeq, int GOPSize)</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00564">RateCtrl.cpp:564</a></div></div>
<div class="ttc" id="aclassvvenc_1_1RateCtrl_html_a0e994a827dec227d6f8ad66e170645b2"><div class="ttname"><a href="classvvenc_1_1RateCtrl.html#a0e994a827dec227d6f8ad66e170645b2">vvenc::RateCtrl::RateCtrl</a></div><div class="ttdeci">RateCtrl()</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l01108">RateCtrl.cpp:1108</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_a306c1d7f4f6833176d12c84d77b9b412"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#a306c1d7f4f6833176d12c84d77b9b412">vvenc::EncRCSeq::twoPass</a></div><div class="ttdeci">bool twoPass</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00123">RateCtrl.h:123</a></div></div>
<div class="ttc" id="aclassvvenc_1_1RateCtrl_html_a44454aab4f68d33cad07a7bc2213af81"><div class="ttname"><a href="classvvenc_1_1RateCtrl.html#a44454aab4f68d33cad07a7bc2213af81">vvenc::RateCtrl::processFirstPassData</a></div><div class="ttdeci">void processFirstPassData(const int secondPassBaseQP)</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l01352">RateCtrl.cpp:1352</a></div></div>
<div class="ttc" id="aclassvvenc_1_1RateCtrl_html_a9f42bf2ad9de6fce9ed88e35a325d442"><div class="ttname"><a href="classvvenc_1_1RateCtrl.html#a9f42bf2ad9de6fce9ed88e35a325d442">vvenc::RateCtrl::flushPOC</a></div><div class="ttdeci">int flushPOC</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00278">RateCtrl.h:278</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_ae086e1bbe8b434f83a875d578aa23f4c"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#ae086e1bbe8b434f83a875d578aa23f4c">vvenc::EncRCSeq::targetBits</a></div><div class="ttdeci">int64_t targetBits</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00156">RateCtrl.h:156</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_a5b8331b9cbb85b083e680987df4bb539"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#a5b8331b9cbb85b083e680987df4bb539">vvenc::EncRCPic::xEstPicTargetBits</a></div><div class="ttdeci">int xEstPicTargetBits(EncRCSeq *encRCSeq, EncRCGOP *encRCGOP, int frameLevel)</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00614">RateCtrl.cpp:614</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_abc77673ab15d1f85309626e27061db57"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#abc77673ab15d1f85309626e27061db57">vvenc::EncRCSeq::picHeight</a></div><div class="ttdeci">int picHeight</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00130">RateCtrl.h:130</a></div></div>
<div class="ttc" id="anamespacevvenc_html_a7f349632878be19b99945fca37c91813"><div class="ttname"><a href="namespacevvenc.html#a7f349632878be19b99945fca37c91813">vvenc::xCalcHADs8x8_ISlice</a></div><div class="ttdeci">static int xCalcHADs8x8_ISlice(const Pel *piOrg, const int iStrideOrg)</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l01478">RateCtrl.cpp:1478</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_a86196082d72456b391de178e660a33d9"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#a86196082d72456b391de178e660a33d9">vvenc::EncRCPic::estHeaderBits</a></div><div class="ttdeci">int estHeaderBits</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00235">RateCtrl.h:235</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_ab13b9106f285947f00b2801086096701"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#ab13b9106f285947f00b2801086096701">vvenc::EncRCSeq::picWidth</a></div><div class="ttdeci">int picWidth</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00129">RateCtrl.h:129</a></div></div>
<div class="ttc" id="astructvvenc_1_1Position_html_a9685e0c777668f378eb6fa531933ac6a"><div class="ttname"><a href="structvvenc_1_1Position.html#a9685e0c777668f378eb6fa531933ac6a">vvenc::Position::x</a></div><div class="ttdeci">PosType x</div><div class="ttdef"><b>Definition:</b> <a href="Common_8h_source.html#l00063">Common.h:63</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_a50bbd78bc67e4ea27b0e424823b93e84"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#a50bbd78bc67e4ea27b0e424823b93e84">vvenc::EncRCSeq::lastIntraLambda</a></div><div class="ttdeci">double lastIntraLambda</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00147">RateCtrl.h:147</a></div></div>
<div class="ttc" id="anamespacevvenc_html_af1539ed57ae90e2f71fdc8a91dc600ed"><div class="ttname"><a href="namespacevvenc.html#af1539ed57ae90e2f71fdc8a91dc600ed">vvenc::RC_ALPHA_MIN_VALUE</a></div><div class="ttdeci">static const double RC_ALPHA_MIN_VALUE</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00067">RateCtrl.cpp:67</a></div></div>
<div class="ttc" id="aclassvvenc_1_1PreCalcValues_html_afcdcde8a5587ac7f5495cd5b31fefb17"><div class="ttname"><a href="classvvenc_1_1PreCalcValues.html#afcdcde8a5587ac7f5495cd5b31fefb17">vvenc::PreCalcValues::maxCUSize</a></div><div class="ttdeci">const unsigned maxCUSize</div><div class="ttdef"><b>Definition:</b> <a href="Slice_8h_source.html#l01585">Slice.h:1585</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_a0c6695ec3f5a446595ddcffa3a806638"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#a0c6695ec3f5a446595ddcffa3a806638">vvenc::EncRCSeq::create</a></div><div class="ttdeci">void create(bool twoPass, int totFrames, int targetBitrate, int frameRate, int intraPeriod, int GOPSize, int picWidth, int picHeight, int LCUWidth, int LCUHeight, int numberOfLevel, int adaptiveBit, std::list&lt; TRCPassStats &gt; &amp;firstPassData)</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00117">RateCtrl.cpp:117</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCGOP_html"><div class="ttname"><a href="classvvenc_1_1EncRCGOP.html">vvenc::EncRCGOP</a></div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00160">RateCtrl.h:160</a></div></div>
<div class="ttc" id="astructvvenc_1_1TRCPassStats_html_af1fa96a850f404aded578d3e29dedbcb"><div class="ttname"><a href="structvvenc_1_1TRCPassStats.html#af1fa96a850f404aded578d3e29dedbcb">vvenc::TRCPassStats::poc</a></div><div class="ttdeci">int poc</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00090">RateCtrl.h:90</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_a593aab4c0ea65f4f654fa7f6031fb0b7"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#a593aab4c0ea65f4f654fa7f6031fb0b7">vvenc::EncRCSeq::bitsUsed</a></div><div class="ttdeci">int64_t bitsUsed</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00141">RateCtrl.h:141</a></div></div>
<div class="ttc" id="aclassvvenc_1_1PreCalcValues_html_a38f9d60d3484f67626f5198df8170b51"><div class="ttname"><a href="classvvenc_1_1PreCalcValues.html#a38f9d60d3484f67626f5198df8170b51">vvenc::PreCalcValues::widthInCtus</a></div><div class="ttdeci">const unsigned widthInCtus</div><div class="ttdef"><b>Definition:</b> <a href="Slice_8h_source.html#l01593">Slice.h:1593</a></div></div>
<div class="ttc" id="aclassvvenc_1_1RateCtrl_html_a61918dfad5b3d7354ea66212c73e62d1"><div class="ttname"><a href="classvvenc_1_1RateCtrl.html#a61918dfad5b3d7354ea66212c73e62d1">vvenc::RateCtrl::m_listRCFirstPassStats</a></div><div class="ttdeci">std::list&lt; TRCPassStats &gt; m_listRCFirstPassStats</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00284">RateCtrl.h:284</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCGOP_html_a1c0b9204320936cee8de0940ee484836"><div class="ttname"><a href="classvvenc_1_1EncRCGOP.html#a1c0b9204320936cee8de0940ee484836">vvenc::EncRCGOP::updateAfterPicture</a></div><div class="ttdeci">void updateAfterPicture(int bitsCost)</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00558">RateCtrl.cpp:558</a></div></div>
<div class="ttc" id="aclassvvenc_1_1RateCtrl_html_a561871957c2beb5abbfd5f1bcf270f72"><div class="ttname"><a href="classvvenc_1_1RateCtrl.html#a561871957c2beb5abbfd5f1bcf270f72">vvenc::RateCtrl::getTotalBitsInFirstPass</a></div><div class="ttdeci">uint64_t getTotalBitsInFirstPass()</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l01368">RateCtrl.cpp:1368</a></div></div>
<div class="ttc" id="anamespacevvenc_html_afdcc3f5f4435932506df86e4f2ca6b90"><div class="ttname"><a href="namespacevvenc.html#afdcc3f5f4435932506df86e4f2ca6b90">vvenc::msg</a></div><div class="ttdeci">void msg(int level, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="CommonDef_8h_source.html#l00593">CommonDef.h:593</a></div></div>
<div class="ttc" id="anamespacevvenc_html_abab5f5527b53cf619014a22589afe4ce"><div class="ttname"><a href="namespacevvenc.html#abab5f5527b53cf619014a22589afe4ce">vvenc::RC_SMOOTH_WINDOW_SIZE</a></div><div class="ttdeci">static const int RC_SMOOTH_WINDOW_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00058">RateCtrl.cpp:58</a></div></div>
<div class="ttc" id="aPicture_8h_html"><div class="ttname"><a href="Picture_8h.html">Picture.h</a></div><div class="ttdoc">Description of a coded picture.</div></div>
<div class="ttc" id="anamespacevvenc_html_a1aab7e3788f646db5393de39ebaa0e8d"><div class="ttname"><a href="namespacevvenc.html#a1aab7e3788f646db5393de39ebaa0e8d">vvenc::RC_GOP_ID_QP_OFFSET</a></div><div class="ttdeci">static const int RC_GOP_ID_QP_OFFSET[6]</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00062">RateCtrl.cpp:62</a></div></div>
<div class="ttc" id="anamespacevvenc_html_abf46a202fa78f91c371c52bc8d242cd8"><div class="ttname"><a href="namespacevvenc.html#abf46a202fa78f91c371c52bc8d242cd8">vvenc::RC_ALPHA_MAX_VALUE</a></div><div class="ttdeci">static const double RC_ALPHA_MAX_VALUE</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00068">RateCtrl.cpp:68</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_ab0af52bb2fd3511beea867ee60f1895c"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#ab0af52bb2fd3511beea867ee60f1895c">vvenc::EncRCSeq::adaptiveBits</a></div><div class="ttdeci">int adaptiveBits</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00139">RateCtrl.h:139</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_ad12b85ecb08a85ac22bfdc05046798fd"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#ad12b85ecb08a85ac22bfdc05046798fd">vvenc::EncRCPic::picLambdaOffsetQPA</a></div><div class="ttdeci">double picLambdaOffsetQPA</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00225">RateCtrl.h:225</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_a541a5402f3f9aa808585ae50807253e4"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#a541a5402f3f9aa808585ae50807253e4">vvenc::EncRCSeq::setAllBitRatio</a></div><div class="ttdeci">void setAllBitRatio(double basicLambda, double *equaCoeffA, double *equaCoeffB)</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00262">RateCtrl.cpp:262</a></div></div>
<div class="ttc" id="aRateCtrl_8h_html"><div class="ttname"><a href="RateCtrl_8h.html">RateCtrl.h</a></div><div class="ttdoc">Rate control manager class.</div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_a6c8773e9e7302babc02840a2426eda20"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#a6c8773e9e7302babc02840a2426eda20">vvenc::EncRCPic::clipRcBeta</a></div><div class="ttdeci">void clipRcBeta(double &amp;beta)</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l01076">RateCtrl.cpp:1076</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_a4973b73ee65d239c9bec2f8bf78846a3"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#a4973b73ee65d239c9bec2f8bf78846a3">vvenc::EncRCPic::targetBits</a></div><div class="ttdeci">int targetBits</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00218">RateCtrl.h:218</a></div></div>
<div class="ttc" id="aclassvvenc_1_1RateCtrl_html_a79f7acf16b464529fa6bb95693ce8c8f"><div class="ttname"><a href="classvvenc_1_1RateCtrl.html#a79f7acf16b464529fa6bb95693ce8c8f">vvenc::RateCtrl::destroyRCGOP</a></div><div class="ttdeci">void destroyRCGOP()</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l01339">RateCtrl.cpp:1339</a></div></div>
<div class="ttc" id="astructvvenc_1_1TRCParameter_html"><div class="ttname"><a href="structvvenc_1_1TRCParameter.html">vvenc::TRCParameter</a></div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00074">RateCtrl.h:74</a></div></div>
<div class="ttc" id="astructvvenc_1_1TRCLCU_html"><div class="ttname"><a href="structvvenc_1_1TRCLCU.html">vvenc::TRCLCU</a></div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00066">RateCtrl.h:66</a></div></div>
<div class="ttc" id="astructvvenc_1_1Position_html_a4f5d13e73c7d4e9eae1aa12beac2fda8"><div class="ttname"><a href="structvvenc_1_1Position.html#a4f5d13e73c7d4e9eae1aa12beac2fda8">vvenc::Position::y</a></div><div class="ttdeci">PosType y</div><div class="ttdef"><b>Definition:</b> <a href="Common_8h_source.html#l00064">Common.h:64</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_a1fe0fb155bd34080852231563d329a54"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#a1fe0fb155bd34080852231563d329a54">vvenc::EncRCSeq::numberOfLevel</a></div><div class="ttdeci">int numberOfLevel</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00155">RateCtrl.h:155</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_a0186bee82f4d469206cfcb18da843a46"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#a0186bee82f4d469206cfcb18da843a46">vvenc::EncRCSeq::totalFrames</a></div><div class="ttdeci">int totalFrames</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00125">RateCtrl.h:125</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_a00a61f37d924393793f0336daf330dfd"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#a00a61f37d924393793f0336daf330dfd">vvenc::EncRCPic::estimatePicLambda</a></div><div class="ttdeci">double estimatePicLambda(std::list&lt; EncRCPic * &gt; &amp;listPreviousPictures, bool isIRAP)</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00768">RateCtrl.cpp:768</a></div></div>
<div class="ttc" id="astructvvenc_1_1TRCLCU_html_a3db359547eed8cfd48ca821d95f577af"><div class="ttname"><a href="structvvenc_1_1TRCLCU.html#a3db359547eed8cfd48ca821d95f577af">vvenc::TRCLCU::lambda</a></div><div class="ttdeci">double lambda</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00068">RateCtrl.h:68</a></div></div>
<div class="ttc" id="anamespacevvenc_html_a241f2aa439bf4d008b4ab0113048c00f"><div class="ttname"><a href="namespacevvenc.html#a241f2aa439bf4d008b4ab0113048c00f">vvenc::RC_LAMBDA_PREC</a></div><div class="ttdeci">static const int RC_LAMBDA_PREC</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00061">RateCtrl.cpp:61</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_a7ed72c08dc73f91e000b5d36821cc49f"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#a7ed72c08dc73f91e000b5d36821cc49f">vvenc::EncRCPic::calPicMSE</a></div><div class="ttdeci">void calPicMSE()</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00982">RateCtrl.cpp:982</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_a3a80b6032f86a56bec74609034b3246f"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#a3a80b6032f86a56bec74609034b3246f">vvenc::EncRCSeq::destroy</a></div><div class="ttdeci">void destroy()</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00170">RateCtrl.cpp:170</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_aa63b95dd79aafa6698666c048ac5434d"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#aa63b95dd79aafa6698666c048ac5434d">vvenc::EncRCPic::validPixelsInPic</a></div><div class="ttdeci">int validPixelsInPic</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00239">RateCtrl.h:239</a></div></div>
<div class="ttc" id="aTypeDef_8h_html_a29d5c9e713ec90b037a5aaa3865ccfa9"><div class="ttname"><a href="TypeDef_8h.html#a29d5c9e713ec90b037a5aaa3865ccfa9">DISTORTION_PRECISION_ADJUSTMENT</a></div><div class="ttdeci">#define DISTORTION_PRECISION_ADJUSTMENT(x)</div><div class="ttdef"><b>Definition:</b> <a href="TypeDef_8h_source.html#l00165">TypeDef.h:165</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_aa470ccbdde4a57b091141064d29317a2"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#aa470ccbdde4a57b091141064d29317a2">vvenc::EncRCPic::xEstPicHeaderBits</a></div><div class="ttdeci">int xEstPicHeaderBits(std::list&lt; EncRCPic * &gt; &amp;listPreviousPictures, int frameLevel)</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00657">RateCtrl.cpp:657</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_ac606af1acdd996fe1ca1412f488ce4c6"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#ac606af1acdd996fe1ca1412f488ce4c6">vvenc::EncRCPic::tmpTargetBits</a></div><div class="ttdeci">int tmpTargetBits</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00219">RateCtrl.h:219</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_ac792156088c1bfd18ac85b5835b95540"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#ac792156088c1bfd18ac85b5835b95540">vvenc::EncRCPic::encRCSeq</a></div><div class="ttdeci">EncRCSeq * encRCSeq</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00230">RateCtrl.h:230</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_a3c7e7f3985dc338448fcb2c5b5ad43c5"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#a3c7e7f3985dc338448fcb2c5b5ad43c5">vvenc::EncRCSeq::framesLeft</a></div><div class="ttdeci">int framesLeft</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00138">RateCtrl.h:138</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_a3efb04a13787237fcaf583e8cd31e42e"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#a3efb04a13787237fcaf583e8cd31e42e">vvenc::EncRCSeq::EncRCSeq</a></div><div class="ttdeci">EncRCSeq()</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00076">RateCtrl.cpp:76</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_a75ac805c2469793c17ab6b63d2e6ba62"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#a75ac805c2469793c17ab6b63d2e6ba62">vvenc::EncRCSeq::initBitsRatio</a></div><div class="ttdeci">void initBitsRatio(int bitsRatio[])</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00191">RateCtrl.cpp:191</a></div></div>
<div class="ttc" id="aclassvvenc_1_1RateCtrl_html_ab932255b352c7d7ccade22225676ef05"><div class="ttname"><a href="classvvenc_1_1RateCtrl.html#ab932255b352c7d7ccade22225676ef05">vvenc::RateCtrl::addRCPassStats</a></div><div class="ttdeci">void addRCPassStats(const int poc, const int qp, const double lambda, const uint16_t visActY, const uint32_t numBits, const double psnrY, const bool isIntra, const int tempLayer)</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l01468">RateCtrl.cpp:1468</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_a4fd2f41f944b9e6ffa3df9815904bed8"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#a4fd2f41f944b9e6ffa3df9815904bed8">vvenc::EncRCSeq::targetRate</a></div><div class="ttdeci">int targetRate</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00126">RateCtrl.h:126</a></div></div>
<div class="ttc" id="aclassvvenc_1_1PreCalcValues_html"><div class="ttname"><a href="classvvenc_1_1PreCalcValues.html">vvenc::PreCalcValues</a></div><div class="ttdef"><b>Definition:</b> <a href="Slice_8h_source.html#l01556">Slice.h:1556</a></div></div>
<div class="ttc" id="astructvvenc_1_1AreaBuf_html_a915dd15479b8b2a6e8bff45b0420e37f"><div class="ttname"><a href="structvvenc_1_1AreaBuf.html#a915dd15479b8b2a6e8bff45b0420e37f">vvenc::AreaBuf::buf</a></div><div class="ttdeci">T * buf</div><div class="ttdef"><b>Definition:</b> <a href="Buffer_8h_source.html#l00124">Buffer.h:124</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_a26b5d3262aa716d856c03490baad4093"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#a26b5d3262aa716d856c03490baad4093">vvenc::EncRCPic::picMSE</a></div><div class="ttdeci">double picMSE</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00242">RateCtrl.h:242</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_af07f2ed00b0ed8af5fc86acaf0e2f503"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#af07f2ed00b0ed8af5fc86acaf0e2f503">vvenc::EncRCPic::picActualBits</a></div><div class="ttdeci">int picActualBits</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00237">RateCtrl.h:237</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_a448f06230945693b43ea3f8783d20368"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#a448f06230945693b43ea3f8783d20368">vvenc::EncRCPic::picQPOffsetQPA</a></div><div class="ttdeci">int picQPOffsetQPA</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00222">RateCtrl.h:222</a></div></div>
<div class="ttc" id="astructvvenc_1_1TRCParameter_html_a37e8135dece9bf76f60832f12fc51cf8"><div class="ttname"><a href="structvvenc_1_1TRCParameter.html#a37e8135dece9bf76f60832f12fc51cf8">vvenc::TRCParameter::skipRatio</a></div><div class="ttdeci">double skipRatio</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00078">RateCtrl.h:78</a></div></div>
<div class="ttc" id="aclassvvenc_1_1CodingStructure_html_a5e9c1ca891ed69b925ad083b0e92c641"><div class="ttname"><a href="classvvenc_1_1CodingStructure.html#a5e9c1ca891ed69b925ad083b0e92c641">vvenc::CodingStructure::pcv</a></div><div class="ttdeci">const PreCalcValues * pcv</div><div class="ttdef"><b>Definition:</b> <a href="CodingStructure_8h_source.html#l00112">CodingStructure.h:112</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_abd81d866fc4161422a991e1a9d18a590"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#abd81d866fc4161422a991e1a9d18a590">vvenc::EncRCSeq::initGOPID2Level</a></div><div class="ttdeci">void initGOPID2Level(int GOPID2Level[])</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00199">RateCtrl.cpp:199</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_abea87655520aaef3b850c3d61a1f4a31"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#abea87655520aaef3b850c3d61a1f4a31">vvenc::EncRCPic::estimatedBits</a></div><div class="ttdeci">int estimatedBits</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00227">RateCtrl.h:227</a></div></div>
<div class="ttc" id="anamespacevvenc_html_ac7434cfc270369ca2c897d06347885db"><div class="ttname"><a href="namespacevvenc.html#ac7434cfc270369ca2c897d06347885db">vvenc::RC_INVALID_QP_VALUE</a></div><div class="ttdeci">static const int RC_INVALID_QP_VALUE</div><div class="ttdef"><b>Definition:</b> <a href="CommonDef_8h_source.html#l00352">CommonDef.h:352</a></div></div>
<div class="ttc" id="astructvvenc_1_1CompArea_html"><div class="ttname"><a href="structvvenc_1_1CompArea.html">vvenc::CompArea</a></div><div class="ttdef"><b>Definition:</b> <a href="Unit_8h_source.html#l00136">Unit.h:136</a></div></div>
<div class="ttc" id="aclassvvenc_1_1RateCtrl_html_abdf88f286c886ea0348082c091a22ad3"><div class="ttname"><a href="classvvenc_1_1RateCtrl.html#abdf88f286c886ea0348082c091a22ad3">vvenc::RateCtrl::~RateCtrl</a></div><div class="ttdeci">~RateCtrl()</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l01119">RateCtrl.cpp:1119</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_a8574b3b8a8bb59ad2ef9ebad57e47add"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#a8574b3b8a8bb59ad2ef9ebad57e47add">vvenc::EncRCSeq::updateAfterPic</a></div><div class="ttdeci">void updateAfterPic(int bits, int tgtBits)</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00237">RateCtrl.cpp:237</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_a177fb8c710ad770bd0faad793da46ab9"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#a177fb8c710ad770bd0faad793da46ab9">vvenc::EncRCSeq::fppParFrames</a></div><div class="ttdeci">int fppParFrames</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00124">RateCtrl.h:124</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_a837317a783801d79f6d65bedc161996c"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#a837317a783801d79f6d65bedc161996c">vvenc::EncRCPic::~EncRCPic</a></div><div class="ttdeci">~EncRCPic()</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00609">RateCtrl.cpp:609</a></div></div>
<div class="ttc" id="astructvvenc_1_1TRCLCU_html_a7ae450af8cebf1f528a9a738c2cd6531"><div class="ttname"><a href="structvvenc_1_1TRCLCU.html#a7ae450af8cebf1f528a9a738c2cd6531">vvenc::TRCLCU::actualMSE</a></div><div class="ttdeci">double actualMSE</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00070">RateCtrl.h:70</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_a3be042b10e524d82819aeb3276035847"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#a3be042b10e524d82819aeb3276035847">vvenc::EncRCPic::lcu</a></div><div class="ttdeci">TRCLCU * lcu</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00217">RateCtrl.h:217</a></div></div>
<div class="ttc" id="aclassvvenc_1_1RateCtrl_html_a8e9b3197dbe3e05240316465571a224f"><div class="ttname"><a href="classvvenc_1_1RateCtrl.html#a8e9b3197dbe3e05240316465571a224f">vvenc::RateCtrl::detectNewScene</a></div><div class="ttdeci">void detectNewScene()</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l01381">RateCtrl.cpp:1381</a></div></div>
<div class="ttc" id="aclassvvenc_1_1RateCtrl_html_a98f6c7eeb90433d8872112409d7e32f1"><div class="ttname"><a href="classvvenc_1_1RateCtrl.html#a98f6c7eeb90433d8872112409d7e32f1">vvenc::RateCtrl::adaptToSceneChanges</a></div><div class="ttdeci">void adaptToSceneChanges()</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l01424">RateCtrl.cpp:1424</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_af1fa96a850f404aded578d3e29dedbcb"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#af1fa96a850f404aded578d3e29dedbcb">vvenc::EncRCPic::poc</a></div><div class="ttdeci">int poc</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00223">RateCtrl.h:223</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_a13f66554cee03d7d3b4d59952822999c"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#a13f66554cee03d7d3b4d59952822999c">vvenc::EncRCPic::updateAlphaBetaIntra</a></div><div class="ttdeci">void updateAlphaBetaIntra(double &amp;alpha, double &amp;beta)</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l01098">RateCtrl.cpp:1098</a></div></div>
<div class="ttc" id="astructvvenc_1_1Picture_html_a7b8e59f547b3a21d59f72e2fd97f751c"><div class="ttname"><a href="structvvenc_1_1Picture.html#a7b8e59f547b3a21d59f72e2fd97f751c">vvenc::Picture::getOrigBuf</a></div><div class="ttdeci">PelUnitBuf getOrigBuf()</div><div class="ttdef"><b>Definition:</b> <a href="Picture_8h_source.html#l00160">Picture.h:160</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_abe4dc3eaf6f08d3447089bb434203555"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#abe4dc3eaf6f08d3447089bb434203555">vvenc::EncRCPic::clipLambdaFrameRc</a></div><div class="ttdeci">void clipLambdaFrameRc(std::list&lt; EncRCPic * &gt; &amp;listPreviousPictures, double &amp;lambda, int bitdepthLumaScale)</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00805">RateCtrl.cpp:805</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_a0537991a88d47e85ab1a38c1a8c828f9"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#a0537991a88d47e85ab1a38c1a8c828f9">vvenc::EncRCSeq::targetBitCnt</a></div><div class="ttdeci">uint64_t targetBitCnt[8]</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00146">RateCtrl.h:146</a></div></div>
<div class="ttc" id="aStatCounter_8h_html_a87a0b8601d301b04efad305d35b8ba20"><div class="ttname"><a href="StatCounter_8h.html#a87a0b8601d301b04efad305d35b8ba20">CHECK</a></div><div class="ttdeci">#define CHECK(c, x)</div><div class="ttdef"><b>Definition:</b> <a href="StatCounter_8h_source.html#l00059">StatCounter.h:59</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_a6dca3fb01fb0bdc3024a26d2c069b89e"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#a6dca3fb01fb0bdc3024a26d2c069b89e">vvenc::EncRCPic::calCostSliceI</a></div><div class="ttdeci">void calCostSliceI(Picture *pic)</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l01591">RateCtrl.cpp:1591</a></div></div>
<div class="ttc" id="astructvvenc_1_1TRCParameter_html_a9424343761f8c4f4c1afe8f5b6bf471b"><div class="ttname"><a href="structvvenc_1_1TRCParameter.html#a9424343761f8c4f4c1afe8f5b6bf471b">vvenc::TRCParameter::beta</a></div><div class="ttdeci">double beta</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00077">RateCtrl.h:77</a></div></div>
<div class="ttc" id="aclassvvenc_1_1RateCtrl_html_ac792156088c1bfd18ac85b5835b95540"><div class="ttname"><a href="classvvenc_1_1RateCtrl.html#ac792156088c1bfd18ac85b5835b95540">vvenc::RateCtrl::encRCSeq</a></div><div class="ttdeci">EncRCSeq * encRCSeq</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00274">RateCtrl.h:274</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCGOP_html_a011b1e71a29b3f4cf510174141783c64"><div class="ttname"><a href="classvvenc_1_1EncRCGOP.html#a011b1e71a29b3f4cf510174141783c64">vvenc::EncRCGOP::encRcSeq</a></div><div class="ttdeci">EncRCSeq * encRcSeq</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00185">RateCtrl.h:185</a></div></div>
<div class="ttc" id="astructvvenc_1_1Size_html_acec3c14453d8e16034230db557345f1e"><div class="ttname"><a href="structvvenc_1_1Size.html#acec3c14453d8e16034230db557345f1e">vvenc::Size::height</a></div><div class="ttdeci">SizeType height</div><div class="ttdef"><b>Definition:</b> <a href="Common_8h_source.html#l00083">Common.h:83</a></div></div>
<div class="ttc" id="aclassvvenc_1_1RateCtrl_html_a5a6de978047f62096b6c0d20659e756b"><div class="ttname"><a href="classvvenc_1_1RateCtrl.html#a5a6de978047f62096b6c0d20659e756b">vvenc::RateCtrl::rcIsFinalPass</a></div><div class="ttdeci">bool rcIsFinalPass</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00281">RateCtrl.h:281</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_a1c83771eaab208a9759847df673b293f"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#a1c83771eaab208a9759847df673b293f">vvenc::EncRCSeq::picParam</a></div><div class="ttdeci">TRCParameter * picParam</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00149">RateCtrl.h:149</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_ae9bfbf4ef5133ec729ce28146b0ff549"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#ae9bfbf4ef5133ec729ce28146b0ff549">vvenc::EncRCPic::picLambda</a></div><div class="ttdeci">double picLambda</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00241">RateCtrl.h:241</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html">vvenc::EncRCPic</a></div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00188">RateCtrl.h:188</a></div></div>
<div class="ttc" id="aclassvvenc_1_1PreCalcValues_html_a83cf297779a1afc59e7d71a87d575861"><div class="ttname"><a href="classvvenc_1_1PreCalcValues.html#a83cf297779a1afc59e7d71a87d575861">vvenc::PreCalcValues::lumaWidth</a></div><div class="ttdeci">const unsigned lumaWidth</div><div class="ttdef"><b>Definition:</b> <a href="Slice_8h_source.html#l01596">Slice.h:1596</a></div></div>
<div class="ttc" id="astructvvenc_1_1Position_html"><div class="ttname"><a href="structvvenc_1_1Position.html">vvenc::Position</a></div><div class="ttdef"><b>Definition:</b> <a href="Common_8h_source.html#l00061">Common.h:61</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_a02fd3c2635e6886180079e82fd389744"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#a02fd3c2635e6886180079e82fd389744">vvenc::EncRCSeq::clipRcAlpha</a></div><div class="ttdeci">void clipRcAlpha(double &amp;alpha)</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00273">RateCtrl.cpp:273</a></div></div>
<div class="ttc" id="anamespacevvenc_html_a7f107d79cd9070e86fdcd4865b8eb965"><div class="ttname"><a href="namespacevvenc.html#a7f107d79cd9070e86fdcd4865b8eb965">vvenc::RC_BETA2</a></div><div class="ttdeci">static const double RC_BETA2</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00073">RateCtrl.cpp:73</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_ad4b745de663253d20459b3744de3ecd1"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#ad4b745de663253d20459b3744de3ecd1">vvenc::EncRCSeq::qpCorrection</a></div><div class="ttdeci">double qpCorrection[8]</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00144">RateCtrl.h:144</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_a05656446c705e5c9331f8181ca223466"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#a05656446c705e5c9331f8181ca223466">vvenc::EncRCPic::calculateLambdaIntra</a></div><div class="ttdeci">double calculateLambdaIntra(double alpha, double beta, double MADPerPixel, double bitsPerPixel)</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l01093">RateCtrl.cpp:1093</a></div></div>
<div class="ttc" id="anamespacevvenc_html_a157d2d9b6e8ac0be6e10917e10ec39fe"><div class="ttname"><a href="namespacevvenc.html#a157d2d9b6e8ac0be6e10917e10ec39fe">vvenc::RC_ALPHA</a></div><div class="ttdeci">static const double RC_ALPHA</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00071">RateCtrl.cpp:71</a></div></div>
<div class="ttc" id="aclassvvenc_1_1RateCtrl_html_ab4eb30394f0c5fe824c23077d4258bf6"><div class="ttname"><a href="classvvenc_1_1RateCtrl.html#ab4eb30394f0c5fe824c23077d4258bf6">vvenc::RateCtrl::rcPass</a></div><div class="ttdeci">int rcPass</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00279">RateCtrl.h:279</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_ab3bd8609092be43aa7654c97fb5aa668"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#ab3bd8609092be43aa7654c97fb5aa668">vvenc::EncRCSeq::lcuWidth</a></div><div class="ttdeci">int lcuWidth</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00131">RateCtrl.h:131</a></div></div>
<div class="ttc" id="aclassvvenc_1_1RateCtrl_html_a3a80b6032f86a56bec74609034b3246f"><div class="ttname"><a href="classvvenc_1_1RateCtrl.html#a3a80b6032f86a56bec74609034b3246f">vvenc::RateCtrl::destroy</a></div><div class="ttdeci">void destroy()</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l01124">RateCtrl.cpp:1124</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_a7192b8cd46d8604a40846c7a736b84fe"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#a7192b8cd46d8604a40846c7a736b84fe">vvenc::EncRCPic::bitsLeft</a></div><div class="ttdeci">int bitsLeft</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00220">RateCtrl.h:220</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_ad0db87e2ca0c90c9609a9a82f52174a5"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#ad0db87e2ca0c90c9609a9a82f52174a5">vvenc::EncRCSeq::gopSize</a></div><div class="ttdeci">int gopSize</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00128">RateCtrl.h:128</a></div></div>
<div class="ttc" id="aclassvvenc_1_1RateCtrl_html_a6f7e3186e9dcbb329b169bf869bee0f9"><div class="ttname"><a href="classvvenc_1_1RateCtrl.html#a6f7e3186e9dcbb329b169bf869bee0f9">vvenc::RateCtrl::initRCGOP</a></div><div class="ttdeci">void initRCGOP(const int numberOfPictures)</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l01333">RateCtrl.cpp:1333</a></div></div>
<div class="ttc" id="astructvvenc_1_1Picture_html_a83dedaccc39c9d31f3ef20ff7ccb4b4f"><div class="ttname"><a href="structvvenc_1_1Picture.html#a83dedaccc39c9d31f3ef20ff7ccb4b4f">vvenc::Picture::cs</a></div><div class="ttdeci">CodingStructure * cs</div><div class="ttdef"><b>Definition:</b> <a href="Picture_8h_source.html#l00206">Picture.h:206</a></div></div>
<div class="ttc" id="astructvvenc_1_1AreaBuf_html_a08f66a6870d87afcd5dc1b60d1019692"><div class="ttname"><a href="structvvenc_1_1AreaBuf.html#a08f66a6870d87afcd5dc1b60d1019692">vvenc::AreaBuf::stride</a></div><div class="ttdeci">int stride</div><div class="ttdef"><b>Definition:</b> <a href="Buffer_8h_source.html#l00125">Buffer.h:125</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_aebcd9a87b695d3618612fcba5248dbf8"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#aebcd9a87b695d3618612fcba5248dbf8">vvenc::EncRCSeq::frameRate</a></div><div class="ttdeci">int frameRate</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00127">RateCtrl.h:127</a></div></div>
<div class="ttc" id="aclassvvenc_1_1PreCalcValues_html_accd995becc51735172dd859be536687a"><div class="ttname"><a href="classvvenc_1_1PreCalcValues.html#accd995becc51735172dd859be536687a">vvenc::PreCalcValues::chrFormat</a></div><div class="ttdeci">const ChromaFormat chrFormat</div><div class="ttdef"><b>Definition:</b> <a href="Slice_8h_source.html#l01584">Slice.h:1584</a></div></div>
<div class="ttc" id="aclassvvenc_1_1RateCtrl_html_ae94098c4175277c311c4bd6807cca139"><div class="ttname"><a href="classvvenc_1_1RateCtrl.html#ae94098c4175277c311c4bd6807cca139">vvenc::RateCtrl::init</a></div><div class="ttdeci">void init(int totFrames, int targetBitrate, int frameRate, int intraPeriod, int GOPSize, int picWidth, int picHeight, int LCUWidth, int LCUHeight, int bitDepth, const vvencGOPEntry GOPList[VVENC_MAX_GOP], int maxParallelFrames)</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l01144">RateCtrl.cpp:1144</a></div></div>
<div class="ttc" id="aCommonDef_8h_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="CommonDef_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="CommonDef_8h_source.html#l00164">CommonDef.h:164</a></div></div>
<div class="ttc" id="anamespacevvenc_html_a166ed3b561f2f4b2071ba9cbdda38d86"><div class="ttname"><a href="namespacevvenc.html#a166ed3b561f2f4b2071ba9cbdda38d86">vvenc::updateCtuDataISlice</a></div><div class="ttdeci">static int updateCtuDataISlice(const CPelBuf buf)</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l01572">RateCtrl.cpp:1572</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_a99e631187ad969a67befaf60f7f441f3"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#a99e631187ad969a67befaf60f7f441f3">vvenc::EncRCPic::totalCostIntra</a></div><div class="ttdeci">double totalCostIntra</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00240">RateCtrl.h:240</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCGOP_html_a4c47890a64ad759a83b19844a364d7d5"><div class="ttname"><a href="classvvenc_1_1EncRCGOP.html#a4c47890a64ad759a83b19844a364d7d5">vvenc::EncRCGOP::picsLeft</a></div><div class="ttdeci">int picsLeft</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00178">RateCtrl.h:178</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCGOP_html_a3a80b6032f86a56bec74609034b3246f"><div class="ttname"><a href="classvvenc_1_1EncRCGOP.html#a3a80b6032f86a56bec74609034b3246f">vvenc::EncRCGOP::destroy</a></div><div class="ttdeci">void destroy()</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00500">RateCtrl.cpp:500</a></div></div>
<div class="ttc" id="anamespacevvenc_html_a59c60ed5c173ea5b12a62f25655236a1"><div class="ttname"><a href="namespacevvenc.html#a59c60ed5c173ea5b12a62f25655236a1">vvenc::RC_GOP_ID_QP_OFFSET_GOP32</a></div><div class="ttdeci">static const int RC_GOP_ID_QP_OFFSET_GOP32[7]</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00063">RateCtrl.cpp:63</a></div></div>
<div class="ttc" id="anamespacevvenc_html_ae9917093a0722aff03da51244f550870"><div class="ttname"><a href="namespacevvenc.html#ae9917093a0722aff03da51244f550870">vvenc::RC_WEIGHT_PIC_TARGET_BIT_IN_BUFFER</a></div><div class="ttdeci">static const double RC_WEIGHT_PIC_TARGET_BIT_IN_BUFFER</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00065">RateCtrl.cpp:65</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_a46a449e1f7713f6afc23ef3306c608cd"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#a46a449e1f7713f6afc23ef3306c608cd">vvenc::EncRCPic::frameLevel</a></div><div class="ttdeci">int frameLevel</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00233">RateCtrl.h:233</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_ae858753d5596f9b39e1a73afe294dd0a"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#ae858753d5596f9b39e1a73afe294dd0a">vvenc::EncRCSeq::initPicPara</a></div><div class="ttdeci">void initPicPara(TRCParameter *picPara=NULL)</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00207">RateCtrl.cpp:207</a></div></div>
<div class="ttc" id="aclassvvenc_1_1RateCtrl_html_a2b5fcef61b77355d86a065adc308528e"><div class="ttname"><a href="classvvenc_1_1RateCtrl.html#a2b5fcef61b77355d86a065adc308528e">vvenc::RateCtrl::encRCGOP</a></div><div class="ttdeci">EncRCGOP * encRCGOP</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00275">RateCtrl.h:275</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_ac036fd34f712c951c1c05593d44bde3e"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#ac036fd34f712c951c1c05593d44bde3e">vvenc::EncRCPic::clipTargetQP</a></div><div class="ttdeci">void clipTargetQP(std::list&lt; EncRCPic * &gt; &amp;listPreviousPictures, int &amp;qp)</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00936">RateCtrl.cpp:936</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_a20b50beeb0bd45f40478f991667d91e8"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#a20b50beeb0bd45f40478f991667d91e8">vvenc::EncRCPic::updateAfterPicture</a></div><div class="ttdeci">void updateAfterPicture(int actualHeaderBits, int actualTotalBits, double averageQP, double averageLambda, bool isIRAP)</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00999">RateCtrl.cpp:999</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCSeq_html_a250403b84afe6f3ee74581c633dd5132"><div class="ttname"><a href="classvvenc_1_1EncRCSeq.html#a250403b84afe6f3ee74581c633dd5132">vvenc::EncRCSeq::estimatedBitUsage</a></div><div class="ttdeci">int64_t estimatedBitUsage</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00142">RateCtrl.h:142</a></div></div>
<div class="ttc" id="anamespacevvenc_html_a744241f8e002c7492b74159ce1caf63d"><div class="ttname"><a href="namespacevvenc.html#a744241f8e002c7492b74159ce1caf63d">vvenc::RC_WEIGHT_HISTORY_LAMBDA</a></div><div class="ttdeci">static const double RC_WEIGHT_HISTORY_LAMBDA</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00066">RateCtrl.cpp:66</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_a087473d0c392a106ef9922f5b866428e"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#a087473d0c392a106ef9922f5b866428e">vvenc::EncRCPic::addToPictureList</a></div><div class="ttdeci">void addToPictureList(std::list&lt; EncRCPic * &gt; &amp;listPreviousPictures)</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00681">RateCtrl.cpp:681</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCGOP_html_a2e06e436d43f9a78d380ad6239d1499f"><div class="ttname"><a href="classvvenc_1_1EncRCGOP.html#a2e06e436d43f9a78d380ad6239d1499f">vvenc::EncRCGOP::~EncRCGOP</a></div><div class="ttdeci">~EncRCGOP()</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00292">RateCtrl.cpp:292</a></div></div>
<div class="ttc" id="anamespacevvenc_html_a4f573f5f27f5af8ecb4786131b1f3b8f"><div class="ttname"><a href="namespacevvenc.html#a4f573f5f27f5af8ecb4786131b1f3b8f">vvenc::RC_BETA_MIN_VALUE</a></div><div class="ttdeci">static const double RC_BETA_MIN_VALUE</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8cpp_source.html#l00069">RateCtrl.cpp:69</a></div></div>
<div class="ttc" id="aclassvvenc_1_1EncRCPic_html_aae0bdbf90049bf94c419c0918b5e1d3d"><div class="ttname"><a href="classvvenc_1_1EncRCPic.html#aae0bdbf90049bf94c419c0918b5e1d3d">vvenc::EncRCPic::numberOfPixel</a></div><div class="ttdeci">int numberOfPixel</div><div class="ttdef"><b>Definition:</b> <a href="RateCtrl_8h_source.html#l00234">RateCtrl.h:234</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_4223c4eee3e7b8a74f7422eb38e0223b.html">vvenc-master</a></li><li class="navelem"><a class="el" href="dir_6750f24480d6fa6988579993faed03f3.html">source</a></li><li class="navelem"><a class="el" href="dir_ae070c9c060a0e4c2f318a822c00f9ca.html">Lib</a></li><li class="navelem"><a class="el" href="dir_923a0f095131df36efa8cc007e0eb205.html">EncoderLib</a></li><li class="navelem"><a class="el" href="RateCtrl_8cpp.html">RateCtrl.cpp</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
